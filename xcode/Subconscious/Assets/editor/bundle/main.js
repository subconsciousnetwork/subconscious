function P(n){this.content=n}P.prototype={constructor:P,find:function(n){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===n)return e;return-1},get:function(n){var e=this.find(n);return e==-1?void 0:this.content[e+1]},update:function(n,e,t){var r=t&&t!=n?this.remove(t):this,i=r.find(n),o=r.content.slice();return i==-1?o.push(t||n,e):(o[i+1]=e,t&&(o[i]=t)),new P(o)},remove:function(n){var e=this.find(n);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new P(t)},addToStart:function(n,e){return new P([n,e].concat(this.remove(n).content))},addToEnd:function(n,e){var t=this.remove(n).content.slice();return t.push(n,e),new P(t)},addBefore:function(n,e,t){var r=this.remove(e),i=r.content.slice(),o=r.find(n);return i.splice(o==-1?i.length:o,0,e,t),new P(i)},forEach:function(n){for(var e=0;e<this.content.length;e+=2)n(this.content[e],this.content[e+1])},prepend:function(n){return n=P.from(n),n.size?new P(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=P.from(n),n.size?new P(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var e=this;n=P.from(n);for(var t=0;t<n.content.length;t+=2)e=e.remove(n.content[t]);return e},toObject:function(){var n={};return this.forEach(function(e,t){n[e]=t}),n},get size(){return this.content.length>>1}};P.from=function(n){if(n instanceof P)return n;var e=[];if(n)for(var t in n)e.push(t,n[t]);return new P(e)};var Mn=P;function jr(n,e,t){for(let r=0;;r++){if(r==n.childCount||r==e.childCount)return n.childCount==e.childCount?null:t;let i=n.child(r),o=e.child(r);if(i==o){t+=i.nodeSize;continue}if(!i.sameMarkup(o))return t;if(i.isText&&i.text!=o.text){for(let s=0;i.text[s]==o.text[s];s++)t++;return t}if(i.content.size||o.content.size){let s=jr(i.content,o.content,t+1);if(s!=null)return s}t+=i.nodeSize}}function Gr(n,e,t,r){for(let i=n.childCount,o=e.childCount;;){if(i==0||o==0)return i==o?null:{a:t,b:r};let s=n.child(--i),l=e.child(--o),a=s.nodeSize;if(s==l){t-=a,r-=a;continue}if(!s.sameMarkup(l))return{a:t,b:r};if(s.isText&&s.text!=l.text){let c=0,h=Math.min(s.text.length,l.text.length);for(;c<h&&s.text[s.text.length-c-1]==l.text[l.text.length-c-1];)c++,t--,r--;return{a:t,b:r}}if(s.content.size||l.content.size){let c=Gr(s.content,l.content,t-1,r-1);if(c)return c}t-=a,r-=a}}var y=class n{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,t,r,i=0,o){for(let s=0,l=0;l<t;s++){let a=this.content[s],c=l+a.nodeSize;if(c>e&&r(a,i+l,o||null,s)!==!1&&a.content.size){let h=l+1;a.nodesBetween(Math.max(0,e-h),Math.min(a.content.size,t-h),r,i+h)}l=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,r,i){let o="",s=!0;return this.nodesBetween(e,t,(l,a)=>{let c=l.isText?l.text.slice(Math.max(e,a)-a,t-a):l.isLeaf?i?typeof i=="function"?i(l):i:l.type.spec.leafText?l.type.spec.leafText(l):"":"";l.isBlock&&(l.isLeaf&&c||l.isTextblock)&&r&&(s?s=!1:o+=r),o+=c},0),o}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,r=e.firstChild,i=this.content.slice(),o=0;for(t.isText&&t.sameMarkup(r)&&(i[i.length-1]=t.withText(t.text+r.text),o=1);o<e.content.length;o++)i.push(e.content[o]);return new n(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let r=[],i=0;if(t>e)for(let o=0,s=0;s<t;o++){let l=this.content[o],a=s+l.nodeSize;a>e&&((s<e||a>t)&&(l.isText?l=l.cut(Math.max(0,e-s),Math.min(l.text.length,t-s)):l=l.cut(Math.max(0,e-s-1),Math.min(l.content.size,t-s-1))),r.push(l),i+=l.nodeSize),s=a}return new n(r,i)}cutByIndex(e,t){return e==t?n.empty:e==0&&t==this.content.length?this:new n(this.content.slice(e,t))}replaceChild(e,t){let r=this.content[e];if(r==t)return this;let i=this.content.slice(),o=this.size+t.nodeSize-r.nodeSize;return i[e]=t,new n(i,o)}addToStart(e){return new n([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new n(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,r=0;t<this.content.length;t++){let i=this.content[t];e(i,r,t),r+=i.nodeSize}}findDiffStart(e,t=0){return jr(this,e,t)}findDiffEnd(e,t=this.size,r=e.size){return Gr(this,e,t,r)}findIndex(e,t=-1){if(e==0)return Dt(0,e);if(e==this.size)return Dt(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,i=0;;r++){let o=this.child(r),s=i+o.nodeSize;if(s>=e)return s==e||t>0?Dt(r+1,s):Dt(r,i);i=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return n.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new n(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return n.empty;let t,r=0;for(let i=0;i<e.length;i++){let o=e[i];r+=o.nodeSize,i&&o.isText&&e[i-1].sameMarkup(o)?(t||(t=e.slice(0,i)),t[t.length-1]=o.withText(t[t.length-1].text+o.text)):t&&t.push(o)}return new n(t||e,r)}static from(e){if(!e)return n.empty;if(e instanceof n)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new n([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};y.empty=new y([],0);var Cn={index:0,offset:0};function Dt(n,e){return Cn.index=n,Cn.offset=e,Cn}function Et(n,e){if(n===e)return!0;if(!(n&&typeof n=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(n);if(Array.isArray(e)!=t)return!1;if(t){if(n.length!=e.length)return!1;for(let r=0;r<n.length;r++)if(!Et(n[r],e[r]))return!1}else{for(let r in n)if(!(r in e)||!Et(n[r],e[r]))return!1;for(let r in e)if(!(r in n))return!1}return!0}var M=class n{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,r=!1;for(let i=0;i<e.length;i++){let o=e[i];if(this.eq(o))return e;if(this.type.excludes(o.type))t||(t=e.slice(0,i));else{if(o.type.excludes(this.type))return e;!r&&o.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),r=!0),t&&t.push(o)}}return t||(t=e.slice()),r||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Et(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[t.type];if(!r)throw new RangeError(`There is no mark type ${t.type} in this schema`);return r.create(t.attrs)}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(t[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return n.none;if(e instanceof n)return[e];let t=e.slice();return t.sort((r,i)=>r.type.rank-i.type.rank),t}};M.none=[];var De=class extends Error{},x=class n{constructor(e,t,r){this.content=e,this.openStart=t,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let r=Xr(this.content,e+this.openStart,t);return r&&new n(r,this.openStart,this.openEnd)}removeBetween(e,t){return new n(Yr(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return n.empty;let r=t.openStart||0,i=t.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new n(y.fromJSON(e,t.content),r,i)}static maxOpen(e,t=!0){let r=0,i=0;for(let o=e.firstChild;o&&!o.isLeaf&&(t||!o.type.spec.isolating);o=o.firstChild)r++;for(let o=e.lastChild;o&&!o.isLeaf&&(t||!o.type.spec.isolating);o=o.lastChild)i++;return new n(e,r,i)}};x.empty=new x(y.empty,0,0);function Yr(n,e,t){let{index:r,offset:i}=n.findIndex(e),o=n.maybeChild(r),{index:s,offset:l}=n.findIndex(t);if(i==e||o.isText){if(l!=t&&!n.child(s).isText)throw new RangeError("Removing non-flat range");return n.cut(0,e).append(n.cut(t))}if(r!=s)throw new RangeError("Removing non-flat range");return n.replaceChild(r,o.copy(Yr(o.content,e-i-1,t-i-1)))}function Xr(n,e,t,r){let{index:i,offset:o}=n.findIndex(e),s=n.maybeChild(i);if(o==e||s.isText)return r&&!r.canReplace(i,i,t)?null:n.cut(0,e).append(t).append(n.cut(e));let l=Xr(s.content,e-o-1,t);return l&&n.replaceChild(i,s.copy(l))}function js(n,e,t){if(t.openStart>n.depth)throw new De("Inserted content deeper than insertion position");if(n.depth-t.openStart!=e.depth-t.openEnd)throw new De("Inconsistent open depths");return Qr(n,e,t,0)}function Qr(n,e,t,r){let i=n.index(r),o=n.node(r);if(i==e.index(r)&&r<n.depth-t.openStart){let s=Qr(n,e,t,r+1);return o.copy(o.content.replaceChild(i,s))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&n.depth==r&&e.depth==r){let s=n.parent,l=s.content;return Ne(s,l.cut(0,n.parentOffset).append(t.content).append(l.cut(e.parentOffset)))}else{let{start:s,end:l}=Gs(t,n);return Ne(o,_r(n,s,l,e,r))}else return Ne(o,At(n,e,r))}function Zr(n,e){if(!e.type.compatibleContent(n.type))throw new De("Cannot join "+e.type.name+" onto "+n.type.name)}function Dn(n,e,t){let r=n.node(t);return Zr(r,e.node(t)),r}function Oe(n,e){let t=e.length-1;t>=0&&n.isText&&n.sameMarkup(e[t])?e[t]=n.withText(e[t].text+n.text):e.push(n)}function nt(n,e,t,r){let i=(e||n).node(t),o=0,s=e?e.index(t):i.childCount;n&&(o=n.index(t),n.depth>t?o++:n.textOffset&&(Oe(n.nodeAfter,r),o++));for(let l=o;l<s;l++)Oe(i.child(l),r);e&&e.depth==t&&e.textOffset&&Oe(e.nodeBefore,r)}function Ne(n,e){return n.type.checkContent(e),n.copy(e)}function _r(n,e,t,r,i){let o=n.depth>i&&Dn(n,e,i+1),s=r.depth>i&&Dn(t,r,i+1),l=[];return nt(null,n,i,l),o&&s&&e.index(i)==t.index(i)?(Zr(o,s),Oe(Ne(o,_r(n,e,t,r,i+1)),l)):(o&&Oe(Ne(o,At(n,e,i+1)),l),nt(e,t,i,l),s&&Oe(Ne(s,At(t,r,i+1)),l)),nt(r,null,i,l),new y(l)}function At(n,e,t){let r=[];if(nt(null,n,t,r),n.depth>t){let i=Dn(n,e,t+1);Oe(Ne(i,At(n,e,t+1)),r)}return nt(e,null,t,r),new y(r)}function Gs(n,e){let t=e.depth-n.openStart,i=e.node(t).copy(n.content);for(let o=t-1;o>=0;o--)i=e.node(o).copy(y.from(i));return{start:i.resolveNoCache(n.openStart+t),end:i.resolveNoCache(i.content.size-n.openEnd-t)}}var It=class n{constructor(e,t,r){this.pos=e,this.path=t,this.parentOffset=r,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=e.child(t);return r?e.child(t).cut(r):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let r=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let o=0;o<e;o++)i+=r.child(o).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return M.none;if(this.textOffset)return e.child(t).marks;let r=e.maybeChild(t-1),i=e.maybeChild(t);if(!r){let l=r;r=i,i=l}let o=r.marks;for(var s=0;s<o.length;s++)o[s].type.spec.inclusive===!1&&(!i||!o[s].isInSet(i.marks))&&(o=o[s--].removeFromSet(o));return o}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let r=t.marks,i=e.parent.maybeChild(e.index());for(var o=0;o<r.length;o++)r[o].type.spec.inclusive===!1&&(!i||!r[o].isInSet(i.marks))&&(r=r[o--].removeFromSet(r));return r}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!t||t(this.node(r))))return new En(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let r=[],i=0,o=t;for(let s=e;;){let{index:l,offset:a}=s.content.findIndex(o),c=o-a;if(r.push(s,l,i+a),!c||(s=s.child(l),s.isText))break;o=c-1,i+=a+1}return new n(t,r,o)}static resolveCached(e,t){for(let i=0;i<Tn.length;i++){let o=Tn[i];if(o.pos==t&&o.doc==e)return o}let r=Tn[On]=n.resolve(e,t);return On=(On+1)%Ys,r}},Tn=[],On=0,Ys=12,En=class{constructor(e,t,r){this.$from=e,this.$to=t,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}},Xs=Object.create(null),te=class n{constructor(e,t,r,i=M.none){this.type=e,this.attrs=t,this.marks=i,this.content=r||y.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,r,i=0){this.content.nodesBetween(e,t,r,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,r,i){return this.content.textBetween(e,t,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,r){return this.type==e&&Et(this.attrs,t||e.defaultAttrs||Xs)&&M.sameSet(this.marks,r||M.none)}copy(e=null){return e==this.content?this:new n(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new n(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,r=!1){if(e==t)return x.empty;let i=this.resolve(e),o=this.resolve(t),s=r?0:i.sharedDepth(t),l=i.start(s),c=i.node(s).content.cut(i.pos-l,o.pos-l);return new x(c,i.depth-s,o.depth-s)}replace(e,t,r){return js(this.resolve(e),this.resolve(t),r)}nodeAt(e){for(let t=this;;){let{index:r,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(r),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(t),index:t,offset:r};let i=this.content.child(t-1);return{node:i,index:t-1,offset:r-i.nodeSize}}resolve(e){return It.resolveCached(this,e)}resolveNoCache(e){return It.resolve(this,e)}rangeHasMark(e,t,r){let i=!1;return t>e&&this.nodesBetween(e,t,o=>(r.isInSet(o.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),ei(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,r=y.empty,i=0,o=r.childCount){let s=this.contentMatchAt(e).matchFragment(r,i,o),l=s&&s.matchFragment(this.content,t);if(!l||!l.validEnd)return!1;for(let a=i;a<o;a++)if(!this.type.allowsMarks(r.child(a).marks))return!1;return!0}canReplaceWith(e,t,r,i){if(i&&!this.type.allowsMarks(i))return!1;let o=this.contentMatchAt(e).matchType(r),s=o&&o.matchFragment(this.content,t);return s?s.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content);let e=M.none;for(let t=0;t<this.marks.length;t++)e=this.marks[t].addToSet(e);if(!M.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let r=null;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,r)}let i=y.fromJSON(e,t.content);return e.nodeType(t.type).create(t.attrs,i,r)}};te.prototype.text=void 0;var An=class n extends te{constructor(e,t,r,i){if(super(e,t,null,i),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):ei(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new n(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new n(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function ei(n,e){for(let t=n.length-1;t>=0;t--)e=n[t].type.name+"("+e+")";return e}var Ee=class n{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let r=new In(e,t);if(r.next==null)return n.empty;let i=ti(r);r.next&&r.err("Unexpected trailing text");let o=rl(nl(i));return il(o,r),o}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,r=e.childCount){let i=this;for(let o=t;i&&o<r;o++)i=i.matchType(e.child(o).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let r=0;r<e.next.length;r++)if(this.next[t].type==e.next[r].type)return!0;return!1}fillBefore(e,t=!1,r=0){let i=[this];function o(s,l){let a=s.matchFragment(e,r);if(a&&(!t||a.validEnd))return y.from(l.map(c=>c.createAndFill()));for(let c=0;c<s.next.length;c++){let{type:h,next:f}=s.next[c];if(!(h.isText||h.hasRequiredAttrs())&&i.indexOf(f)==-1){i.push(f);let d=o(f,l.concat(h));if(d)return d}}return null}return o(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let i=r.shift(),o=i.match;if(o.matchType(e)){let s=[];for(let l=i;l.type;l=l.via)s.push(l.type);return s.reverse()}for(let s=0;s<o.next.length;s++){let{type:l,next:a}=o.next[s];!l.isLeaf&&!l.hasRequiredAttrs()&&!(l.name in t)&&(!i.type||a.validEnd)&&(r.push({match:l.contentMatch,type:l,via:i}),t[l.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(r){e.push(r);for(let i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&t(r.next[i].next)}return t(this),e.map((r,i)=>{let o=i+(r.validEnd?"*":" ")+" ";for(let s=0;s<r.next.length;s++)o+=(s?", ":"")+r.next[s].type.name+"->"+e.indexOf(r.next[s].next);return o}).join(`
`)}};Ee.empty=new Ee(!0);var In=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function ti(n){let e=[];do e.push(Qs(n));while(n.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function Qs(n){let e=[];do e.push(Zs(n));while(n.next&&n.next!=")"&&n.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function Zs(n){let e=tl(n);for(;;)if(n.eat("+"))e={type:"plus",expr:e};else if(n.eat("*"))e={type:"star",expr:e};else if(n.eat("?"))e={type:"opt",expr:e};else if(n.eat("{"))e=_s(n,e);else break;return e}function qr(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let e=Number(n.next);return n.pos++,e}function _s(n,e){let t=qr(n),r=t;return n.eat(",")&&(n.next!="}"?r=qr(n):r=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:t,max:r,expr:e}}function el(n,e){let t=n.nodeTypes,r=t[e];if(r)return[r];let i=[];for(let o in t){let s=t[o];s.groups.indexOf(e)>-1&&i.push(s)}return i.length==0&&n.err("No node type or group '"+e+"' found"),i}function tl(n){if(n.eat("(")){let e=ti(n);return n.eat(")")||n.err("Missing closing paren"),e}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let e=el(n,n.next).map(t=>(n.inline==null?n.inline=t.isInline:n.inline!=t.isInline&&n.err("Mixing inline and block content"),{type:"name",value:t}));return n.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function nl(n){let e=[[]];return i(o(n,0),t()),e;function t(){return e.push([])-1}function r(s,l,a){let c={term:a,to:l};return e[s].push(c),c}function i(s,l){s.forEach(a=>a.to=l)}function o(s,l){if(s.type=="choice")return s.exprs.reduce((a,c)=>a.concat(o(c,l)),[]);if(s.type=="seq")for(let a=0;;a++){let c=o(s.exprs[a],l);if(a==s.exprs.length-1)return c;i(c,l=t())}else if(s.type=="star"){let a=t();return r(l,a),i(o(s.expr,a),a),[r(a)]}else if(s.type=="plus"){let a=t();return i(o(s.expr,l),a),i(o(s.expr,a),a),[r(a)]}else{if(s.type=="opt")return[r(l)].concat(o(s.expr,l));if(s.type=="range"){let a=l;for(let c=0;c<s.min;c++){let h=t();i(o(s.expr,a),h),a=h}if(s.max==-1)i(o(s.expr,a),a);else for(let c=s.min;c<s.max;c++){let h=t();r(a,h),i(o(s.expr,a),h),a=h}return[r(a)]}else{if(s.type=="name")return[r(l,void 0,s.value)];throw new Error("Unknown expr type")}}}}function ni(n,e){return e-n}function Wr(n,e){let t=[];return r(e),t.sort(ni);function r(i){let o=n[i];if(o.length==1&&!o[0].term)return r(o[0].to);t.push(i);for(let s=0;s<o.length;s++){let{term:l,to:a}=o[s];!l&&t.indexOf(a)==-1&&r(a)}}}function rl(n){let e=Object.create(null);return t(Wr(n,0));function t(r){let i=[];r.forEach(s=>{n[s].forEach(({term:l,to:a})=>{if(!l)return;let c;for(let h=0;h<i.length;h++)i[h][0]==l&&(c=i[h][1]);Wr(n,a).forEach(h=>{c||i.push([l,c=[]]),c.indexOf(h)==-1&&c.push(h)})})});let o=e[r.join(",")]=new Ee(r.indexOf(n.length-1)>-1);for(let s=0;s<i.length;s++){let l=i[s][1].sort(ni);o.next.push({type:i[s][0],next:e[l.join(",")]||t(l)})}return o}}function il(n,e){for(let t=0,r=[n];t<r.length;t++){let i=r[t],o=!i.validEnd,s=[];for(let l=0;l<i.next.length;l++){let{type:a,next:c}=i.next[l];s.push(a.name),o&&!(a.isText||a.hasRequiredAttrs())&&(o=!1),r.indexOf(c)==-1&&r.push(c)}o&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function ri(n){let e=Object.create(null);for(let t in n){let r=n[t];if(!r.hasDefault)return null;e[t]=r.default}return e}function ii(n,e){let t=Object.create(null);for(let r in n){let i=e&&e[r];if(i===void 0){let o=n[r];if(o.hasDefault)i=o.default;else throw new RangeError("No value supplied for attribute "+r)}t[r]=i}return t}function oi(n){let e=Object.create(null);if(n)for(let t in n)e[t]=new Pn(n[t]);return e}var Pt=class n{constructor(e,t,r){this.name=e,this.schema=t,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=oi(r.attrs),this.defaultAttrs=ri(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Ee.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:ii(this.attrs,e)}create(e=null,t,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new te(this,this.computeAttrs(e),y.from(t),M.setFrom(r))}createChecked(e=null,t,r){return t=y.from(t),this.checkContent(t),new te(this,this.computeAttrs(e),t,M.setFrom(r))}createAndFill(e=null,t,r){if(e=this.computeAttrs(e),t=y.from(t),t.size){let s=this.contentMatch.fillBefore(t);if(!s)return null;t=s.append(t)}let i=this.contentMatch.matchFragment(t),o=i&&i.fillBefore(y.empty,!0);return o?new te(this,e,t.append(o),M.setFrom(r)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?t&&t.push(e[r]):t||(t=e.slice(0,r));return t?t.length?t:M.none:e}static compile(e,t){let r=Object.create(null);e.forEach((o,s)=>r[o]=new n(o,t,s));let i=t.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let o in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}},Pn=class{constructor(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default}get isRequired(){return!this.hasDefault}},it=class n{constructor(e,t,r,i){this.name=e,this.rank=t,this.schema=r,this.spec=i,this.attrs=oi(i.attrs),this.excluded=null;let o=ri(this.attrs);this.instance=o?new M(this,o):null}create(e=null){return!e&&this.instance?this.instance:new M(this,ii(this.attrs,e))}static compile(e,t){let r=Object.create(null),i=0;return e.forEach((o,s)=>r[o]=new n(o,i++,t,s)),r}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}excludes(e){return this.excluded.indexOf(e)>-1}},vt=class{constructor(e){this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=Mn.from(e.nodes),t.marks=Mn.from(e.marks||{}),this.nodes=Pt.compile(this.spec.nodes,this),this.marks=it.compile(this.spec.marks,this);let r=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let o=this.nodes[i],s=o.spec.content||"",l=o.spec.marks;o.contentMatch=r[s]||(r[s]=Ee.parse(s,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet=l=="_"?null:l?Kr(this,l.split(" ")):l==""||!o.inlineContent?[]:null}for(let i in this.marks){let o=this.marks[i],s=o.spec.excludes;o.excluded=s==null?[o]:s==""?[]:Kr(this,s.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,r,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof Pt){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,r,i)}text(e,t){let r=this.nodes.text;return new An(r,r.defaultAttrs,e,M.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return te.fromJSON(this,e)}markFromJSON(e){return M.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}};function Kr(n,e){let t=[];for(let r=0;r<e.length;r++){let i=e[r],o=n.marks[i],s=o;if(o)t.push(o);else for(let l in n.marks){let a=n.marks[l];(i=="_"||a.spec.group&&a.spec.group.split(" ").indexOf(i)>-1)&&t.push(s=a)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return t}var Ae=class n{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[],t.forEach(r=>{r.tag?this.tags.push(r):r.style&&this.styles.push(r)}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let i=e.nodes[r.node];return i.contentMatch.matchType(i)})}parse(e,t={}){let r=new zt(this,t,!1);return r.addAll(e,t.from,t.to),r.finish()}parseSlice(e,t={}){let r=new zt(this,t,!0);return r.addAll(e,t.from,t.to),x.maxOpen(r.finish())}matchTag(e,t,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let o=this.tags[i];if(ll(e,o.tag)&&(o.namespace===void 0||e.namespaceURI==o.namespace)&&(!o.context||t.matchesContext(o.context))){if(o.getAttrs){let s=o.getAttrs(e);if(s===!1)continue;o.attrs=s||void 0}return o}}}matchStyle(e,t,r,i){for(let o=i?this.styles.indexOf(i)+1:0;o<this.styles.length;o++){let s=this.styles[o],l=s.style;if(!(l.indexOf(e)!=0||s.context&&!r.matchesContext(s.context)||l.length>e.length&&(l.charCodeAt(e.length)!=61||l.slice(e.length+1)!=t))){if(s.getAttrs){let a=s.getAttrs(t);if(a===!1)continue;s.attrs=a||void 0}return s}}}static schemaRules(e){let t=[];function r(i){let o=i.priority==null?50:i.priority,s=0;for(;s<t.length;s++){let l=t[s];if((l.priority==null?50:l.priority)<o)break}t.splice(s,0,i)}for(let i in e.marks){let o=e.marks[i].spec.parseDOM;o&&o.forEach(s=>{r(s=Ur(s)),s.mark||s.ignore||s.clearMark||(s.mark=i)})}for(let i in e.nodes){let o=e.nodes[i].spec.parseDOM;o&&o.forEach(s=>{r(s=Ur(s)),s.node||s.ignore||s.mark||(s.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new n(e,n.schemaRules(e)))}},si={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ol={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},li={ol:!0,ul:!0},Rt=1,Bt=2,rt=4;function $r(n,e,t){return e!=null?(e?Rt:0)|(e==="full"?Bt:0):n&&n.whitespace=="pre"?Rt|Bt:t&~rt}var Ue=class{constructor(e,t,r,i,o,s,l){this.type=e,this.attrs=t,this.marks=r,this.pendingMarks=i,this.solid=o,this.options=l,this.content=[],this.activeMarks=M.none,this.stashMarks=[],this.match=s||(l&rt?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(y.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Rt)){let r=this.content[this.content.length-1],i;if(r&&r.isText&&(i=/[ \t\r\n\u000c]+$/.exec(r.text))){let o=r;r.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=o.withText(o.text.slice(0,o.text.length-i[0].length))}}let t=y.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(y.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}popFromStashMark(e){for(let t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]}applyPending(e){for(let t=0,r=this.pendingMarks;t<r.length;t++){let i=r[t];(this.type?this.type.allowsMarkType(i.type):cl(i.type,e))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!si.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},zt=class{constructor(e,t,r){this.parser=e,this.options=t,this.isOpen=r,this.open=0;let i=t.topNode,o,s=$r(null,t.preserveWhitespace,0)|(r?rt:0);i?o=new Ue(i.type,i.attrs,M.none,M.none,!0,t.topMatch||i.type.contentMatch,s):r?o=new Ue(null,null,M.none,M.none,!0,null,s):o=new Ue(e.schema.topNodeType,null,M.none,M.none,!0,null,s),this.nodes=[o],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e){e.nodeType==3?this.addTextNode(e):e.nodeType==1&&this.addElement(e)}withStyleRules(e,t){let r=e.getAttribute("style");if(!r)return t();let i=this.readStyles(al(r));if(!i)return;let[o,s]=i,l=this.top;for(let a=0;a<s.length;a++)this.removePendingMark(s[a],l);for(let a=0;a<o.length;a++)this.addPendingMark(o[a]);t();for(let a=0;a<o.length;a++)this.removePendingMark(o[a],l);for(let a=0;a<s.length;a++)this.addPendingMark(s[a])}addTextNode(e){let t=e.nodeValue,r=this.top;if(r.options&Bt||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(r.options&Rt)r.options&Bt?t=t.replace(/\r\n?/g,`
`):t=t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){let i=r.content[r.content.length-1],o=e.previousSibling;(!i||o&&o.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)}addElement(e,t){let r=e.nodeName.toLowerCase(),i;li.hasOwnProperty(r)&&this.parser.normalizeLists&&sl(e);let o=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(i=this.parser.matchTag(e,this,t));if(o?o.ignore:ol.hasOwnProperty(r))this.findInside(e),this.ignoreFallback(e);else if(!o||o.skip||o.closeParent){o&&o.closeParent?this.open=Math.max(0,this.open-1):o&&o.skip.nodeType&&(e=o.skip);let s,l=this.top,a=this.needsBlock;if(si.hasOwnProperty(r))l.content.length&&l.content[0].isInline&&this.open&&(this.open--,l=this.top),s=!0,l.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}o&&o.skip?this.addAll(e):this.withStyleRules(e,()=>this.addAll(e)),s&&this.sync(l),this.needsBlock=a}else this.withStyleRules(e,()=>{this.addElementByRule(e,o,o.consuming===!1?i:void 0)})}leafFallback(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))}ignoreFallback(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))}readStyles(e){let t=M.none,r=M.none;for(let i=0;i<e.length;i+=2)for(let o=void 0;;){let s=this.parser.matchStyle(e[i],e[i+1],this,o);if(!s)break;if(s.ignore)return null;if(s.clearMark?this.top.pendingMarks.concat(this.top.activeMarks).forEach(l=>{s.clearMark(l)&&(r=l.addToSet(r))}):t=this.parser.schema.marks[s.mark].create(s.attrs).addToSet(t),s.consuming===!1)o=s;else break}return[t,r]}addElementByRule(e,t,r){let i,o,s;t.node?(o=this.parser.schema.nodes[t.node],o.isLeaf?this.insertNode(o.create(t.attrs))||this.leafFallback(e):i=this.enter(o,t.attrs||null,t.preserveWhitespace)):(s=this.parser.schema.marks[t.mark].create(t.attrs),this.addPendingMark(s));let l=this.top;if(o&&o.isLeaf)this.findInside(e);else if(r)this.addElement(e,r);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(a=>this.insertNode(a));else{let a=e;typeof t.contentElement=="string"?a=e.querySelector(t.contentElement):typeof t.contentElement=="function"?a=t.contentElement(e):t.contentElement&&(a=t.contentElement),this.findAround(e,a,!0),this.addAll(a)}i&&this.sync(l)&&this.open--,s&&this.removePendingMark(s,l)}addAll(e,t,r){let i=t||0;for(let o=t?e.childNodes[t]:e.firstChild,s=r==null?null:e.childNodes[r];o!=s;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o);this.findAtPoint(e,i)}findPlace(e){let t,r;for(let i=this.open;i>=0;i--){let o=this.nodes[i],s=o.findWrapping(e);if(s&&(!t||t.length>s.length)&&(t=s,r=o,!s.length)||o.solid)break}if(!t)return!1;this.sync(r);for(let i=0;i<t.length;i++)this.enterInner(t[i],null,!1);return!0}insertNode(e){if(e.isInline&&this.needsBlock&&!this.top.type){let t=this.textblockFromContext();t&&this.enterInner(t)}if(this.findPlace(e)){this.closeExtra();let t=this.top;t.applyPending(e.type),t.match&&(t.match=t.match.matchType(e.type));let r=t.activeMarks;for(let i=0;i<e.marks.length;i++)(!t.type||t.type.allowsMarkType(e.marks[i].type))&&(r=e.marks[i].addToSet(r));return t.content.push(e.mark(r)),!0}return!1}enter(e,t,r){let i=this.findPlace(e.create(t));return i&&this.enterInner(e,t,!0,r),i}enterInner(e,t=null,r=!1,i){this.closeExtra();let o=this.top;o.applyPending(e),o.match=o.match&&o.match.matchType(e);let s=$r(e,i,o.options);o.options&rt&&o.content.length==0&&(s|=rt),this.nodes.push(new Ue(e,t,o.activeMarks,o.pendingMarks,r,null,s)),this.open++}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let r=this.nodes[t].content;for(let i=r.length-1;i>=0;i--)e+=r[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==t&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,r){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),r=this.options.context,i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),o=-(r?r.depth+1:0)+(i?0:1),s=(l,a)=>{for(;l>=0;l--){let c=t[l];if(c==""){if(l==t.length-1||l==0)continue;for(;a>=o;a--)if(s(l-1,a))return!0;return!1}else{let h=a>0||a==0&&i?this.nodes[a].type:r&&a>=o?r.node(a-o).type:null;if(!h||h.name!=c&&h.groups.indexOf(c)==-1)return!1;a--}}return!0};return s(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let r=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let t in this.parser.schema.nodes){let r=this.parser.schema.nodes[t];if(r.isTextblock&&r.defaultAttrs)return r}}addPendingMark(e){let t=hl(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)}removePendingMark(e,t){for(let r=this.open;r>=0;r--){let i=this.nodes[r];if(i.pendingMarks.lastIndexOf(e)>-1)i.pendingMarks=e.removeFromSet(i.pendingMarks);else{i.activeMarks=e.removeFromSet(i.activeMarks);let s=i.popFromStashMark(e);s&&i.type&&i.type.allowsMarkType(s.type)&&(i.activeMarks=s.addToSet(i.activeMarks))}if(i==t)break}}};function sl(n){for(let e=n.firstChild,t=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&li.hasOwnProperty(r)&&t?(t.appendChild(e),e=t):r=="li"?t=e:r&&(t=null)}}function ll(n,e){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,e)}function al(n){let e=/\s*([\w-]+)\s*:\s*([^;]+)/g,t,r=[];for(;t=e.exec(n);)r.push(t[1],t[2].trim());return r}function Ur(n){let e={};for(let t in n)e[t]=n[t];return e}function cl(n,e){let t=e.schema.nodes;for(let r in t){let i=t[r];if(!i.allowsMarkType(n))continue;let o=[],s=l=>{o.push(l);for(let a=0;a<l.edgeCount;a++){let{type:c,next:h}=l.edge(a);if(c==e||o.indexOf(h)<0&&s(h))return!0}};if(s(i.contentMatch))return!0}}function hl(n,e){for(let t=0;t<e.length;t++)if(n.eq(e[t]))return e[t]}var Ie=class n{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},r){r||(r=Nn(t).createDocumentFragment());let i=r,o=[];return e.forEach(s=>{if(o.length||s.marks.length){let l=0,a=0;for(;l<o.length&&a<s.marks.length;){let c=s.marks[a];if(!this.marks[c.type.name]){a++;continue}if(!c.eq(o[l][0])||c.type.spec.spanning===!1)break;l++,a++}for(;l<o.length;)i=o.pop()[1];for(;a<s.marks.length;){let c=s.marks[a++],h=this.serializeMark(c,s.isInline,t);h&&(o.push([c,i]),i.appendChild(h.dom),i=h.contentDOM||h.dom)}}i.appendChild(this.serializeNodeInner(s,t))}),r}serializeNodeInner(e,t){let{dom:r,contentDOM:i}=n.renderSpec(Nn(t),this.nodes[e.type.name](e));if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,i)}return r}serializeNode(e,t={}){let r=this.serializeNodeInner(e,t);for(let i=e.marks.length-1;i>=0;i--){let o=this.serializeMark(e.marks[i],e.isInline,t);o&&((o.contentDOM||o.dom).appendChild(r),r=o.dom)}return r}serializeMark(e,t,r={}){let i=this.marks[e.type.name];return i&&n.renderSpec(Nn(r),i(e,t))}static renderSpec(e,t,r=null){if(typeof t=="string")return{dom:e.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let i=t[0],o=i.indexOf(" ");o>0&&(r=i.slice(0,o),i=i.slice(o+1));let s,l=r?e.createElementNS(r,i):e.createElement(i),a=t[1],c=1;if(a&&typeof a=="object"&&a.nodeType==null&&!Array.isArray(a)){c=2;for(let h in a)if(a[h]!=null){let f=h.indexOf(" ");f>0?l.setAttributeNS(h.slice(0,f),h.slice(f+1),a[h]):l.setAttribute(h,a[h])}}for(let h=c;h<t.length;h++){let f=t[h];if(f===0){if(h<t.length-1||h>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:d,contentDOM:p}=n.renderSpec(e,f,r);if(l.appendChild(d),p){if(s)throw new RangeError("Multiple content holes");s=p}}}return{dom:l,contentDOM:s}}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new n(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=Hr(e.nodes);return t.text||(t.text=r=>r.text),t}static marksFromSchema(e){return Hr(e.marks)}};function Hr(n){let e={};for(let t in n){let r=n[t].spec.toDOM;r&&(e[t]=r)}return e}function Nn(n){return n.document||window.document}var ci=65535,hi=Math.pow(2,16);function fl(n,e){return n+e*hi}function ai(n){return n&ci}function dl(n){return(n-(n&ci))/hi}var fi=1,di=2,Ft=4,ui=8,lt=class{constructor(e,t,r){this.pos=e,this.delInfo=t,this.recover=r}get deleted(){return(this.delInfo&ui)>0}get deletedBefore(){return(this.delInfo&(fi|Ft))>0}get deletedAfter(){return(this.delInfo&(di|Ft))>0}get deletedAcross(){return(this.delInfo&Ft)>0}},le=class n{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&n.empty)return n.empty}recover(e){let t=0,r=ai(e);if(!this.inverted)for(let i=0;i<r;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+t+dl(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,r){let i=0,o=this.inverted?2:1,s=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?i:0);if(a>e)break;let c=this.ranges[l+o],h=this.ranges[l+s],f=a+c;if(e<=f){let d=c?e==a?-1:e==f?1:t:t,p=a+i+(d<0?0:h);if(r)return p;let u=e==(t<0?a:f)?null:fl(l/3,e-a),m=e==a?di:e==f?fi:Ft;return(t<0?e!=a:e!=f)&&(m|=ui),new lt(p,m,u)}i+=h-c}return r?e+i:new lt(e+i,0,null)}touches(e,t){let r=0,i=ai(t),o=this.inverted?2:1,s=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?r:0);if(a>e)break;let c=this.ranges[l+o],h=a+c;if(e<=h&&l==i*3)return!0;r+=this.ranges[l+s]-c}return!1}forEach(e){let t=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,o=0;i<this.ranges.length;i+=3){let s=this.ranges[i],l=s-(this.inverted?o:0),a=s+(this.inverted?0:o),c=this.ranges[i+t],h=this.ranges[i+r];e(l,l+c,a,a+h),o+=h-c}}invert(){return new n(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?n.empty:new n(e<0?[0,-e,0]:[0,0,e])}};le.empty=new le([]);var at=class n{constructor(e=[],t,r=0,i=e.length){this.maps=e,this.mirror=t,this.from=r,this.to=i}slice(e=0,t=this.maps.length){return new n(this.maps,this.mirror,e,t)}copy(){return new n(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),t!=null&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,r=this.maps.length;t<e.maps.length;t++){let i=e.getMirror(t);this.appendMap(e.maps[t],i!=null&&i<t?r+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,r=this.maps.length+e.maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e.maps[t].invert(),i!=null&&i>t?r-i-1:void 0)}}invert(){let e=new n;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let r=this.from;r<this.to;r++)e=this.maps[r].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,r){let i=0;for(let o=this.from;o<this.to;o++){let s=this.maps[o],l=s.mapResult(e,t);if(l.recover!=null){let a=this.getMirror(o);if(a!=null&&a>o&&a<this.to){o=a,e=this.maps[a].recover(l.recover);continue}}i|=l.delInfo,e=l.pos}return r?e:new lt(e,i,null)}},vn=Object.create(null),N=class{getMap(){return le.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=vn[t.stepType];if(!r)throw new RangeError(`No step type ${t.stepType} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in vn)throw new RangeError("Duplicate use of step JSON ID "+e);return vn[e]=t,t.prototype.jsonID=e,t}},E=class n{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new n(e,null)}static fail(e){return new n(null,e)}static fromReplace(e,t,r,i){try{return n.ok(e.replace(t,r,i))}catch(o){if(o instanceof De)return n.fail(o.message);throw o}}};function Vn(n,e,t){let r=[];for(let i=0;i<n.childCount;i++){let o=n.child(i);o.content.size&&(o=o.copy(Vn(o.content,e,o))),o.isInline&&(o=e(o,t,i)),r.push(o)}return y.fromArray(r)}var ct=class n extends N{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),o=new x(Vn(t.content,(s,l)=>!s.isAtom||!l.type.allowsMarkType(this.mark.type)?s:s.mark(this.mark.addToSet(s.marks)),i),t.openStart,t.openEnd);return E.fromReplace(e,this.from,this.to,o)}invert(){return new Pe(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new n(t.pos,r.pos,this.mark)}merge(e){return e instanceof n&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new n(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new n(t.from,t.to,e.markFromJSON(t.mark))}};N.jsonID("addMark",ct);var Pe=class n extends N{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=new x(Vn(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return E.fromReplace(e,this.from,this.to,r)}invert(){return new ct(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new n(t.pos,r.pos,this.mark)}merge(e){return e instanceof n&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new n(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new n(t.from,t.to,e.markFromJSON(t.mark))}};N.jsonID("removeMark",Pe);var ht=class n extends N{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return E.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return E.fromReplace(e,this.pos,this.pos+1,new x(y.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let r=this.mark.addToSet(t.marks);if(r.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(r))return new n(this.pos,t.marks[i]);return new n(this.pos,this.mark)}}return new ft(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new n(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new n(t.pos,e.markFromJSON(t.mark))}};N.jsonID("addNodeMark",ht);var ft=class n extends N{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return E.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return E.fromReplace(e,this.pos,this.pos+1,new x(y.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new ht(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new n(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new n(t.pos,e.markFromJSON(t.mark))}};N.jsonID("removeNodeMark",ft);var j=class n extends N{constructor(e,t,r,i=!1){super(),this.from=e,this.to=t,this.slice=r,this.structure=i}apply(e){return this.structure&&zn(e,this.from,this.to)?E.fail("Structure replace would overwrite content"):E.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new le([this.from,this.to-this.from,this.slice.size])}invert(e){return new n(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deletedAcross&&r.deletedAcross?null:new n(t.pos,Math.max(t.pos,r.pos),this.slice)}merge(e){if(!(e instanceof n)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?x.empty:new x(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new n(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?x.empty:new x(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new n(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new n(t.from,t.to,x.fromJSON(e,t.slice),!!t.structure)}};N.jsonID("replace",j);var G=class n extends N{constructor(e,t,r,i,o,s,l=!1){super(),this.from=e,this.to=t,this.gapFrom=r,this.gapTo=i,this.slice=o,this.insert=s,this.structure=l}apply(e){if(this.structure&&(zn(e,this.from,this.gapFrom)||zn(e,this.gapTo,this.to)))return E.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return E.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,t.content);return r?E.fromReplace(e,this.from,this.to,r):E.fail("Content does not fit in gap")}getMap(){return new le([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new n(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),i=e.map(this.gapFrom,-1),o=e.map(this.gapTo,1);return t.deletedAcross&&r.deletedAcross||i<t.pos||o>r.pos?null:new n(t.pos,r.pos,i,o,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new n(t.from,t.to,t.gapFrom,t.gapTo,x.fromJSON(e,t.slice),t.insert,!!t.structure)}};N.jsonID("replaceAround",G);function zn(n,e,t){let r=n.resolve(e),i=t-e,o=r.depth;for(;i>0&&o>0&&r.indexAfter(o)==r.node(o).childCount;)o--,i--;if(i>0){let s=r.node(o).maybeChild(r.indexAfter(o));for(;i>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,i--}}return!1}function ul(n,e,t,r){let i=[],o=[],s,l;n.doc.nodesBetween(e,t,(a,c,h)=>{if(!a.isInline)return;let f=a.marks;if(!r.isInSet(f)&&h.type.allowsMarkType(r.type)){let d=Math.max(c,e),p=Math.min(c+a.nodeSize,t),u=r.addToSet(f);for(let m=0;m<f.length;m++)f[m].isInSet(u)||(s&&s.to==d&&s.mark.eq(f[m])?s.to=p:i.push(s=new Pe(d,p,f[m])));l&&l.to==d?l.to=p:o.push(l=new ct(d,p,r))}}),i.forEach(a=>n.step(a)),o.forEach(a=>n.step(a))}function pl(n,e,t,r){let i=[],o=0;n.doc.nodesBetween(e,t,(s,l)=>{if(!s.isInline)return;o++;let a=null;if(r instanceof it){let c=s.marks,h;for(;h=r.isInSet(c);)(a||(a=[])).push(h),c=h.removeFromSet(c)}else r?r.isInSet(s.marks)&&(a=[r]):a=s.marks;if(a&&a.length){let c=Math.min(l+s.nodeSize,t);for(let h=0;h<a.length;h++){let f=a[h],d;for(let p=0;p<i.length;p++){let u=i[p];u.step==o-1&&f.eq(i[p].style)&&(d=u)}d?(d.to=c,d.step=o):i.push({style:f,from:Math.max(l,e),to:c,step:o})}}}),i.forEach(s=>n.step(new Pe(s.from,s.to,s.style)))}function ml(n,e,t,r=t.contentMatch){let i=n.doc.nodeAt(e),o=[],s=e+1;for(let l=0;l<i.childCount;l++){let a=i.child(l),c=s+a.nodeSize,h=r.matchType(a.type);if(!h)o.push(new j(s,c,x.empty));else{r=h;for(let f=0;f<a.marks.length;f++)t.allowsMarkType(a.marks[f].type)||n.step(new Pe(s,c,a.marks[f]));if(a.isText&&!t.spec.code){let f,d=/\r?\n|\r/g,p;for(;f=d.exec(a.text);)p||(p=new x(y.from(t.schema.text(" ",t.allowedMarks(a.marks))),0,0)),o.push(new j(s+f.index,s+f.index+f[0].length,p))}}s=c}if(!r.validEnd){let l=r.fillBefore(y.empty,!0);n.replace(s,s,new x(l,0,0))}for(let l=o.length-1;l>=0;l--)n.step(o[l])}function gl(n,e,t){return(e==0||n.canReplace(e,n.childCount))&&(t==n.childCount||n.canReplace(0,t))}function qt(n){let t=n.parent.content.cutByIndex(n.startIndex,n.endIndex);for(let r=n.depth;;--r){let i=n.$from.node(r),o=n.$from.index(r),s=n.$to.indexAfter(r);if(r<n.depth&&i.canReplace(o,s,t))return r;if(r==0||i.type.spec.isolating||!gl(i,o,s))break}return null}function yl(n,e,t){let{$from:r,$to:i,depth:o}=e,s=r.before(o+1),l=i.after(o+1),a=s,c=l,h=y.empty,f=0;for(let u=o,m=!1;u>t;u--)m||r.index(u)>0?(m=!0,h=y.from(r.node(u).copy(h)),f++):a--;let d=y.empty,p=0;for(let u=o,m=!1;u>t;u--)m||i.after(u+1)<i.end(u)?(m=!0,d=y.from(i.node(u).copy(d)),p++):c++;n.step(new G(a,c,s,l,new x(h.append(d),f,p),h.size-f,!0))}function xl(n,e,t){let r=y.empty;for(let s=t.length-1;s>=0;s--){if(r.size){let l=t[s].type.contentMatch.matchFragment(r);if(!l||!l.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=y.from(t[s].type.create(t[s].attrs,r))}let i=e.start,o=e.end;n.step(new G(i,o,i,o,new x(r,0,0),t.length,!0))}function bl(n,e,t,r,i){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let o=n.steps.length;n.doc.nodesBetween(e,t,(s,l)=>{if(s.isTextblock&&!s.hasMarkup(r,i)&&kl(n.doc,n.mapping.slice(o).map(l),r)){n.clearIncompatible(n.mapping.slice(o).map(l,1),r);let a=n.mapping.slice(o),c=a.map(l,1),h=a.map(l+s.nodeSize,1);return n.step(new G(c,h,c+1,h-1,new x(y.from(r.create(i,null,s.marks)),0,0),1,!0)),!1}})}function kl(n,e,t){let r=n.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,t)}function Sl(n,e,t,r,i){let o=n.doc.nodeAt(e);if(!o)throw new RangeError("No node at given position");t||(t=o.type);let s=t.create(r,null,i||o.marks);if(o.isLeaf)return n.replaceWith(e,e+o.nodeSize,s);if(!t.validContent(o.content))throw new RangeError("Invalid content for node type "+t.name);n.step(new G(e,e+o.nodeSize,e+1,e+o.nodeSize-1,new x(y.from(s),0,0),1,!0))}function dt(n,e,t=1,r){let i=n.resolve(e),o=i.depth-t,s=r&&r[r.length-1]||i.parent;if(o<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!s.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,h=t-2;c>o;c--,h--){let f=i.node(c),d=i.index(c);if(f.type.spec.isolating)return!1;let p=f.content.cutByIndex(d,f.childCount),u=r&&r[h+1];u&&(p=p.replaceChild(0,u.type.create(u.attrs)));let m=r&&r[h]||f;if(!f.canReplace(d+1,f.childCount)||!m.type.validContent(p))return!1}let l=i.indexAfter(o),a=r&&r[0];return i.node(o).canReplaceWith(l,l,a?a.type:i.node(o+1).type)}function wl(n,e,t=1,r){let i=n.doc.resolve(e),o=y.empty,s=y.empty;for(let l=i.depth,a=i.depth-t,c=t-1;l>a;l--,c--){o=y.from(i.node(l).copy(o));let h=r&&r[c];s=y.from(h?h.type.create(h.attrs,s):i.node(l).copy(s))}n.step(new j(e,e,new x(o.append(s),t,t),!0))}function Ln(n,e){let t=n.resolve(e),r=t.index();return Ml(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(r,r+1)}function Ml(n,e){return!!(n&&e&&!n.isLeaf&&n.canAppend(e))}function Cl(n,e,t){let r=new j(e-t,e+t,x.empty,!0);n.step(r)}function Tl(n,e,t){let r=n.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),t))return e;if(r.parentOffset==0)for(let i=r.depth-1;i>=0;i--){let o=r.index(i);if(r.node(i).canReplaceWith(o,o,t))return r.before(i+1);if(o>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let o=r.indexAfter(i);if(r.node(i).canReplaceWith(o,o,t))return r.after(i+1);if(o<r.node(i).childCount)return null}return null}function Wt(n,e,t){let r=n.resolve(e);if(!t.content.size)return e;let i=t.content;for(let o=0;o<t.openStart;o++)i=i.firstChild.content;for(let o=1;o<=(t.openStart==0&&t.size?2:1);o++)for(let s=r.depth;s>=0;s--){let l=s==r.depth?0:r.pos<=(r.start(s+1)+r.end(s+1))/2?-1:1,a=r.index(s)+(l>0?1:0),c=r.node(s),h=!1;if(o==1)h=c.canReplace(a,a,i);else{let f=c.contentMatchAt(a).findWrapping(i.firstChild.type);h=f&&c.canReplaceWith(a,a,f[0])}if(h)return l==0?r.pos:l<0?r.before(s+1):r.after(s+1)}return null}function Kt(n,e,t=e,r=x.empty){if(e==t&&!r.size)return null;let i=n.resolve(e),o=n.resolve(t);return pi(i,o,r)?new j(e,t,r):new Fn(i,o,r).fit()}function pi(n,e,t){return!t.openStart&&!t.openEnd&&n.start()==e.start()&&n.parent.canReplace(n.index(),e.index(),t.content)}var Fn=class{constructor(e,t,r){this.$from=e,this.$to=t,this.unplaced=r,this.frontier=[],this.placed=y.empty;for(let i=0;i<=e.depth;i++){let o=e.node(i);this.frontier.push({type:o.type,match:o.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=y.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(e<0?this.$to:r.doc.resolve(e));if(!i)return null;let o=this.placed,s=r.depth,l=i.depth;for(;s&&l&&o.childCount==1;)o=o.firstChild.content,s--,l--;let a=new x(o,s,l);return e>-1?new G(r.pos,e,this.$to.pos,this.$to.end(),a,t):a.size||r.pos!=this.$to.pos?new j(r.pos,i.pos,a):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,r=0,i=this.unplaced.openEnd;r<e;r++){let o=t.firstChild;if(t.childCount>1&&(i=0),o.type.spec.isolating&&i<=r){e=r;break}t=o.content}for(let t=1;t<=2;t++)for(let r=t==1?e:this.unplaced.openStart;r>=0;r--){let i,o=null;r?(o=Rn(this.unplaced.content,r-1).firstChild,i=o.content):i=this.unplaced.content;let s=i.firstChild;for(let l=this.depth;l>=0;l--){let{type:a,match:c}=this.frontier[l],h,f=null;if(t==1&&(s?c.matchType(s.type)||(f=c.fillBefore(y.from(s),!1)):o&&a.compatibleContent(o.type)))return{sliceDepth:r,frontierDepth:l,parent:o,inject:f};if(t==2&&s&&(h=c.findWrapping(s.type)))return{sliceDepth:r,frontierDepth:l,parent:o,wrap:h};if(o&&c.matchType(o.type))break}}}openMore(){let{content:e,openStart:t,openEnd:r}=this.unplaced,i=Rn(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new x(e,t+1,Math.max(r,i.size+t>=e.size-r?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:r}=this.unplaced,i=Rn(e,t);if(i.childCount<=1&&t>0){let o=e.size-t<=t+i.size;this.unplaced=new x(ot(e,t-1,1),t-1,o?t-1:r)}else this.unplaced=new x(ot(e,t,1),t,r)}placeNodes({sliceDepth:e,frontierDepth:t,parent:r,inject:i,wrap:o}){for(;this.depth>t;)this.closeFrontierNode();if(o)for(let m=0;m<o.length;m++)this.openFrontierNode(o[m]);let s=this.unplaced,l=r?r.content:s.content,a=s.openStart-e,c=0,h=[],{match:f,type:d}=this.frontier[t];if(i){for(let m=0;m<i.childCount;m++)h.push(i.child(m));f=f.matchFragment(i)}let p=l.size+e-(s.content.size-s.openEnd);for(;c<l.childCount;){let m=l.child(c),g=f.matchType(m.type);if(!g)break;c++,(c>1||a==0||m.content.size)&&(f=g,h.push(mi(m.mark(d.allowedMarks(m.marks)),c==1?a:0,c==l.childCount?p:-1)))}let u=c==l.childCount;u||(p=-1),this.placed=st(this.placed,t,y.from(h)),this.frontier[t].match=f,u&&p<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=l;m<p;m++){let k=g.lastChild;this.frontier.push({type:k.type,match:k.contentMatchAt(k.childCount)}),g=k.content}this.unplaced=u?e==0?x.empty:new x(ot(s.content,e-1,1),e-1,p<0?s.openEnd:e-1):new x(ot(s.content,e,c),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!Bn(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:r}=this.$to,i=this.$to.after(r);for(;r>1&&i==this.$to.end(--r);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:r,type:i}=this.frontier[t],o=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),s=Bn(e,t,i,r,o);if(s){for(let l=t-1;l>=0;l--){let{match:a,type:c}=this.frontier[l],h=Bn(e,l,c,a,!0);if(!h||h.childCount)continue e}return{depth:t,fit:s,move:o?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=st(this.placed,t.depth,t.fit)),e=t.move;for(let r=t.depth+1;r<=e.depth;r++){let i=e.node(r),o=i.type.contentMatch.fillBefore(i.content,!0,e.index(r));this.openFrontierNode(i.type,i.attrs,o)}return e}openFrontierNode(e,t=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=st(this.placed,this.depth,y.from(e.create(t,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(y.empty,!0);t.childCount&&(this.placed=st(this.placed,this.frontier.length,t))}};function ot(n,e,t){return e==0?n.cutByIndex(t,n.childCount):n.replaceChild(0,n.firstChild.copy(ot(n.firstChild.content,e-1,t)))}function st(n,e,t){return e==0?n.append(t):n.replaceChild(n.childCount-1,n.lastChild.copy(st(n.lastChild.content,e-1,t)))}function Rn(n,e){for(let t=0;t<e;t++)n=n.firstChild.content;return n}function mi(n,e,t){if(e<=0)return n;let r=n.content;return e>1&&(r=r.replaceChild(0,mi(r.firstChild,e-1,r.childCount==1?t-1:0))),e>0&&(r=n.type.contentMatch.fillBefore(r).append(r),t<=0&&(r=r.append(n.type.contentMatch.matchFragment(r).fillBefore(y.empty,!0)))),n.copy(r)}function Bn(n,e,t,r,i){let o=n.node(e),s=i?n.indexAfter(e):n.index(e);if(s==o.childCount&&!t.compatibleContent(o.type))return null;let l=r.fillBefore(o.content,!0,s);return l&&!Ol(t,o.content,s)?l:null}function Ol(n,e,t){for(let r=t;r<e.childCount;r++)if(!n.allowsMarks(e.child(r).marks))return!0;return!1}function Nl(n){return n.spec.defining||n.spec.definingForContent}function Dl(n,e,t,r){if(!r.size)return n.deleteRange(e,t);let i=n.doc.resolve(e),o=n.doc.resolve(t);if(pi(i,o,r))return n.step(new j(e,t,r));let s=yi(i,n.doc.resolve(t));s[s.length-1]==0&&s.pop();let l=-(i.depth+1);s.unshift(l);for(let d=i.depth,p=i.pos-1;d>0;d--,p--){let u=i.node(d).type.spec;if(u.defining||u.definingAsContext||u.isolating)break;s.indexOf(d)>-1?l=d:i.before(d)==p&&s.splice(1,0,-d)}let a=s.indexOf(l),c=[],h=r.openStart;for(let d=r.content,p=0;;p++){let u=d.firstChild;if(c.push(u),p==r.openStart)break;d=u.content}for(let d=h-1;d>=0;d--){let p=c[d],u=Nl(p.type);if(u&&!p.sameMarkup(i.node(Math.abs(l)-1)))h=d;else if(u||!p.type.isTextblock)break}for(let d=r.openStart;d>=0;d--){let p=(d+h+1)%(r.openStart+1),u=c[p];if(u)for(let m=0;m<s.length;m++){let g=s[(m+a)%s.length],k=!0;g<0&&(k=!1,g=-g);let z=i.node(g-1),pe=i.index(g-1);if(z.canReplaceWith(pe,pe,u.type,u.marks))return n.replace(i.before(g),k?o.after(g):t,new x(gi(r.content,0,r.openStart,p),p,r.openEnd))}}let f=n.steps.length;for(let d=s.length-1;d>=0&&(n.replace(e,t,r),!(n.steps.length>f));d--){let p=s[d];p<0||(e=i.before(p),t=o.after(p))}}function gi(n,e,t,r,i){if(e<t){let o=n.firstChild;n=n.replaceChild(0,o.copy(gi(o.content,e+1,t,r,o)))}if(e>r){let o=i.contentMatchAt(0),s=o.fillBefore(n).append(n);n=s.append(o.matchFragment(s).fillBefore(y.empty,!0))}return n}function El(n,e,t,r){if(!r.isInline&&e==t&&n.doc.resolve(e).parent.content.size){let i=Tl(n.doc,e,r.type);i!=null&&(e=t=i)}n.replaceRange(e,t,new x(y.from(r),0,0))}function Al(n,e,t){let r=n.doc.resolve(e),i=n.doc.resolve(t),o=yi(r,i);for(let s=0;s<o.length;s++){let l=o[s],a=s==o.length-1;if(a&&l==0||r.node(l).type.contentMatch.validEnd)return n.delete(r.start(l),i.end(l));if(l>0&&(a||r.node(l-1).canReplace(r.index(l-1),i.indexAfter(l-1))))return n.delete(r.before(l),i.after(l))}for(let s=1;s<=r.depth&&s<=i.depth;s++)if(e-r.start(s)==r.depth-s&&t>r.end(s)&&i.end(s)-t!=i.depth-s)return n.delete(r.before(s),t);n.delete(e,t)}function yi(n,e){let t=[],r=Math.min(n.depth,e.depth);for(let i=r;i>=0;i--){let o=n.start(i);if(o<n.pos-(n.depth-i)||e.end(i)>e.pos+(e.depth-i)||n.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(o==e.start(i)||i==n.depth&&i==e.depth&&n.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==o-1)&&t.push(i)}return t}var Vt=class n extends N{constructor(e,t,r){super(),this.pos=e,this.attr=t,this.value=r}apply(e){let t=e.nodeAt(this.pos);if(!t)return E.fail("No node at attribute step's position");let r=Object.create(null);for(let o in t.attrs)r[o]=t.attrs[o];r[this.attr]=this.value;let i=t.type.create(r,null,t.marks);return E.fromReplace(e,this.pos,this.pos+1,new x(y.from(i),0,t.isLeaf?0:1))}getMap(){return le.empty}invert(e){return new n(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new n(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new n(t.pos,t.attr,t.value)}};N.jsonID("attr",Vt);var Lt=class n extends N{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let r=e.type.create(t,e.content,e.marks);return E.ok(r)}getMap(){return le.empty}invert(e){return new n(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new n(t.attr,t.value)}};N.jsonID("docAttr",Lt);var He=class extends Error{};He=function n(e){let t=Error.call(this,e);return t.__proto__=n.prototype,t};He.prototype=Object.create(Error.prototype);He.prototype.constructor=He;He.prototype.name="TransformError";var Jt=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new at}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new He(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,r=x.empty){let i=Kt(this.doc,e,t,r);return i&&this.step(i),this}replaceWith(e,t,r){return this.replace(e,t,new x(y.from(r),0,0))}delete(e,t){return this.replace(e,t,x.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,r){return Dl(this,e,t,r),this}replaceRangeWith(e,t,r){return El(this,e,t,r),this}deleteRange(e,t){return Al(this,e,t),this}lift(e,t){return yl(this,e,t),this}join(e,t=1){return Cl(this,e,t),this}wrap(e,t){return xl(this,e,t),this}setBlockType(e,t=e,r,i=null){return bl(this,e,t,r,i),this}setNodeMarkup(e,t,r=null,i){return Sl(this,e,t,r,i),this}setNodeAttribute(e,t,r){return this.step(new Vt(e,t,r)),this}setDocAttribute(e,t){return this.step(new Lt(e,t)),this}addNodeMark(e,t){return this.step(new ht(e,t)),this}removeNodeMark(e,t){if(!(t instanceof M)){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(t=t.isInSet(r.marks),!t)return this}return this.step(new ft(e,t)),this}split(e,t=1,r){return wl(this,e,t,r),this}addMark(e,t,r){return ul(this,e,t,r),this}removeMark(e,t,r){return pl(this,e,t,r),this}clearIncompatible(e,t,r){return ml(this,e,t,r),this}};var Jn=Object.create(null),S=class{constructor(e,t,r){this.$anchor=e,this.$head=t,this.ranges=r||[new Wn(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=x.empty){let r=t.content.lastChild,i=null;for(let l=0;l<t.openEnd;l++)i=r,r=r.lastChild;let o=e.steps.length,s=this.ranges;for(let l=0;l<s.length;l++){let{$from:a,$to:c}=s[l],h=e.mapping.slice(o);e.replaceRange(h.map(a.pos),h.map(c.pos),l?x.empty:t),l==0&&ki(e,o,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let r=e.steps.length,i=this.ranges;for(let o=0;o<i.length;o++){let{$from:s,$to:l}=i[o],a=e.mapping.slice(r),c=a.map(s.pos),h=a.map(l.pos);o?e.deleteRange(c,h):(e.replaceRangeWith(c,h,t),ki(e,r,t.isInline?-1:1))}}static findFrom(e,t,r=!1){let i=e.parent.inlineContent?new C(e):je(e.node(0),e.parent,e.pos,e.index(),t,r);if(i)return i;for(let o=e.depth-1;o>=0;o--){let s=t<0?je(e.node(0),e.node(o),e.before(o+1),e.index(o),t,r):je(e.node(0),e.node(o),e.after(o+1),e.index(o)+1,t,r);if(s)return s}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Y(e.node(0))}static atStart(e){return je(e,e,0,0,1)||new Y(e)}static atEnd(e){return je(e,e,e.content.size,e.childCount,-1)||new Y(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=Jn[t.type];if(!r)throw new RangeError(`No selection type ${t.type} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in Jn)throw new RangeError("Duplicate use of selection JSON ID "+e);return Jn[e]=t,t.prototype.jsonID=e,t}getBookmark(){return C.between(this.$anchor,this.$head).getBookmark()}};S.prototype.visible=!0;var Wn=class{constructor(e,t){this.$from=e,this.$to=t}},xi=!1;function bi(n){!xi&&!n.parent.inlineContent&&(xi=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}var C=class n extends S{constructor(e,t=e){bi(e),bi(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let r=e.resolve(t.map(this.head));if(!r.parent.inlineContent)return S.near(r);let i=e.resolve(t.map(this.anchor));return new n(i.parent.inlineContent?i:r,r)}replace(e,t=x.empty){if(super.replace(e,t),t==x.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof n&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Ut(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new n(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,r=t){let i=e.resolve(t);return new this(i,r==t?i:e.resolve(r))}static between(e,t,r){let i=e.pos-t.pos;if((!r||i)&&(r=i>=0?1:-1),!t.parent.inlineContent){let o=S.findFrom(t,r,!0)||S.findFrom(t,-r,!0);if(o)t=o.$head;else return S.near(t,r)}return e.parent.inlineContent||(i==0?e=t:(e=(S.findFrom(e,-r,!0)||S.findFrom(e,r,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new n(e,t)}};S.jsonID("text",C);var Ut=class n{constructor(e,t){this.anchor=e,this.head=t}map(e){return new n(e.map(this.anchor),e.map(this.head))}resolve(e){return C.between(e.resolve(this.anchor),e.resolve(this.head))}},b=class n extends S{constructor(e){let t=e.nodeAfter,r=e.node(0).resolve(e.pos+t.nodeSize);super(e,r),this.node=t}map(e,t){let{deleted:r,pos:i}=t.mapResult(this.anchor),o=e.resolve(i);return r?S.near(o):new n(o)}content(){return new x(y.from(this.node),0,0)}eq(e){return e instanceof n&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Kn(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new n(e.resolve(t.anchor))}static create(e,t){return new n(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};b.prototype.visible=!1;S.jsonID("node",b);var Kn=class n{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:r}=e.mapResult(this.anchor);return t?new Ut(r,r):new n(r)}resolve(e){let t=e.resolve(this.anchor),r=t.nodeAfter;return r&&b.isSelectable(r)?new b(t):S.near(t)}},Y=class n extends S{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=x.empty){if(t==x.empty){e.delete(0,e.doc.content.size);let r=S.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new n(e)}map(e){return new n(e)}eq(e){return e instanceof n}getBookmark(){return Il}};S.jsonID("all",Y);var Il={map(){return this},resolve(n){return new Y(n)}};function je(n,e,t,r,i,o=!1){if(e.inlineContent)return C.create(n,t);for(let s=r-(i>0?0:1);i>0?s<e.childCount:s>=0;s+=i){let l=e.child(s);if(l.isAtom){if(!o&&b.isSelectable(l))return b.create(n,t-(i<0?l.nodeSize:0))}else{let a=je(n,l,t+i,i<0?l.childCount:0,i,o);if(a)return a}t+=l.nodeSize*i}return null}function ki(n,e,t){let r=n.steps.length-1;if(r<e)return;let i=n.steps[r];if(!(i instanceof j||i instanceof G))return;let o=n.mapping.maps[r],s;o.forEach((l,a,c,h)=>{s==null&&(s=h)}),n.setSelection(S.near(n.doc.resolve(s),t))}var Si=1,$t=2,wi=4,$n=class extends Jt{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Si)&~$t,this.storedMarks=null,this}get selectionSet(){return(this.updated&Si)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=$t,this}ensureMarks(e){return M.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&$t)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~$t,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let r=this.selection;return t&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||M.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,r){let i=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(r==null&&(r=t),r=r??t,!e)return this.deleteRange(t,r);let o=this.storedMarks;if(!o){let s=this.doc.resolve(t);o=r==t?s.marks():s.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(t,r,i.text(e,o)),this.selection.empty||this.setSelection(S.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=wi,this}get scrolledIntoView(){return(this.updated&wi)>0}};function Mi(n,e){return!e||!n?n:n.bind(e)}var ve=class{constructor(e,t,r){this.name=e,this.init=Mi(t.init,r),this.apply=Mi(t.apply,r)}},Pl=[new ve("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new ve("selection",{init(n,e){return n.selection||S.atStart(e.doc)},apply(n){return n.selection}}),new ve("storedMarks",{init(n){return n.storedMarks||null},apply(n,e,t,r){return r.selection.$cursor?n.storedMarks:null}}),new ve("scrollToSelection",{init(){return 0},apply(n,e){return n.scrolledIntoView?e+1:e}})],ut=class{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Pl.slice(),t&&t.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new ve(r.key,r.spec.state,r))})}},pt=class n{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=t){let i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],r=this.applyInner(e),i=null;for(;;){let o=!1;for(let s=0;s<this.config.plugins.length;s++){let l=this.config.plugins[s];if(l.spec.appendTransaction){let a=i?i[s].n:0,c=i?i[s].state:this,h=a<t.length&&l.spec.appendTransaction.call(l,a?t.slice(a):t,c,r);if(h&&r.filterTransaction(h,s)){if(h.setMeta("appendedTransaction",e),!i){i=[];for(let f=0;f<this.config.plugins.length;f++)i.push(f<s?{state:r,n:t.length}:{state:this,n:0})}t.push(h),r=r.applyInner(h),o=!0}i&&(i[s]={state:r,n:t.length})}}if(!o)return{state:r,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new n(this.config),r=this.config.fields;for(let i=0;i<r.length;i++){let o=r[i];t[o.name]=o.apply(e,this[o.name],this,t)}return t}get tr(){return new $n(this)}static create(e){let t=new ut(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new n(t);for(let i=0;i<t.fields.length;i++)r[t.fields[i].name]=t.fields[i].init(e,r);return r}reconfigure(e){let t=new ut(this.schema,e.plugins),r=t.fields,i=new n(t);for(let o=0;o<r.length;o++){let s=r[o].name;i[s]=this.hasOwnProperty(s)?this[s]:r[o].init(e,i)}return i}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[r],o=i.spec.state;o&&o.toJSON&&(t[r]=o.toJSON.call(i,this[i.key]))}return t}static fromJSON(e,t,r){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new ut(e.schema,e.plugins),o=new n(i);return i.fields.forEach(s=>{if(s.name=="doc")o.doc=te.fromJSON(e.schema,t.doc);else if(s.name=="selection")o.selection=S.fromJSON(o.doc,t.selection);else if(s.name=="storedMarks")t.storedMarks&&(o.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let l in r){let a=r[l],c=a.spec.state;if(a.key==s.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(t,l)){o[s.name]=c.fromJSON.call(a,e,t[l],o);return}}o[s.name]=s.init(e,o)}}),o}};function Ci(n,e,t){for(let r in n){let i=n[r];i instanceof Function?i=i.bind(e):r=="handleDOMEvents"&&(i=Ci(i,e,{})),t[r]=i}return t}var D=class{constructor(e){this.spec=e,this.props={},e.props&&Ci(e.props,this,this.props),this.key=e.key?e.key.key:Ti("plugin")}getState(e){return e[this.key]}},qn=Object.create(null);function Ti(n){return n in qn?n+"$"+ ++qn[n]:(qn[n]=0,n+"$")}var Re=class{constructor(e="key"){this.key=Ti(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};var F=function(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e},xt=function(n){let e=n.assignedSlot||n.parentNode;return e&&e.nodeType==11?e.host:e},Oi=null,ce=function(n,e,t){let r=Oi||(Oi=document.createRange());return r.setEnd(n,t??n.nodeValue.length),r.setStart(n,e||0),r},qe=function(n,e,t,r){return t&&(Ni(n,e,t,r,-1)||Ni(n,e,t,r,1))},vl=/^(img|br|input|textarea|hr)$/i;function Ni(n,e,t,r,i){for(;;){if(n==t&&e==r)return!0;if(e==(i<0?0:ne(n))){let o=n.parentNode;if(!o||o.nodeType!=1||ur(n)||vl.test(n.nodeName)||n.contentEditable=="false")return!1;e=F(n)+(i<0?0:1),n=o}else if(n.nodeType==1){if(n=n.childNodes[e+(i<0?-1:0)],n.contentEditable=="false")return!1;e=i<0?ne(n):0}else return!1}}function ne(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Rl(n,e,t){for(let r=e==0,i=e==ne(n);r||i;){if(n==t)return!0;let o=F(n);if(n=n.parentNode,!n)return!1;r=r&&o==0,i=i&&o==ne(n)}}function ur(n){let e;for(let t=n;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==n||e.contentDOM==n)}var nn=function(n){return n.focusNode&&qe(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)};function Be(n,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=n,t.key=t.code=e,t}function Bl(n){let e=n.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function zl(n,e,t){if(n.caretPositionFromPoint)try{let r=n.caretPositionFromPoint(e,t);if(r)return{node:r.offsetNode,offset:r.offset}}catch{}if(n.caretRangeFromPoint){let r=n.caretRangeFromPoint(e,t);if(r)return{node:r.startContainer,offset:r.startOffset}}}var re=typeof navigator<"u"?navigator:null,Di=typeof document<"u"?document:null,we=re&&re.userAgent||"",Yn=/Edge\/(\d+)/.exec(we),oo=/MSIE \d/.exec(we),Xn=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(we),$=!!(oo||Xn||Yn),ke=oo?document.documentMode:Xn?+Xn[1]:Yn?+Yn[1]:0,ee=!$&&/gecko\/(\d+)/i.test(we);ee&&+(/Firefox\/(\d+)/.exec(we)||[0,0])[1];var Qn=!$&&/Chrome\/(\d+)/.exec(we),R=!!Qn,Fl=Qn?+Qn[1]:0,V=!$&&!!re&&/Apple Computer/.test(re.vendor),Ze=V&&(/Mobile\/\w+/.test(we)||!!re&&re.maxTouchPoints>2),X=Ze||(re?/Mac/.test(re.platform):!1),Vl=re?/Win/.test(re.platform):!1,_=/Android \d/.test(we),wt=!!Di&&"webkitFontSmoothing"in Di.documentElement.style,Ll=wt?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Jl(n){return{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function ae(n,e){return typeof n=="number"?n:n[e]}function ql(n){let e=n.getBoundingClientRect(),t=e.width/n.offsetWidth||1,r=e.height/n.offsetHeight||1;return{left:e.left,right:e.left+n.clientWidth*t,top:e.top,bottom:e.top+n.clientHeight*r}}function Ei(n,e,t){let r=n.someProp("scrollThreshold")||0,i=n.someProp("scrollMargin")||5,o=n.dom.ownerDocument;for(let s=t||n.dom;s;s=xt(s)){if(s.nodeType!=1)continue;let l=s,a=l==o.body,c=a?Jl(o):ql(l),h=0,f=0;if(e.top<c.top+ae(r,"top")?f=-(c.top-e.top+ae(i,"top")):e.bottom>c.bottom-ae(r,"bottom")&&(f=e.bottom-e.top>c.bottom-c.top?e.top+ae(i,"top")-c.top:e.bottom-c.bottom+ae(i,"bottom")),e.left<c.left+ae(r,"left")?h=-(c.left-e.left+ae(i,"left")):e.right>c.right-ae(r,"right")&&(h=e.right-c.right+ae(i,"right")),h||f)if(a)o.defaultView.scrollBy(h,f);else{let d=l.scrollLeft,p=l.scrollTop;f&&(l.scrollTop+=f),h&&(l.scrollLeft+=h);let u=l.scrollLeft-d,m=l.scrollTop-p;e={left:e.left-u,top:e.top-m,right:e.right-u,bottom:e.bottom-m}}if(a||/^(fixed|sticky)$/.test(getComputedStyle(s).position))break}}function Wl(n){let e=n.dom.getBoundingClientRect(),t=Math.max(0,e.top),r,i;for(let o=(e.left+e.right)/2,s=t+1;s<Math.min(innerHeight,e.bottom);s+=5){let l=n.root.elementFromPoint(o,s);if(!l||l==n.dom||!n.dom.contains(l))continue;let a=l.getBoundingClientRect();if(a.top>=t-20){r=l,i=a.top;break}}return{refDOM:r,refTop:i,stack:so(n.dom)}}function so(n){let e=[],t=n.ownerDocument;for(let r=n;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),n!=t);r=xt(r));return e}function Kl({refDOM:n,refTop:e,stack:t}){let r=n?n.getBoundingClientRect().top:0;lo(t,r==0?0:r-e)}function lo(n,e){for(let t=0;t<n.length;t++){let{dom:r,top:i,left:o}=n[t];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=o&&(r.scrollLeft=o)}}var Ge=null;function $l(n){if(n.setActive)return n.setActive();if(Ge)return n.focus(Ge);let e=so(n);n.focus(Ge==null?{get preventScroll(){return Ge={preventScroll:!0},!0}}:void 0),Ge||(Ge=!1,lo(e,0))}function ao(n,e){let t,r=2e8,i,o=0,s=e.top,l=e.top,a,c;for(let h=n.firstChild,f=0;h;h=h.nextSibling,f++){let d;if(h.nodeType==1)d=h.getClientRects();else if(h.nodeType==3)d=ce(h).getClientRects();else continue;for(let p=0;p<d.length;p++){let u=d[p];if(u.top<=s&&u.bottom>=l){s=Math.max(u.bottom,s),l=Math.min(u.top,l);let m=u.left>e.left?u.left-e.left:u.right<e.left?e.left-u.right:0;if(m<r){t=h,r=m,i=m&&t.nodeType==3?{left:u.right<e.left?u.right:u.left,top:e.top}:e,h.nodeType==1&&m&&(o=f+(e.left>=(u.left+u.right)/2?1:0));continue}}else u.top>e.top&&!a&&u.left<=e.left&&u.right>=e.left&&(a=h,c={left:Math.max(u.left,Math.min(u.right,e.left)),top:u.top});!t&&(e.left>=u.right&&e.top>=u.top||e.left>=u.left&&e.top>=u.bottom)&&(o=f+1)}}return!t&&a&&(t=a,i=c,r=0),t&&t.nodeType==3?Ul(t,i):!t||r&&t.nodeType==1?{node:n,offset:o}:ao(t,i)}function Ul(n,e){let t=n.nodeValue.length,r=document.createRange();for(let i=0;i<t;i++){r.setEnd(n,i+1),r.setStart(n,i);let o=ye(r,1);if(o.top!=o.bottom&&pr(e,o))return{node:n,offset:i+(e.left>=(o.left+o.right)/2?1:0)}}return{node:n,offset:0}}function pr(n,e){return n.left>=e.left-1&&n.left<=e.right+1&&n.top>=e.top-1&&n.top<=e.bottom+1}function Hl(n,e){let t=n.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<n.getBoundingClientRect().left?t:n}function jl(n,e,t){let{node:r,offset:i}=ao(e,t),o=-1;if(r.nodeType==1&&!r.firstChild){let s=r.getBoundingClientRect();o=s.left!=s.right&&t.left>(s.left+s.right)/2?1:-1}return n.docView.posFromDOM(r,i,o)}function Gl(n,e,t,r){let i=-1;for(let o=e,s=!1;o!=n.dom;){let l=n.docView.nearestDesc(o,!0);if(!l)return null;if(l.dom.nodeType==1&&(l.node.isBlock&&l.parent&&!s||!l.contentDOM)){let a=l.dom.getBoundingClientRect();if(l.node.isBlock&&l.parent&&!s&&(s=!0,a.left>r.left||a.top>r.top?i=l.posBefore:(a.right<r.left||a.bottom<r.top)&&(i=l.posAfter)),!l.contentDOM&&i<0&&!l.node.isText)return(l.node.isBlock?r.top<(a.top+a.bottom)/2:r.left<(a.left+a.right)/2)?l.posBefore:l.posAfter}o=l.dom.parentNode}return i>-1?i:n.docView.posFromDOM(e,t,-1)}function co(n,e,t){let r=n.childNodes.length;if(r&&t.top<t.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-t.top)/(t.bottom-t.top))-2)),o=i;;){let s=n.childNodes[o];if(s.nodeType==1){let l=s.getClientRects();for(let a=0;a<l.length;a++){let c=l[a];if(pr(e,c))return co(s,e,c)}}if((o=(o+1)%r)==i)break}return n}function Yl(n,e){let t=n.dom.ownerDocument,r,i=0,o=zl(t,e.left,e.top);o&&({node:r,offset:i}=o);let s=(n.root.elementFromPoint?n.root:t).elementFromPoint(e.left,e.top),l;if(!s||!n.dom.contains(s.nodeType!=1?s.parentNode:s)){let c=n.dom.getBoundingClientRect();if(!pr(e,c)||(s=co(n.dom,e,c),!s))return null}if(V)for(let c=s;r&&c;c=xt(c))c.draggable&&(r=void 0);if(s=Hl(s,e),r){if(ee&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let h=r.childNodes[i],f;h.nodeName=="IMG"&&(f=h.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&i++}let c;wt&&i&&r.nodeType==1&&(c=r.childNodes[i-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&i--,r==n.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?l=n.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!="BR")&&(l=Gl(n,r,i,e))}l==null&&(l=jl(n,s,e));let a=n.docView.nearestDesc(s,!0);return{pos:l,inside:a?a.posAtStart-a.border:-1}}function Ai(n){return n.top<n.bottom||n.left<n.right}function ye(n,e){let t=n.getClientRects();if(t.length){let r=t[e<0?0:t.length-1];if(Ai(r))return r}return Array.prototype.find.call(t,Ai)||n.getBoundingClientRect()}var Xl=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function ho(n,e,t){let{node:r,offset:i,atom:o}=n.docView.domFromPos(e,t<0?-1:1),s=wt||ee;if(r.nodeType==3)if(s&&(Xl.test(r.nodeValue)||(t<0?!i:i==r.nodeValue.length))){let a=ye(ce(r,i,i),t);if(ee&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let c=ye(ce(r,i-1,i-1),-1);if(c.top==a.top){let h=ye(ce(r,i,i+1),-1);if(h.top!=a.top)return mt(h,h.left<c.left)}}return a}else{let a=i,c=i,h=t<0?1:-1;return t<0&&!i?(c++,h=-1):t>=0&&i==r.nodeValue.length?(a--,h=1):t<0?a--:c++,mt(ye(ce(r,a,c),h),h<0)}if(!n.state.doc.resolve(e-(o||0)).parent.inlineContent){if(o==null&&i&&(t<0||i==ne(r))){let a=r.childNodes[i-1];if(a.nodeType==1)return Un(a.getBoundingClientRect(),!1)}if(o==null&&i<ne(r)){let a=r.childNodes[i];if(a.nodeType==1)return Un(a.getBoundingClientRect(),!0)}return Un(r.getBoundingClientRect(),t>=0)}if(o==null&&i&&(t<0||i==ne(r))){let a=r.childNodes[i-1],c=a.nodeType==3?ce(a,ne(a)-(s?0:1)):a.nodeType==1&&(a.nodeName!="BR"||!a.nextSibling)?a:null;if(c)return mt(ye(c,1),!1)}if(o==null&&i<ne(r)){let a=r.childNodes[i];for(;a.pmViewDesc&&a.pmViewDesc.ignoreForCoords;)a=a.nextSibling;let c=a?a.nodeType==3?ce(a,0,s?0:1):a.nodeType==1?a:null:null;if(c)return mt(ye(c,-1),!0)}return mt(ye(r.nodeType==3?ce(r):r,-t),t>=0)}function mt(n,e){if(n.width==0)return n;let t=e?n.left:n.right;return{top:n.top,bottom:n.bottom,left:t,right:t}}function Un(n,e){if(n.height==0)return n;let t=e?n.top:n.bottom;return{top:t,bottom:t,left:n.left,right:n.right}}function fo(n,e,t){let r=n.state,i=n.root.activeElement;r!=e&&n.updateState(e),i!=n.dom&&n.focus();try{return t()}finally{r!=e&&n.updateState(r),i!=n.dom&&i&&i.focus()}}function Ql(n,e,t){let r=e.selection,i=t=="up"?r.$from:r.$to;return fo(n,e,()=>{let{node:o}=n.docView.domFromPos(i.pos,t=="up"?-1:1);for(;;){let l=n.docView.nearestDesc(o,!0);if(!l)break;if(l.node.isBlock){o=l.contentDOM||l.dom;break}o=l.dom.parentNode}let s=ho(n,i.pos,1);for(let l=o.firstChild;l;l=l.nextSibling){let a;if(l.nodeType==1)a=l.getClientRects();else if(l.nodeType==3)a=ce(l,0,l.nodeValue.length).getClientRects();else continue;for(let c=0;c<a.length;c++){let h=a[c];if(h.bottom>h.top+1&&(t=="up"?s.top-h.top>(h.bottom-s.top)*2:h.bottom-s.bottom>(s.bottom-h.top)*2))return!1}}return!0})}var Zl=/[\u0590-\u08ac]/;function _l(n,e,t){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,o=!i,s=i==r.parent.content.size,l=n.domSelection();return!Zl.test(r.parent.textContent)||!l.modify?t=="left"||t=="backward"?o:s:fo(n,e,()=>{let{focusNode:a,focusOffset:c,anchorNode:h,anchorOffset:f}=n.domSelectionRange(),d=l.caretBidiLevel;l.modify("move",t,"character");let p=r.depth?n.docView.domAfterPos(r.before()):n.dom,{focusNode:u,focusOffset:m}=n.domSelectionRange(),g=u&&!p.contains(u.nodeType==1?u:u.parentNode)||a==u&&c==m;try{l.collapse(h,f),a&&(a!=h||c!=f)&&l.extend&&l.extend(a,c)}catch{}return d!=null&&(l.caretBidiLevel=d),g})}var Ii=null,Pi=null,vi=!1;function ea(n,e,t){return Ii==e&&Pi==t?vi:(Ii=e,Pi=t,vi=t=="up"||t=="down"?Ql(n,e,t):_l(n,e,t))}var Q=0,Ri=1,ze=2,ie=3,We=class{constructor(e,t,r,i){this.parent=e,this.children=t,this.dom=r,this.contentDOM=i,this.dirty=Q,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,r=this.posAtStart;;t++){let i=this.children[t];if(i==e)return r;r+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let o,s;if(e==this.contentDOM)o=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;o=e.previousSibling}for(;o&&!((s=o.pmViewDesc)&&s.parent==this);)o=o.previousSibling;return o?this.posBeforeChild(s)+s.size:this.posAtStart}else{let o,s;if(e==this.contentDOM)o=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;o=e.nextSibling}for(;o&&!((s=o.pmViewDesc)&&s.parent==this);)o=o.nextSibling;return o?this.posBeforeChild(s):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=t>F(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let o=e;;o=o.parentNode){if(o==this.dom){i=!1;break}if(o.previousSibling)break}if(i==null&&t==e.childNodes.length)for(let o=e;;o=o.parentNode){if(o==this.dom){i=!0;break}if(o.nextSibling)break}}return i??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let r=!0,i=e;i;i=i.parentNode){let o=this.getDesc(i),s;if(o&&(!t||o.node))if(r&&(s=o.nodeDOM)&&!(s.nodeType==1?s.contains(e.nodeType==1?e:e.parentNode):s==e))r=!1;else return o}}getDesc(e){let t=e.pmViewDesc;for(let r=t;r;r=r.parent)if(r==this)return t}posFromDOM(e,t,r){for(let i=e;i;i=i.parentNode){let o=this.getDesc(i);if(o)return o.localPosFromDOM(e,t,r)}return-1}descAt(e){for(let t=0,r=0;t<this.children.length;t++){let i=this.children[t],o=r+i.size;if(r==e&&o!=r){for(;!i.border&&i.children.length;)i=i.children[0];return i}if(e<o)return i.descAt(e-r-i.border);r=o}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,i=0;for(let o=0;r<this.children.length;r++){let s=this.children[r],l=o+s.size;if(l>e||s instanceof Gt){i=e-o;break}o=l}if(i)return this.children[r].domFromPos(i-this.children[r].border,t);for(let o;r&&!(o=this.children[r-1]).size&&o instanceof Ht&&o.side>=0;r--);if(t<=0){let o,s=!0;for(;o=r?this.children[r-1]:null,!(!o||o.dom.parentNode==this.contentDOM);r--,s=!1);return o&&t&&s&&!o.border&&!o.domAtom?o.domFromPos(o.size,t):{node:this.contentDOM,offset:o?F(o.dom)+1:0}}else{let o,s=!0;for(;o=r<this.children.length?this.children[r]:null,!(!o||o.dom.parentNode==this.contentDOM);r++,s=!1);return o&&s&&!o.border&&!o.domAtom?o.domFromPos(0,t):{node:this.contentDOM,offset:o?F(o.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,o=-1;for(let s=r,l=0;;l++){let a=this.children[l],c=s+a.size;if(i==-1&&e<=c){let h=s+a.border;if(e>=h&&t<=c-a.border&&a.node&&a.contentDOM&&this.contentDOM.contains(a.contentDOM))return a.parseRange(e,t,h);e=s;for(let f=l;f>0;f--){let d=this.children[f-1];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(1)){i=F(d.dom)+1;break}e-=d.size}i==-1&&(i=0)}if(i>-1&&(c>t||l==this.children.length-1)){t=c;for(let h=l+1;h<this.children.length;h++){let f=this.children[h];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){o=F(f.dom);break}t+=f.size}o==-1&&(o=this.contentDOM.childNodes.length);break}s=c}return{node:this.contentDOM,from:e,to:t,fromOffset:i,toOffset:o}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:r}=this.domFromPos(e,0);if(t.nodeType!=1||r==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[r]}setSelection(e,t,r,i=!1){let o=Math.min(e,t),s=Math.max(e,t);for(let d=0,p=0;d<this.children.length;d++){let u=this.children[d],m=p+u.size;if(o>p&&s<m)return u.setSelection(e-p-u.border,t-p-u.border,r,i);p=m}let l=this.domFromPos(e,e?-1:1),a=t==e?l:this.domFromPos(t,t?-1:1),c=r.getSelection(),h=!1;if((ee||V)&&e==t){let{node:d,offset:p}=l;if(d.nodeType==3){if(h=!!(p&&d.nodeValue[p-1]==`
`),h&&p==d.nodeValue.length)for(let u=d,m;u;u=u.parentNode){if(m=u.nextSibling){m.nodeName=="BR"&&(l=a={node:m.parentNode,offset:F(m)+1});break}let g=u.pmViewDesc;if(g&&g.node&&g.node.isBlock)break}}else{let u=d.childNodes[p-1];h=u&&(u.nodeName=="BR"||u.contentEditable=="false")}}if(ee&&c.focusNode&&c.focusNode!=a.node&&c.focusNode.nodeType==1){let d=c.focusNode.childNodes[c.focusOffset];d&&d.contentEditable=="false"&&(i=!0)}if(!(i||h&&V)&&qe(l.node,l.offset,c.anchorNode,c.anchorOffset)&&qe(a.node,a.offset,c.focusNode,c.focusOffset))return;let f=!1;if((c.extend||e==t)&&!h){c.collapse(l.node,l.offset);try{e!=t&&c.extend(a.node,a.offset),f=!0}catch{}}if(!f){if(e>t){let p=l;l=a,a=p}let d=document.createRange();d.setEnd(a.node,a.offset),d.setStart(l.node,l.offset),c.removeAllRanges(),c.addRange(d)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let r=0,i=0;i<this.children.length;i++){let o=this.children[i],s=r+o.size;if(r==s?e<=s&&t>=r:e<s&&t>r){let l=r+o.border,a=s-o.border;if(e>=l&&t<=a){this.dirty=e==r||t==s?ze:Ri,e==l&&t==a&&(o.contentLost||o.dom.parentNode!=this.contentDOM)?o.dirty=ie:o.markDirty(e-l,t-l);return}else o.dirty=o.dom==o.contentDOM&&o.dom.parentNode==this.contentDOM&&!o.children.length?ze:ie}r=s}this.dirty=ze}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let r=e==1?ze:Ri;t.dirty<r&&(t.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}},Ht=class extends We{constructor(e,t,r,i){let o,s=t.type.toDOM;if(typeof s=="function"&&(s=s(r,()=>{if(!o)return i;if(o.parent)return o.parent.posBeforeChild(o)})),!t.type.spec.raw){if(s.nodeType!=1){let l=document.createElement("span");l.appendChild(s),s=l}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(e,[],s,null),this.widget=t,this.widget=t,o=this}matchesWidget(e){return this.dirty==Q&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}},Zn=class extends We{constructor(e,t,r,i){super(e,[],t,null),this.textDOM=r,this.text=i}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}},_e=class n extends We{constructor(e,t,r,i){super(e,[],r,i),this.mark=t}static create(e,t,r,i){let o=i.nodeViews[t.type.name],s=o&&o(t,i,r);return(!s||!s.dom)&&(s=Ie.renderSpec(document,t.type.spec.toDOM(t,r))),new n(e,t,s.dom,s.contentDOM||s.dom)}parseRule(){return this.dirty&ie||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=ie&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=Q){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Q}}slice(e,t,r){let i=n.create(this.parent,this.mark,!0,r),o=this.children,s=this.size;t<s&&(o=rr(o,t,s,r)),e>0&&(o=rr(o,0,e,r));for(let l=0;l<o.length;l++)o[l].parent=i;return i.children=o,i}},Se=class n extends We{constructor(e,t,r,i,o,s,l,a,c){super(e,[],o,s),this.node=t,this.outerDeco=r,this.innerDeco=i,this.nodeDOM=l}static create(e,t,r,i,o,s){let l=o.nodeViews[t.type.name],a,c=l&&l(t,o,()=>{if(!a)return s;if(a.parent)return a.parent.posBeforeChild(a)},r,i),h=c&&c.dom,f=c&&c.contentDOM;if(t.isText){if(!h)h=document.createTextNode(t.text);else if(h.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else h||({dom:h,contentDOM:f}=Ie.renderSpec(document,t.type.spec.toDOM(t)));!f&&!t.isText&&h.nodeName!="BR"&&(h.hasAttribute("contenteditable")||(h.contentEditable="false"),t.type.spec.draggable&&(h.draggable=!0));let d=h;return h=mo(h,r,t),c?a=new _n(e,t,r,i,h,f||null,d,c,o,s+1):t.isText?new jt(e,t,r,i,h,d,o):new n(e,t,r,i,h,f||null,d,o,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let r=this.children[t];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>y.empty)}return e}matchesNode(e,t,r){return this.dirty==Q&&e.eq(this.node)&&tr(t,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let r=this.node.inlineContent,i=t,o=e.composing?this.localCompositionInfo(e,t):null,s=o&&o.pos>-1?o:null,l=o&&o.pos<0,a=new nr(this,s&&s.node,e);ia(this.node,this.innerDeco,(c,h,f)=>{c.spec.marks?a.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!f&&a.syncToMarks(h==this.node.childCount?M.none:this.node.child(h).marks,r,e),a.placeWidget(c,e,i)},(c,h,f,d)=>{a.syncToMarks(c.marks,r,e);let p;a.findNodeMatch(c,h,f,d)||l&&e.state.selection.from>i&&e.state.selection.to<i+c.nodeSize&&(p=a.findIndexWithChild(o.node))>-1&&a.updateNodeAt(c,h,f,p,e)||a.updateNextNode(c,h,f,e,d,i)||a.addNode(c,h,f,e,i),i+=c.nodeSize}),a.syncToMarks([],r,e),this.node.isTextblock&&a.addTextblockHacks(),a.destroyRest(),(a.changed||this.dirty==ze)&&(s&&this.protectLocalComposition(e,s),uo(this.contentDOM,this.children,e),Ze&&oa(this.dom))}localCompositionInfo(e,t){let{from:r,to:i}=e.state.selection;if(!(e.state.selection instanceof C)||r<t||i>t+this.node.content.size)return null;let o=e.domSelectionRange(),s=sa(o.focusNode,o.focusOffset);if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let l=s.nodeValue,a=la(this.node.content,l,r-t,i-t);return a<0?null:{node:s,pos:a,text:l}}else return{node:s,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:r,text:i}){if(this.getDesc(t))return;let o=t;for(;o.parentNode!=this.contentDOM;o=o.parentNode){for(;o.previousSibling;)o.parentNode.removeChild(o.previousSibling);for(;o.nextSibling;)o.parentNode.removeChild(o.nextSibling);o.pmViewDesc&&(o.pmViewDesc=void 0)}let s=new Zn(this,o,t,i);e.input.compositionNodes.push(s),this.children=rr(this.children,r,r+i.length,e,s)}update(e,t,r,i){return this.dirty==ie||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,r,i),!0)}updateInner(e,t,r,i){this.updateOuterDeco(t),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=Q}updateOuterDeco(e){if(tr(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=po(this.dom,this.nodeDOM,er(this.outerDeco,this.node,t),er(e,this.node,t)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}};function Bi(n,e,t,r,i){mo(r,e,n);let o=new Se(void 0,n,e,t,r,r,r,i,0);return o.contentDOM&&o.updateChildren(i,0),o}var jt=class n extends Se{constructor(e,t,r,i,o,s,l){super(e,t,r,i,o,null,s,l,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,r,i){return this.dirty==ie||this.dirty!=Q&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=Q||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=Q,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,r){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,r){let i=this.node.cut(e,t),o=document.createTextNode(i.text);return new n(this.parent,i,this.outerDeco,this.innerDeco,o,o,r)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=ie)}get domAtom(){return!1}},Gt=class extends We{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Q&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}},_n=class extends Se{constructor(e,t,r,i,o,s,l,a,c,h){super(e,t,r,i,o,s,l,c,h),this.spec=a}update(e,t,r,i){if(this.dirty==ie)return!1;if(this.spec.update){let o=this.spec.update(e,t,r);return o&&this.updateInner(e,t,r,i),o}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,r,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,r,i){this.spec.setSelection?this.spec.setSelection(e,t,r):super.setSelection(e,t,r,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}};function uo(n,e,t){let r=n.firstChild,i=!1;for(let o=0;o<e.length;o++){let s=e[o],l=s.dom;if(l.parentNode==n){for(;l!=r;)r=zi(r),i=!0;r=r.nextSibling}else i=!0,n.insertBefore(l,r);if(s instanceof _e){let a=r?r.previousSibling:n.lastChild;uo(s.contentDOM,s.children,t),r=a?a.nextSibling:n.firstChild}}for(;r;)r=zi(r),i=!0;i&&t.trackWrites==n&&(t.trackWrites=null)}var gt=function(n){n&&(this.nodeName=n)};gt.prototype=Object.create(null);var Fe=[new gt];function er(n,e,t){if(n.length==0)return Fe;let r=t?Fe[0]:new gt,i=[r];for(let o=0;o<n.length;o++){let s=n[o].type.attrs;if(s){s.nodeName&&i.push(r=new gt(s.nodeName));for(let l in s){let a=s[l];a!=null&&(t&&i.length==1&&i.push(r=new gt(e.isInline?"span":"div")),l=="class"?r.class=(r.class?r.class+" ":"")+a:l=="style"?r.style=(r.style?r.style+";":"")+a:l!="nodeName"&&(r[l]=a))}}}return i}function po(n,e,t,r){if(t==Fe&&r==Fe)return e;let i=e;for(let o=0;o<r.length;o++){let s=r[o],l=t[o];if(o){let a;l&&l.nodeName==s.nodeName&&i!=n&&(a=i.parentNode)&&a.nodeName.toLowerCase()==s.nodeName||(a=document.createElement(s.nodeName),a.pmIsDeco=!0,a.appendChild(i),l=Fe[0]),i=a}ta(i,l||Fe[0],s)}return i}function ta(n,e,t){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in t)&&n.removeAttribute(r);for(let r in t)r!="class"&&r!="style"&&r!="nodeName"&&t[r]!=e[r]&&n.setAttribute(r,t[r]);if(e.class!=t.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=t.class?t.class.split(" ").filter(Boolean):[];for(let o=0;o<r.length;o++)i.indexOf(r[o])==-1&&n.classList.remove(r[o]);for(let o=0;o<i.length;o++)r.indexOf(i[o])==-1&&n.classList.add(i[o]);n.classList.length==0&&n.removeAttribute("class")}if(e.style!=t.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=r.exec(e.style);)n.style.removeProperty(i[1])}t.style&&(n.style.cssText+=t.style)}}function mo(n,e,t){return po(n,n,Fe,er(e,t,n.nodeType!=1))}function tr(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].type.eq(e[t].type))return!1;return!0}function zi(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}var nr=class{constructor(e,t,r){this.lock=t,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=na(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let r=e;r<t;r++)this.top.children[r].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,r){let i=0,o=this.stack.length>>1,s=Math.min(o,e.length);for(;i<s&&(i==o-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<o;)this.destroyRest(),this.top.dirty=Q,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<e.length;){this.stack.push(this.top,this.index+1);let l=-1;for(let a=this.index;a<Math.min(this.index+3,this.top.children.length);a++){let c=this.top.children[a];if(c.matchesMark(e[o])&&!this.isLocked(c.dom)){l=a;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let a=_e.create(this.top,e[o],t,r);this.top.children.splice(this.index,0,a),this.top=a,this.changed=!0}this.index=0,o++}}findNodeMatch(e,t,r,i){let o=-1,s;if(i>=this.preMatch.index&&(s=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&s.matchesNode(e,t,r))o=this.top.children.indexOf(s,this.index);else for(let l=this.index,a=Math.min(this.top.children.length,l+5);l<a;l++){let c=this.top.children[l];if(c.matchesNode(e,t,r)&&!this.preMatch.matched.has(c)){o=l;break}}return o<0?!1:(this.destroyBetween(this.index,o),this.index++,!0)}updateNodeAt(e,t,r,i,o){let s=this.top.children[i];return s.dirty==ie&&s.dom==s.contentDOM&&(s.dirty=ze),s.update(e,t,r,o)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==r)return i}return-1}e=t}}updateNextNode(e,t,r,i,o,s){for(let l=this.index;l<this.top.children.length;l++){let a=this.top.children[l];if(a instanceof Se){let c=this.preMatch.matched.get(a);if(c!=null&&c!=o)return!1;let h=a.dom,f,d=this.isLocked(h)&&!(e.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==e.text&&a.dirty!=ie&&tr(t,a.outerDeco));if(!d&&a.update(e,t,r,i))return this.destroyBetween(this.index,l),a.dom!=h&&(this.changed=!0),this.index++,!0;if(!d&&(f=this.recreateWrapper(a,e,t,r,i,s)))return this.top.children[this.index]=f,f.contentDOM&&(f.dirty=ze,f.updateChildren(i,s+1),f.dirty=Q),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,r,i,o,s){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content))return null;let l=Se.create(this.top,t,r,i,o,s);if(l.contentDOM){l.children=e.children,e.children=[];for(let a of l.children)a.parent=l}return e.destroy(),l}addNode(e,t,r,i,o){let s=Se.create(this.top,e,t,r,i,o);s.contentDOM&&s.updateChildren(i,o+1),this.top.children.splice(this.index++,0,s),this.changed=!0}placeWidget(e,t,r){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let o=new Ht(this.top,e,t,r);this.top.children.splice(this.index++,0,o),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof _e;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof jt)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((V||R)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let i=new Gt(this.top,[],r,null);t!=this.top?t.children.push(i):t.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}};function na(n,e){let t=e,r=t.children.length,i=n.childCount,o=new Map,s=[];e:for(;i>0;){let l;for(;;)if(r){let c=t.children[r-1];if(c instanceof _e)t=c,r=c.children.length;else{l=c,r--;break}}else{if(t==e)break e;r=t.parent.children.indexOf(t),t=t.parent}let a=l.node;if(a){if(a!=n.child(i-1))break;--i,o.set(l,i),s.push(l)}}return{index:i,matched:o,matches:s.reverse()}}function ra(n,e){return n.type.side-e.type.side}function ia(n,e,t,r){let i=e.locals(n),o=0;if(i.length==0){for(let c=0;c<n.childCount;c++){let h=n.child(c);r(h,i,e.forChild(o,h),c),o+=h.nodeSize}return}let s=0,l=[],a=null;for(let c=0;;){let h,f;for(;s<i.length&&i[s].to==o;){let g=i[s++];g.widget&&(h?(f||(f=[h])).push(g):h=g)}if(h)if(f){f.sort(ra);for(let g=0;g<f.length;g++)t(f[g],c,!!a)}else t(h,c,!!a);let d,p;if(a)p=-1,d=a,a=null;else if(c<n.childCount)p=c,d=n.child(c++);else break;for(let g=0;g<l.length;g++)l[g].to<=o&&l.splice(g--,1);for(;s<i.length&&i[s].from<=o&&i[s].to>o;)l.push(i[s++]);let u=o+d.nodeSize;if(d.isText){let g=u;s<i.length&&i[s].from<g&&(g=i[s].from);for(let k=0;k<l.length;k++)l[k].to<g&&(g=l[k].to);g<u&&(a=d.cut(g-o),d=d.cut(0,g-o),u=g,p=-1)}else for(;s<i.length&&i[s].to<u;)s++;let m=d.isInline&&!d.isLeaf?l.filter(g=>!g.inline):l.slice();r(d,m,e.forChild(o,d),p),o=u}}function oa(n){if(n.nodeName=="UL"||n.nodeName=="OL"){let e=n.style.cssText;n.style.cssText=e+"; list-style: square !important",window.getComputedStyle(n).listStyle,n.style.cssText=e}}function sa(n,e){for(;;){if(n.nodeType==3)return n;if(n.nodeType==1&&e>0){if(n.childNodes.length>e&&n.childNodes[e].nodeType==3)return n.childNodes[e];n=n.childNodes[e-1],e=ne(n)}else if(n.nodeType==1&&e<n.childNodes.length)n=n.childNodes[e],e=0;else return null}}function la(n,e,t,r){for(let i=0,o=0;i<n.childCount&&o<=r;){let s=n.child(i++),l=o;if(o+=s.nodeSize,!s.isText)continue;let a=s.text;for(;i<n.childCount;){let c=n.child(i++);if(o+=c.nodeSize,!c.isText)break;a+=c.text}if(o>=t){if(o>=r&&a.slice(r-e.length-l,r-l)==e)return r-e.length;let c=l<r?a.lastIndexOf(e,r-l-1):-1;if(c>=0&&c+e.length+l>=t)return l+c;if(t==r&&a.length>=r+e.length-l&&a.slice(r-l,r-l+e.length)==e)return r}}return-1}function rr(n,e,t,r,i){let o=[];for(let s=0,l=0;s<n.length;s++){let a=n[s],c=l,h=l+=a.size;c>=t||h<=e?o.push(a):(c<e&&o.push(a.slice(0,e-c,r)),i&&(o.push(i),i=void 0),h>t&&o.push(a.slice(t-c,a.size,r)))}return o}function mr(n,e=null){let t=n.domSelectionRange(),r=n.state.doc;if(!t.focusNode)return null;let i=n.docView.nearestDesc(t.focusNode),o=i&&i.size==0,s=n.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(s<0)return null;let l=r.resolve(s),a,c;if(nn(t)){for(a=l;i&&!i.node;)i=i.parent;let h=i.node;if(i&&h.isAtom&&b.isSelectable(h)&&i.parent&&!(h.isInline&&Rl(t.focusNode,t.focusOffset,i.dom))){let f=i.posBefore;c=new b(s==f?l:r.resolve(f))}}else{let h=n.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(h<0)return null;a=r.resolve(h)}if(!c){let h=e=="pointer"||n.state.selection.head<l.pos&&!o?1:-1;c=gr(n,a,l,h)}return c}function go(n){return n.editable?n.hasFocus():xo(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function he(n,e=!1){let t=n.state.selection;if(yo(n,t),!!go(n)){if(!e&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&R){let r=n.domSelectionRange(),i=n.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&qe(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)ca(n);else{let{anchor:r,head:i}=t,o,s;Fi&&!(t instanceof C)&&(t.$from.parent.inlineContent||(o=Vi(n,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(s=Vi(n,t.to))),n.docView.setSelection(r,i,n.root,e),Fi&&(o&&Li(o),s&&Li(s)),t.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&aa(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}var Fi=V||R&&Fl<63;function Vi(n,e){let{node:t,offset:r}=n.docView.domFromPos(e,0),i=r<t.childNodes.length?t.childNodes[r]:null,o=r?t.childNodes[r-1]:null;if(V&&i&&i.contentEditable=="false")return Hn(i);if((!i||i.contentEditable=="false")&&(!o||o.contentEditable=="false")){if(i)return Hn(i);if(o)return Hn(o)}}function Hn(n){return n.contentEditable="true",V&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function Li(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function aa(n){let e=n.dom.ownerDocument;e.removeEventListener("selectionchange",n.input.hideSelectionGuard);let t=n.domSelectionRange(),r=t.anchorNode,i=t.anchorOffset;e.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(t.anchorNode!=r||t.anchorOffset!=i)&&(e.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!go(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function ca(n){let e=n.domSelection(),t=document.createRange(),r=n.cursorWrapper.dom,i=r.nodeName=="IMG";i?t.setEnd(r.parentNode,F(r)+1):t.setEnd(r,0),t.collapse(!1),e.removeAllRanges(),e.addRange(t),!i&&!n.state.selection.visible&&$&&ke<=11&&(r.disabled=!0,r.disabled=!1)}function yo(n,e){if(e instanceof b){let t=n.docView.descAt(e.from);t!=n.lastSelectedViewDesc&&(Ji(n),t&&t.selectNode(),n.lastSelectedViewDesc=t)}else Ji(n)}function Ji(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function gr(n,e,t,r){return n.someProp("createSelectionBetween",i=>i(n,e,t))||C.between(e,t,r)}function qi(n){return n.editable&&!n.hasFocus()?!1:xo(n)}function xo(n){let e=n.domSelectionRange();if(!e.anchorNode)return!1;try{return n.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(n.editable||n.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function ha(n){let e=n.docView.domFromPos(n.state.selection.anchor,0),t=n.domSelectionRange();return qe(e.node,e.offset,t.anchorNode,t.anchorOffset)}function ir(n,e){let{$anchor:t,$head:r}=n.selection,i=e>0?t.max(r):t.min(r),o=i.parent.inlineContent?i.depth?n.doc.resolve(e>0?i.after():i.before()):null:i;return o&&S.findFrom(o,e)}function xe(n,e){return n.dispatch(n.state.tr.setSelection(e).scrollIntoView()),!0}function Wi(n,e,t){let r=n.state.selection;if(r instanceof C)if(t.indexOf("s")>-1){let{$head:i}=r,o=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!o||o.isText||!o.isLeaf)return!1;let s=n.state.doc.resolve(i.pos+o.nodeSize*(e<0?-1:1));return xe(n,new C(r.$anchor,s))}else if(r.empty){if(n.endOfTextblock(e>0?"forward":"backward")){let i=ir(n.state,e);return i&&i instanceof b?xe(n,i):!1}else if(!(X&&t.indexOf("m")>-1)){let i=r.$head,o=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,s;if(!o||o.isText)return!1;let l=e<0?i.pos-o.nodeSize:i.pos;return o.isAtom||(s=n.docView.descAt(l))&&!s.contentDOM?b.isSelectable(o)?xe(n,new b(e<0?n.state.doc.resolve(i.pos-o.nodeSize):i)):wt?xe(n,new C(n.state.doc.resolve(e<0?l:l+o.nodeSize))):!1:!1}}else return!1;else{if(r instanceof b&&r.node.isInline)return xe(n,new C(e>0?r.$to:r.$from));{let i=ir(n.state,e);return i?xe(n,i):!1}}}function Yt(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function yt(n,e){let t=n.pmViewDesc;return t&&t.size==0&&(e<0||n.nextSibling||n.nodeName!="BR")}function Ye(n,e){return e<0?fa(n):da(n)}function fa(n){let e=n.domSelectionRange(),t=e.focusNode,r=e.focusOffset;if(!t)return;let i,o,s=!1;for(ee&&t.nodeType==1&&r<Yt(t)&&yt(t.childNodes[r],-1)&&(s=!0);;)if(r>0){if(t.nodeType!=1)break;{let l=t.childNodes[r-1];if(yt(l,-1))i=t,o=--r;else if(l.nodeType==3)t=l,r=t.nodeValue.length;else break}}else{if(bo(t))break;{let l=t.previousSibling;for(;l&&yt(l,-1);)i=t.parentNode,o=F(l),l=l.previousSibling;if(l)t=l,r=Yt(t);else{if(t=t.parentNode,t==n.dom)break;r=0}}}s?or(n,t,r):i&&or(n,i,o)}function da(n){let e=n.domSelectionRange(),t=e.focusNode,r=e.focusOffset;if(!t)return;let i=Yt(t),o,s;for(;;)if(r<i){if(t.nodeType!=1)break;let l=t.childNodes[r];if(yt(l,1))o=t,s=++r;else break}else{if(bo(t))break;{let l=t.nextSibling;for(;l&&yt(l,1);)o=l.parentNode,s=F(l)+1,l=l.nextSibling;if(l)t=l,r=0,i=Yt(t);else{if(t=t.parentNode,t==n.dom)break;r=i=0}}}o&&or(n,o,s)}function bo(n){let e=n.pmViewDesc;return e&&e.node&&e.node.isBlock}function ua(n,e){for(;n&&e==n.childNodes.length&&!ur(n);)e=F(n)+1,n=n.parentNode;for(;n&&e<n.childNodes.length;){let t=n.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=0}}function pa(n,e){for(;n&&!e&&!ur(n);)e=F(n),n=n.parentNode;for(;n&&e;){let t=n.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=n.childNodes.length}}function or(n,e,t){if(e.nodeType!=3){let o,s;(s=ua(e,t))?(e=s,t=0):(o=pa(e,t))&&(e=o,t=o.nodeValue.length)}let r=n.domSelection();if(nn(r)){let o=document.createRange();o.setEnd(e,t),o.setStart(e,t),r.removeAllRanges(),r.addRange(o)}else r.extend&&r.extend(e,t);n.domObserver.setCurSelection();let{state:i}=n;setTimeout(()=>{n.state==i&&he(n)},50)}function Ki(n,e){let t=n.state.doc.resolve(e);if(!(R||Vl)&&t.parent.inlineContent){let i=n.coordsAtPos(e);if(e>t.start()){let o=n.coordsAtPos(e-1),s=(o.top+o.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(o.left-i.left)>1)return o.left<i.left?"ltr":"rtl"}if(e<t.end()){let o=n.coordsAtPos(e+1),s=(o.top+o.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(o.left-i.left)>1)return o.left>i.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}function $i(n,e,t){let r=n.state.selection;if(r instanceof C&&!r.empty||t.indexOf("s")>-1||X&&t.indexOf("m")>-1)return!1;let{$from:i,$to:o}=r;if(!i.parent.inlineContent||n.endOfTextblock(e<0?"up":"down")){let s=ir(n.state,e);if(s&&s instanceof b)return xe(n,s)}if(!i.parent.inlineContent){let s=e<0?i:o,l=r instanceof Y?S.near(s,e):S.findFrom(s,e);return l?xe(n,l):!1}return!1}function Ui(n,e){if(!(n.state.selection instanceof C))return!0;let{$head:t,$anchor:r,empty:i}=n.state.selection;if(!t.sameParent(r))return!0;if(!i)return!1;if(n.endOfTextblock(e>0?"forward":"backward"))return!0;let o=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(o&&!o.isText){let s=n.state.tr;return e<0?s.delete(t.pos-o.nodeSize,t.pos):s.delete(t.pos,t.pos+o.nodeSize),n.dispatch(s),!0}return!1}function Hi(n,e,t){n.domObserver.stop(),e.contentEditable=t,n.domObserver.start()}function ma(n){if(!V||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=n.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;Hi(n,r,"true"),setTimeout(()=>Hi(n,r,"false"),20)}return!1}function ga(n){let e="";return n.ctrlKey&&(e+="c"),n.metaKey&&(e+="m"),n.altKey&&(e+="a"),n.shiftKey&&(e+="s"),e}function ya(n,e){let t=e.keyCode,r=ga(e);if(t==8||X&&t==72&&r=="c")return Ui(n,-1)||Ye(n,-1);if(t==46&&!e.shiftKey||X&&t==68&&r=="c")return Ui(n,1)||Ye(n,1);if(t==13||t==27)return!0;if(t==37||X&&t==66&&r=="c"){let i=t==37?Ki(n,n.state.selection.from)=="ltr"?-1:1:-1;return Wi(n,i,r)||Ye(n,i)}else if(t==39||X&&t==70&&r=="c"){let i=t==39?Ki(n,n.state.selection.from)=="ltr"?1:-1:1;return Wi(n,i,r)||Ye(n,i)}else{if(t==38||X&&t==80&&r=="c")return $i(n,-1,r)||Ye(n,-1);if(t==40||X&&t==78&&r=="c")return ma(n)||$i(n,1,r)||Ye(n,1);if(r==(X?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function ko(n,e){n.someProp("transformCopied",p=>{e=p(e,n)});let t=[],{content:r,openStart:i,openEnd:o}=e;for(;i>1&&o>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,o--;let p=r.firstChild;t.push(p.type.name,p.attrs!=p.type.defaultAttrs?p.attrs:null),r=p.content}let s=n.someProp("clipboardSerializer")||Ie.fromSchema(n.state.schema),l=Oo(),a=l.createElement("div");a.appendChild(s.serializeFragment(r,{document:l}));let c=a.firstChild,h,f=0;for(;c&&c.nodeType==1&&(h=To[c.nodeName.toLowerCase()]);){for(let p=h.length-1;p>=0;p--){let u=l.createElement(h[p]);for(;a.firstChild;)u.appendChild(a.firstChild);a.appendChild(u),f++}c=a.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${o}${f?` -${f}`:""} ${JSON.stringify(t)}`);let d=n.someProp("clipboardTextSerializer",p=>p(e,n))||e.content.textBetween(0,e.content.size,`

`);return{dom:a,text:d}}function So(n,e,t,r,i){let o=i.parent.type.spec.code,s,l;if(!t&&!e)return null;let a=e&&(r||o||!t);if(a){if(n.someProp("transformPastedText",d=>{e=d(e,o||r,n)}),o)return e?new x(y.from(n.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):x.empty;let f=n.someProp("clipboardTextParser",d=>d(e,i,r,n));if(f)l=f;else{let d=i.marks(),{schema:p}=n.state,u=Ie.fromSchema(p);s=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let g=s.appendChild(document.createElement("p"));m&&g.appendChild(u.serializeNode(p.text(m,d)))})}}else n.someProp("transformPastedHTML",f=>{t=f(t,n)}),s=ka(t),wt&&Sa(s);let c=s&&s.querySelector("[data-pm-slice]"),h=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(h&&h[3])for(let f=+h[3];f>0;f--){let d=s.firstChild;for(;d&&d.nodeType!=1;)d=d.nextSibling;if(!d)break;s=d}if(l||(l=(n.someProp("clipboardParser")||n.someProp("domParser")||Ae.fromSchema(n.state.schema)).parseSlice(s,{preserveWhitespace:!!(a||h),context:i,ruleFromNode(d){return d.nodeName=="BR"&&!d.nextSibling&&d.parentNode&&!xa.test(d.parentNode.nodeName)?{ignore:!0}:null}})),h)l=wa(ji(l,+h[1],+h[2]),h[4]);else if(l=x.maxOpen(ba(l.content,i),!0),l.openStart||l.openEnd){let f=0,d=0;for(let p=l.content.firstChild;f<l.openStart&&!p.type.spec.isolating;f++,p=p.firstChild);for(let p=l.content.lastChild;d<l.openEnd&&!p.type.spec.isolating;d++,p=p.lastChild);l=ji(l,f,d)}return n.someProp("transformPasted",f=>{l=f(l,n)}),l}var xa=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function ba(n,e){if(n.childCount<2)return n;for(let t=e.depth;t>=0;t--){let i=e.node(t).contentMatchAt(e.index(t)),o,s=[];if(n.forEach(l=>{if(!s)return;let a=i.findWrapping(l.type),c;if(!a)return s=null;if(c=s.length&&o.length&&Mo(a,o,l,s[s.length-1],0))s[s.length-1]=c;else{s.length&&(s[s.length-1]=Co(s[s.length-1],o.length));let h=wo(l,a);s.push(h),i=i.matchType(h.type),o=a}}),s)return y.from(s)}return n}function wo(n,e,t=0){for(let r=e.length-1;r>=t;r--)n=e[r].create(null,y.from(n));return n}function Mo(n,e,t,r,i){if(i<n.length&&i<e.length&&n[i]==e[i]){let o=Mo(n,e,t,r.lastChild,i+1);if(o)return r.copy(r.content.replaceChild(r.childCount-1,o));if(r.contentMatchAt(r.childCount).matchType(i==n.length-1?t.type:n[i+1]))return r.copy(r.content.append(y.from(wo(t,n,i+1))))}}function Co(n,e){if(e==0)return n;let t=n.content.replaceChild(n.childCount-1,Co(n.lastChild,e-1)),r=n.contentMatchAt(n.childCount).fillBefore(y.empty,!0);return n.copy(t.append(r))}function sr(n,e,t,r,i,o){let s=e<0?n.firstChild:n.lastChild,l=s.content;return n.childCount>1&&(o=0),i<r-1&&(l=sr(l,e,t,r,i+1,o)),i>=t&&(l=e<0?s.contentMatchAt(0).fillBefore(l,o<=i).append(l):l.append(s.contentMatchAt(s.childCount).fillBefore(y.empty,!0))),n.replaceChild(e<0?0:n.childCount-1,s.copy(l))}function ji(n,e,t){return e<n.openStart&&(n=new x(sr(n.content,-1,e,n.openStart,0,n.openEnd),e,n.openEnd)),t<n.openEnd&&(n=new x(sr(n.content,1,t,n.openEnd,0,0),n.openStart,t)),n}var To={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},Gi=null;function Oo(){return Gi||(Gi=document.implementation.createHTMLDocument("title"))}function ka(n){let e=/^(\s*<meta [^>]*>)*/.exec(n);e&&(n=n.slice(e[0].length));let t=Oo().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(n),i;if((i=r&&To[r[1].toLowerCase()])&&(n=i.map(o=>"<"+o+">").join("")+n+i.map(o=>"</"+o+">").reverse().join("")),t.innerHTML=n,i)for(let o=0;o<i.length;o++)t=t.querySelector(i[o])||t;return t}function Sa(n){let e=n.querySelectorAll(R?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let r=e[t];r.childNodes.length==1&&r.textContent=="\xA0"&&r.parentNode&&r.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),r)}}function wa(n,e){if(!n.size)return n;let t=n.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return n}let{content:i,openStart:o,openEnd:s}=n;for(let l=r.length-2;l>=0;l-=2){let a=t.nodes[r[l]];if(!a||a.hasRequiredAttrs())break;i=y.from(a.create(r[l+1],i)),o++,s++}return new x(i,o,s)}var L={},J={},Ma={touchstart:!0,touchmove:!0},lr=class{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}};function Ca(n){for(let e in L){let t=L[e];n.dom.addEventListener(e,n.input.eventHandlers[e]=r=>{Oa(n,r)&&!yr(n,r)&&(n.editable||!(r.type in J))&&t(n,r)},Ma[e]?{passive:!0}:void 0)}V&&n.dom.addEventListener("input",()=>null),ar(n)}function be(n,e){n.input.lastSelectionOrigin=e,n.input.lastSelectionTime=Date.now()}function Ta(n){n.domObserver.stop();for(let e in n.input.eventHandlers)n.dom.removeEventListener(e,n.input.eventHandlers[e]);clearTimeout(n.input.composingTimeout),clearTimeout(n.input.lastIOSEnterFallbackTimeout)}function ar(n){n.someProp("handleDOMEvents",e=>{for(let t in e)n.input.eventHandlers[t]||n.dom.addEventListener(t,n.input.eventHandlers[t]=r=>yr(n,r))})}function yr(n,e){return n.someProp("handleDOMEvents",t=>{let r=t[e.type];return r?r(n,e)||e.defaultPrevented:!1})}function Oa(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=n.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function Na(n,e){!yr(n,e)&&L[e.type]&&(n.editable||!(e.type in J))&&L[e.type](n,e)}J.keydown=(n,e)=>{let t=e;if(n.input.shiftKey=t.keyCode==16||t.shiftKey,!Do(n,t)&&(n.input.lastKeyCode=t.keyCode,n.input.lastKeyCodeTime=Date.now(),!(_&&R&&t.keyCode==13)))if(t.keyCode!=229&&n.domObserver.forceFlush(),Ze&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let r=Date.now();n.input.lastIOSEnter=r,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==r&&(n.someProp("handleKeyDown",i=>i(n,Be(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",r=>r(n,t))||ya(n,t)?t.preventDefault():be(n,"key")};J.keyup=(n,e)=>{e.keyCode==16&&(n.input.shiftKey=!1)};J.keypress=(n,e)=>{let t=e;if(Do(n,t)||!t.charCode||t.ctrlKey&&!t.altKey||X&&t.metaKey)return;if(n.someProp("handleKeyPress",i=>i(n,t))){t.preventDefault();return}let r=n.state.selection;if(!(r instanceof C)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(t.charCode);!/[\r\n]/.test(i)&&!n.someProp("handleTextInput",o=>o(n,r.$from.pos,r.$to.pos,i))&&n.dispatch(n.state.tr.insertText(i).scrollIntoView()),t.preventDefault()}};function rn(n){return{left:n.clientX,top:n.clientY}}function Da(n,e){let t=e.x-n.clientX,r=e.y-n.clientY;return t*t+r*r<100}function xr(n,e,t,r,i){if(r==-1)return!1;let o=n.state.doc.resolve(r);for(let s=o.depth+1;s>0;s--)if(n.someProp(e,l=>s>o.depth?l(n,t,o.nodeAfter,o.before(s),i,!0):l(n,t,o.node(s),o.before(s),i,!1)))return!0;return!1}function Qe(n,e,t){n.focused||n.focus();let r=n.state.tr.setSelection(e);t=="pointer"&&r.setMeta("pointer",!0),n.dispatch(r)}function Ea(n,e){if(e==-1)return!1;let t=n.state.doc.resolve(e),r=t.nodeAfter;return r&&r.isAtom&&b.isSelectable(r)?(Qe(n,new b(t),"pointer"),!0):!1}function Aa(n,e){if(e==-1)return!1;let t=n.state.selection,r,i;t instanceof b&&(r=t.node);let o=n.state.doc.resolve(e);for(let s=o.depth+1;s>0;s--){let l=s>o.depth?o.nodeAfter:o.node(s);if(b.isSelectable(l)){r&&t.$from.depth>0&&s>=t.$from.depth&&o.before(t.$from.depth+1)==t.$from.pos?i=o.before(t.$from.depth):i=o.before(s);break}}return i!=null?(Qe(n,b.create(n.state.doc,i),"pointer"),!0):!1}function Ia(n,e,t,r,i){return xr(n,"handleClickOn",e,t,r)||n.someProp("handleClick",o=>o(n,e,r))||(i?Aa(n,t):Ea(n,t))}function Pa(n,e,t,r){return xr(n,"handleDoubleClickOn",e,t,r)||n.someProp("handleDoubleClick",i=>i(n,e,r))}function va(n,e,t,r){return xr(n,"handleTripleClickOn",e,t,r)||n.someProp("handleTripleClick",i=>i(n,e,r))||Ra(n,t,r)}function Ra(n,e,t){if(t.button!=0)return!1;let r=n.state.doc;if(e==-1)return r.inlineContent?(Qe(n,C.create(r,0,r.content.size),"pointer"),!0):!1;let i=r.resolve(e);for(let o=i.depth+1;o>0;o--){let s=o>i.depth?i.nodeAfter:i.node(o),l=i.before(o);if(s.inlineContent)Qe(n,C.create(r,l+1,l+1+s.content.size),"pointer");else if(b.isSelectable(s))Qe(n,b.create(r,l),"pointer");else continue;return!0}}function br(n){return Xt(n)}var No=X?"metaKey":"ctrlKey";L.mousedown=(n,e)=>{let t=e;n.input.shiftKey=t.shiftKey;let r=br(n),i=Date.now(),o="singleClick";i-n.input.lastClick.time<500&&Da(t,n.input.lastClick)&&!t[No]&&(n.input.lastClick.type=="singleClick"?o="doubleClick":n.input.lastClick.type=="doubleClick"&&(o="tripleClick")),n.input.lastClick={time:i,x:t.clientX,y:t.clientY,type:o};let s=n.posAtCoords(rn(t));s&&(o=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new cr(n,s,t,!!r)):(o=="doubleClick"?Pa:va)(n,s.pos,s.inside,t)?t.preventDefault():be(n,"pointer"))};var cr=class{constructor(e,t,r,i){this.view=e,this.pos=t,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[No],this.allowDefault=r.shiftKey;let o,s;if(t.inside>-1)o=e.state.doc.nodeAt(t.inside),s=t.inside;else{let h=e.state.doc.resolve(t.pos);o=h.parent,s=h.depth?h.before():0}let l=i?null:r.target,a=l?e.docView.nearestDesc(l,!0):null;this.target=a?a.dom:null;let{selection:c}=e.state;(r.button==0&&o.type.spec.draggable&&o.type.spec.selectable!==!1||c instanceof b&&c.from<=s&&c.to>s)&&(this.mightDrag={node:o,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&ee&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),be(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>he(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(rn(e))),this.updateAllowDefault(e),this.allowDefault||!t?be(this.view,"pointer"):Ia(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||V&&this.mightDrag&&!this.mightDrag.node.isAtom||R&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(Qe(this.view,S.near(this.view.state.doc.resolve(t.pos)),"pointer"),e.preventDefault()):be(this.view,"pointer")}move(e){this.updateAllowDefault(e),be(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}};L.touchstart=n=>{n.input.lastTouch=Date.now(),br(n),be(n,"pointer")};L.touchmove=n=>{n.input.lastTouch=Date.now(),be(n,"pointer")};L.contextmenu=n=>br(n);function Do(n,e){return n.composing?!0:V&&Math.abs(e.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}var Ba=_?5e3:-1;J.compositionstart=J.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:e}=n,t=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))n.markCursor=n.state.storedMarks||t.marks(),Xt(n,!0),n.markCursor=null;else if(Xt(n),ee&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let r=n.domSelectionRange();for(let i=r.focusNode,o=r.focusOffset;i&&i.nodeType==1&&o!=0;){let s=o<0?i.lastChild:i.childNodes[o-1];if(!s)break;if(s.nodeType==3){n.domSelection().collapse(s,s.nodeValue.length);break}else i=s,o=-1}}n.input.composing=!0}Eo(n,Ba)};J.compositionend=(n,e)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=e.timeStamp,n.input.compositionPendingChanges=n.domObserver.pendingRecords().length?n.input.compositionID:0,n.input.compositionPendingChanges&&Promise.resolve().then(()=>n.domObserver.flush()),n.input.compositionID++,Eo(n,20))};function Eo(n,e){clearTimeout(n.input.composingTimeout),e>-1&&(n.input.composingTimeout=setTimeout(()=>Xt(n),e))}function Ao(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=za());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}function za(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function Xt(n,e=!1){if(!(_&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),Ao(n),e||n.docView&&n.docView.dirty){let t=mr(n);return t&&!t.eq(n.state.selection)?n.dispatch(n.state.tr.setSelection(t)):n.updateState(n.state),!0}return!1}}function Fa(n,e){if(!n.dom.parentNode)return;let t=n.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),n.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),n.focus()},50)}var bt=$&&ke<15||Ze&&Ll<604;L.copy=J.cut=(n,e)=>{let t=e,r=n.state.selection,i=t.type=="cut";if(r.empty)return;let o=bt?null:t.clipboardData,s=r.content(),{dom:l,text:a}=ko(n,s);o?(t.preventDefault(),o.clearData(),o.setData("text/html",l.innerHTML),o.setData("text/plain",a)):Fa(n,l),i&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function Va(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function La(n,e){if(!n.dom.parentNode)return;let t=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,r=n.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let i=n.input.shiftKey&&n.input.lastKeyCode!=45;setTimeout(()=>{n.focus(),r.parentNode&&r.parentNode.removeChild(r),t?kt(n,r.value,null,i,e):kt(n,r.textContent,r.innerHTML,i,e)},50)}function kt(n,e,t,r,i){let o=So(n,e,t,r,n.state.selection.$from);if(n.someProp("handlePaste",a=>a(n,i,o||x.empty)))return!0;if(!o)return!1;let s=Va(o),l=s?n.state.tr.replaceSelectionWith(s,r):n.state.tr.replaceSelection(o);return n.dispatch(l.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Io(n){let e=n.getData("text/plain")||n.getData("Text");if(e)return e;let t=n.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}J.paste=(n,e)=>{let t=e;if(n.composing&&!_)return;let r=bt?null:t.clipboardData,i=n.input.shiftKey&&n.input.lastKeyCode!=45;r&&kt(n,Io(r),r.getData("text/html"),i,t)?t.preventDefault():La(n,t)};var Qt=class{constructor(e,t,r){this.slice=e,this.move=t,this.node=r}},Po=X?"altKey":"ctrlKey";L.dragstart=(n,e)=>{let t=e,r=n.input.mouseDown;if(r&&r.done(),!t.dataTransfer)return;let i=n.state.selection,o=i.empty?null:n.posAtCoords(rn(t)),s;if(!(o&&o.pos>=i.from&&o.pos<=(i instanceof b?i.to-1:i.to))){if(r&&r.mightDrag)s=b.create(n.state.doc,r.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let h=n.docView.nearestDesc(t.target,!0);h&&h.node.type.spec.draggable&&h!=n.docView&&(s=b.create(n.state.doc,h.posBefore))}}let l=(s||n.state.selection).content(),{dom:a,text:c}=ko(n,l);t.dataTransfer.clearData(),t.dataTransfer.setData(bt?"Text":"text/html",a.innerHTML),t.dataTransfer.effectAllowed="copyMove",bt||t.dataTransfer.setData("text/plain",c),n.dragging=new Qt(l,!t[Po],s)};L.dragend=n=>{let e=n.dragging;window.setTimeout(()=>{n.dragging==e&&(n.dragging=null)},50)};J.dragover=J.dragenter=(n,e)=>e.preventDefault();J.drop=(n,e)=>{let t=e,r=n.dragging;if(n.dragging=null,!t.dataTransfer)return;let i=n.posAtCoords(rn(t));if(!i)return;let o=n.state.doc.resolve(i.pos),s=r&&r.slice;s?n.someProp("transformPasted",u=>{s=u(s,n)}):s=So(n,Io(t.dataTransfer),bt?null:t.dataTransfer.getData("text/html"),!1,o);let l=!!(r&&!t[Po]);if(n.someProp("handleDrop",u=>u(n,t,s||x.empty,l))){t.preventDefault();return}if(!s)return;t.preventDefault();let a=s?Wt(n.state.doc,o.pos,s):o.pos;a==null&&(a=o.pos);let c=n.state.tr;if(l){let{node:u}=r;u?u.replace(c):c.deleteSelection()}let h=c.mapping.map(a),f=s.openStart==0&&s.openEnd==0&&s.content.childCount==1,d=c.doc;if(f?c.replaceRangeWith(h,h,s.content.firstChild):c.replaceRange(h,h,s),c.doc.eq(d))return;let p=c.doc.resolve(h);if(f&&b.isSelectable(s.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(s.content.firstChild))c.setSelection(new b(p));else{let u=c.mapping.map(a);c.mapping.maps[c.mapping.maps.length-1].forEach((m,g,k,z)=>u=z),c.setSelection(gr(n,p,c.doc.resolve(u)))}n.focus(),n.dispatch(c.setMeta("uiEvent","drop"))};L.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&he(n)},20))};L.blur=(n,e)=>{let t=e;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),t.relatedTarget&&n.dom.contains(t.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)};L.beforeinput=(n,e)=>{if(R&&_&&e.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:r}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=r||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",o=>o(n,Be(8,"Backspace")))))return;let{$cursor:i}=n.state.selection;i&&i.pos>0&&n.dispatch(n.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let n in J)L[n]=J[n];function St(n,e){if(n==e)return!0;for(let t in n)if(n[t]!==e[t])return!1;for(let t in e)if(!(t in n))return!1;return!0}var Zt=class n{constructor(e,t){this.toDOM=e,this.spec=t||Le,this.side=this.spec.side||0}map(e,t,r,i){let{pos:o,deleted:s}=e.mapResult(t.from+i,this.side<0?-1:1);return s?null:new Z(o-r,o-r,this)}valid(){return!0}eq(e){return this==e||e instanceof n&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&St(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}},Ve=class n{constructor(e,t){this.attrs=e,this.spec=t||Le}map(e,t,r,i){let o=e.map(t.from+i,this.spec.inclusiveStart?-1:1)-r,s=e.map(t.to+i,this.spec.inclusiveEnd?1:-1)-r;return o>=s?null:new Z(o,s,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof n&&St(this.attrs,e.attrs)&&St(this.spec,e.spec)}static is(e){return e.type instanceof n}destroy(){}},hr=class n{constructor(e,t){this.attrs=e,this.spec=t||Le}map(e,t,r,i){let o=e.mapResult(t.from+i,1);if(o.deleted)return null;let s=e.mapResult(t.to+i,-1);return s.deleted||s.pos<=o.pos?null:new Z(o.pos-r,s.pos-r,this)}valid(e,t){let{index:r,offset:i}=e.content.findIndex(t.from),o;return i==t.from&&!(o=e.child(r)).isText&&i+o.nodeSize==t.to}eq(e){return this==e||e instanceof n&&St(this.attrs,e.attrs)&&St(this.spec,e.spec)}destroy(){}},Z=class n{constructor(e,t,r){this.from=e,this.to=t,this.type=r}copy(e,t){return new n(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,r){return this.type.map(e,this,t,r)}static widget(e,t,r){return new n(e,e,new Zt(t,r))}static inline(e,t,r,i){return new n(e,t,new Ve(r,i))}static node(e,t,r,i){return new n(e,t,new hr(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Ve}get widget(){return this.type instanceof Zt}},Xe=[],Le={},A=class n{constructor(e,t){this.local=e.length?e:Xe,this.children=t.length?t:Xe}static create(e,t){return t.length?en(t,e,0,Le):v}find(e,t,r){let i=[];return this.findInner(e??0,t??1e9,i,0,r),i}findInner(e,t,r,i,o){for(let s=0;s<this.local.length;s++){let l=this.local[s];l.from<=t&&l.to>=e&&(!o||o(l.spec))&&r.push(l.copy(l.from+i,l.to+i))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<t&&this.children[s+1]>e){let l=this.children[s]+1;this.children[s+2].findInner(e-l,t-l,r,i+l,o)}}map(e,t,r){return this==v||e.maps.length==0?this:this.mapInner(e,t,0,0,r||Le)}mapInner(e,t,r,i,o){let s;for(let l=0;l<this.local.length;l++){let a=this.local[l].map(e,r,i);a&&a.type.valid(t,a)?(s||(s=[])).push(a):o.onRemove&&o.onRemove(this.local[l].spec)}return this.children.length?Ja(this.children,s||[],e,t,r,i,o):s?new n(s.sort(Je),Xe):v}add(e,t){return t.length?this==v?n.create(e,t):this.addInner(e,t,0):this}addInner(e,t,r){let i,o=0;e.forEach((l,a)=>{let c=a+r,h;if(h=Ro(t,l,c)){for(i||(i=this.children.slice());o<i.length&&i[o]<a;)o+=3;i[o]==a?i[o+2]=i[o+2].addInner(l,h,c+1):i.splice(o,0,a,a+l.nodeSize,en(h,l,c+1,Le)),o+=3}});let s=vo(o?Bo(t):t,-r);for(let l=0;l<s.length;l++)s[l].type.valid(e,s[l])||s.splice(l--,1);return new n(s.length?this.local.concat(s).sort(Je):this.local,i||this.children)}remove(e){return e.length==0||this==v?this:this.removeInner(e,0)}removeInner(e,t){let r=this.children,i=this.local;for(let o=0;o<r.length;o+=3){let s,l=r[o]+t,a=r[o+1]+t;for(let h=0,f;h<e.length;h++)(f=e[h])&&f.from>l&&f.to<a&&(e[h]=null,(s||(s=[])).push(f));if(!s)continue;r==this.children&&(r=this.children.slice());let c=r[o+2].removeInner(s,l+1);c!=v?r[o+2]=c:(r.splice(o,3),o-=3)}if(i.length){for(let o=0,s;o<e.length;o++)if(s=e[o])for(let l=0;l<i.length;l++)i[l].eq(s,t)&&(i==this.local&&(i=this.local.slice()),i.splice(l--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new n(i,r):v}forChild(e,t){if(this==v)return this;if(t.isLeaf)return n.empty;let r,i;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(r=this.children[l+2]);break}let o=e+1,s=o+t.content.size;for(let l=0;l<this.local.length;l++){let a=this.local[l];if(a.from<s&&a.to>o&&a.type instanceof Ve){let c=Math.max(o,a.from)-o,h=Math.min(s,a.to)-o;c<h&&(i||(i=[])).push(a.copy(c,h))}}if(i){let l=new n(i.sort(Je),Xe);return r?new _t([l,r]):l}return r||v}eq(e){if(this==e)return!0;if(!(e instanceof n)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return kr(this.localsInner(e))}localsInner(e){if(this==v)return Xe;if(e.inlineContent||!this.local.some(Ve.is))return this.local;let t=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Ve||t.push(this.local[r]);return t}};A.empty=new A([],[]);A.removeOverlap=kr;var v=A.empty,_t=class n{constructor(e){this.members=e}map(e,t){let r=this.members.map(i=>i.map(e,t,Le));return n.from(r)}forChild(e,t){if(t.isLeaf)return A.empty;let r=[];for(let i=0;i<this.members.length;i++){let o=this.members[i].forChild(e,t);o!=v&&(o instanceof n?r=r.concat(o.members):r.push(o))}return n.from(r)}eq(e){if(!(e instanceof n)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,r=!0;for(let i=0;i<this.members.length;i++){let o=this.members[i].localsInner(e);if(o.length)if(!t)t=o;else{r&&(t=t.slice(),r=!1);for(let s=0;s<o.length;s++)t.push(o[s])}}return t?kr(r?t:t.sort(Je)):Xe}static from(e){switch(e.length){case 0:return v;case 1:return e[0];default:return new n(e.every(t=>t instanceof A)?e:e.reduce((t,r)=>t.concat(r instanceof A?r:r.members),[]))}}};function Ja(n,e,t,r,i,o,s){let l=n.slice();for(let c=0,h=o;c<t.maps.length;c++){let f=0;t.maps[c].forEach((d,p,u,m)=>{let g=m-u-(p-d);for(let k=0;k<l.length;k+=3){let z=l[k+1];if(z<0||d>z+h-f)continue;let pe=l[k]+h-f;p>=pe?l[k+1]=d<=pe?-2:-1:d>=h&&g&&(l[k]+=g,l[k+1]+=g)}f+=g}),h=t.maps[c].map(h,-1)}let a=!1;for(let c=0;c<l.length;c+=3)if(l[c+1]<0){if(l[c+1]==-2){a=!0,l[c+1]=-1;continue}let h=t.map(n[c]+o),f=h-i;if(f<0||f>=r.content.size){a=!0;continue}let d=t.map(n[c+1]+o,-1),p=d-i,{index:u,offset:m}=r.content.findIndex(f),g=r.maybeChild(u);if(g&&m==f&&m+g.nodeSize==p){let k=l[c+2].mapInner(t,g,h+1,n[c]+o+1,s);k!=v?(l[c]=f,l[c+1]=p,l[c+2]=k):(l[c+1]=-2,a=!0)}else a=!0}if(a){let c=qa(l,n,e,t,i,o,s),h=en(c,r,0,s);e=h.local;for(let f=0;f<l.length;f+=3)l[f+1]<0&&(l.splice(f,3),f-=3);for(let f=0,d=0;f<h.children.length;f+=3){let p=h.children[f];for(;d<l.length&&l[d]<p;)d+=3;l.splice(d,0,h.children[f],h.children[f+1],h.children[f+2])}}return new A(e.sort(Je),l)}function vo(n,e){if(!e||!n.length)return n;let t=[];for(let r=0;r<n.length;r++){let i=n[r];t.push(new Z(i.from+e,i.to+e,i.type))}return t}function qa(n,e,t,r,i,o,s){function l(a,c){for(let h=0;h<a.local.length;h++){let f=a.local[h].map(r,i,c);f?t.push(f):s.onRemove&&s.onRemove(a.local[h].spec)}for(let h=0;h<a.children.length;h+=3)l(a.children[h+2],a.children[h]+c+1)}for(let a=0;a<n.length;a+=3)n[a+1]==-1&&l(n[a+2],e[a]+o+1);return t}function Ro(n,e,t){if(e.isLeaf)return null;let r=t+e.nodeSize,i=null;for(let o=0,s;o<n.length;o++)(s=n[o])&&s.from>t&&s.to<r&&((i||(i=[])).push(s),n[o]=null);return i}function Bo(n){let e=[];for(let t=0;t<n.length;t++)n[t]!=null&&e.push(n[t]);return e}function en(n,e,t,r){let i=[],o=!1;e.forEach((l,a)=>{let c=Ro(n,l,a+t);if(c){o=!0;let h=en(c,l,t+a+1,r);h!=v&&i.push(a,a+l.nodeSize,h)}});let s=vo(o?Bo(n):n,-t).sort(Je);for(let l=0;l<s.length;l++)s[l].type.valid(e,s[l])||(r.onRemove&&r.onRemove(s[l].spec),s.splice(l--,1));return s.length||i.length?new A(s,i):v}function Je(n,e){return n.from-e.from||n.to-e.to}function kr(n){let e=n;for(let t=0;t<e.length-1;t++){let r=e[t];if(r.from!=r.to)for(let i=t+1;i<e.length;i++){let o=e[i];if(o.from==r.from){o.to!=r.to&&(e==n&&(e=n.slice()),e[i]=o.copy(o.from,r.to),Yi(e,i+1,o.copy(r.to,o.to)));continue}else{o.from<r.to&&(e==n&&(e=n.slice()),e[t]=r.copy(r.from,o.from),Yi(e,i,r.copy(o.from,r.to)));break}}}return e}function Yi(n,e,t){for(;e<n.length&&Je(t,n[e])>0;)e++;n.splice(e,0,t)}function jn(n){let e=[];return n.someProp("decorations",t=>{let r=t(n.state);r&&r!=v&&e.push(r)}),n.cursorWrapper&&e.push(A.create(n.state.doc,[n.cursorWrapper.deco])),_t.from(e)}var Wa={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Ka=$&&ke<=11,fr=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}},dr=class{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new fr,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let i=0;i<r.length;i++)this.queue.push(r[i]);$&&ke<=11&&r.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),Ka&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Wa)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(qi(this.view)){if(this.suppressingSelectionUpdates)return he(this.view);if($&&ke<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&qe(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,r;for(let o=e.focusNode;o;o=xt(o))t.add(o);for(let o=e.anchorNode;o;o=xt(o))if(t.has(o)){r=o;break}let i=r&&this.view.docView.nearestDesc(r);if(i&&i.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let r=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&qi(e)&&!this.ignoreSelectionChange(r),o=-1,s=-1,l=!1,a=[];if(e.editable)for(let h=0;h<t.length;h++){let f=this.registerMutation(t[h],a);f&&(o=o<0?f.from:Math.min(f.from,o),s=s<0?f.to:Math.max(f.to,s),f.typeOver&&(l=!0))}if(ee&&a.length>1){let h=a.filter(f=>f.nodeName=="BR");if(h.length==2){let f=h[0],d=h[1];f.parentNode&&f.parentNode.parentNode==d.parentNode?d.remove():f.remove()}}let c=null;o<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&nn(r)&&(c=mr(e))&&c.eq(S.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,he(e),this.currentSelection.set(r),e.scrollToSelection()):(o>-1||i)&&(o>-1&&(e.docView.markDirty(o,s),$a(e)),this.handleDOMChange(o,s,l,a),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||he(e),this.currentSelection.set(r))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let h=0;h<e.addedNodes.length;h++)t.push(e.addedNodes[h]);if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let i=e.previousSibling,o=e.nextSibling;if($&&ke<=11&&e.addedNodes.length)for(let h=0;h<e.addedNodes.length;h++){let{previousSibling:f,nextSibling:d}=e.addedNodes[h];(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f),(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(o=d)}let s=i&&i.parentNode==e.target?F(i)+1:0,l=r.localPosFromDOM(e.target,s,-1),a=o&&o.parentNode==e.target?F(o):e.target.childNodes.length,c=r.localPosFromDOM(e.target,a,1);return{from:l,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}},Xi=new WeakMap,Qi=!1;function $a(n){if(!Xi.has(n)&&(Xi.set(n,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(n.dom).whiteSpace)!==-1)){if(n.requiresGeckoHackNode=ee,Qi)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Qi=!0}}function Ua(n){let e;function t(a){a.preventDefault(),a.stopImmediatePropagation(),e=a.getTargetRanges()[0]}n.dom.addEventListener("beforeinput",t,!0),document.execCommand("indent"),n.dom.removeEventListener("beforeinput",t,!0);let r=e.startContainer,i=e.startOffset,o=e.endContainer,s=e.endOffset,l=n.domAtPos(n.state.selection.anchor);return qe(l.node,l.offset,o,s)&&([r,i,o,s]=[o,s,r,i]),{anchorNode:r,anchorOffset:i,focusNode:o,focusOffset:s}}function Ha(n,e,t){let{node:r,fromOffset:i,toOffset:o,from:s,to:l}=n.docView.parseRange(e,t),a=n.domSelectionRange(),c,h=a.anchorNode;if(h&&n.dom.contains(h.nodeType==1?h:h.parentNode)&&(c=[{node:h,offset:a.anchorOffset}],nn(a)||c.push({node:a.focusNode,offset:a.focusOffset})),R&&n.input.lastKeyCode===8)for(let g=o;g>i;g--){let k=r.childNodes[g-1],z=k.pmViewDesc;if(k.nodeName=="BR"&&!z){o=g;break}if(!z||z.size)break}let f=n.state.doc,d=n.someProp("domParser")||Ae.fromSchema(n.state.schema),p=f.resolve(s),u=null,m=d.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:i,to:o,preserveWhitespace:p.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:ja,context:p});if(c&&c[0].pos!=null){let g=c[0].pos,k=c[1]&&c[1].pos;k==null&&(k=g),u={anchor:g+s,head:k+s}}return{doc:m,sel:u,from:s,to:l}}function ja(n){let e=n.pmViewDesc;if(e)return e.parseRule();if(n.nodeName=="BR"&&n.parentNode){if(V&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(n.parentNode.lastChild==n||V&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if(n.nodeName=="IMG"&&n.getAttribute("mark-placeholder"))return{ignore:!0};return null}var Ga=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Ya(n,e,t,r,i){let o=n.input.compositionPendingChanges||(n.composing?n.input.compositionID:0);if(n.input.compositionPendingChanges=0,e<0){let w=n.input.lastSelectionTime>Date.now()-50?n.input.lastSelectionOrigin:null,ge=mr(n,w);if(ge&&!n.state.selection.eq(ge)){if(R&&_&&n.input.lastKeyCode===13&&Date.now()-100<n.input.lastKeyCodeTime&&n.someProp("handleKeyDown",Hs=>Hs(n,Be(13,"Enter"))))return;let Nt=n.state.tr.setSelection(ge);w=="pointer"?Nt.setMeta("pointer",!0):w=="key"&&Nt.scrollIntoView(),o&&Nt.setMeta("composition",o),n.dispatch(Nt)}return}let s=n.state.doc.resolve(e),l=s.sharedDepth(t);e=s.before(l+1),t=n.state.doc.resolve(t).after(l+1);let a=n.state.selection,c=Ha(n,e,t),h=n.state.doc,f=h.slice(c.from,c.to),d,p;n.input.lastKeyCode===8&&Date.now()-100<n.input.lastKeyCodeTime?(d=n.state.selection.to,p="end"):(d=n.state.selection.from,p="start"),n.input.lastKeyCode=null;let u=Za(f.content,c.doc.content,c.from,d,p);if((Ze&&n.input.lastIOSEnter>Date.now()-225||_)&&i.some(w=>w.nodeType==1&&!Ga.test(w.nodeName))&&(!u||u.endA>=u.endB)&&n.someProp("handleKeyDown",w=>w(n,Be(13,"Enter")))){n.input.lastIOSEnter=0;return}if(!u)if(r&&a instanceof C&&!a.empty&&a.$head.sameParent(a.$anchor)&&!n.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))u={start:a.from,endA:a.to,endB:a.to};else{if(c.sel){let w=Zi(n,n.state.doc,c.sel);if(w&&!w.eq(n.state.selection)){let ge=n.state.tr.setSelection(w);o&&ge.setMeta("composition",o),n.dispatch(ge)}}return}if(R&&n.cursorWrapper&&c.sel&&c.sel.anchor==n.cursorWrapper.deco.from&&c.sel.head==c.sel.anchor){let w=u.endB-u.start;c.sel={anchor:c.sel.anchor+w,head:c.sel.anchor+w}}n.input.domChangeCount++,n.state.selection.from<n.state.selection.to&&u.start==u.endB&&n.state.selection instanceof C&&(u.start>n.state.selection.from&&u.start<=n.state.selection.from+2&&n.state.selection.from>=c.from?u.start=n.state.selection.from:u.endA<n.state.selection.to&&u.endA>=n.state.selection.to-2&&n.state.selection.to<=c.to&&(u.endB+=n.state.selection.to-u.endA,u.endA=n.state.selection.to)),$&&ke<=11&&u.endB==u.start+1&&u.endA==u.start&&u.start>c.from&&c.doc.textBetween(u.start-c.from-1,u.start-c.from+1)==" \xA0"&&(u.start--,u.endA--,u.endB--);let m=c.doc.resolveNoCache(u.start-c.from),g=c.doc.resolveNoCache(u.endB-c.from),k=h.resolve(u.start),z=m.sameParent(g)&&m.parent.inlineContent&&k.end()>=u.endA,pe;if((Ze&&n.input.lastIOSEnter>Date.now()-225&&(!z||i.some(w=>w.nodeName=="DIV"||w.nodeName=="P"))||!z&&m.pos<c.doc.content.size&&!m.sameParent(g)&&(pe=S.findFrom(c.doc.resolve(m.pos+1),1,!0))&&pe.head==g.pos)&&n.someProp("handleKeyDown",w=>w(n,Be(13,"Enter")))){n.input.lastIOSEnter=0;return}if(n.state.selection.anchor>u.start&&Qa(h,u.start,u.endA,m,g)&&n.someProp("handleKeyDown",w=>w(n,Be(8,"Backspace")))){_&&R&&n.domObserver.suppressSelectionUpdates();return}R&&_&&u.endB==u.start&&(n.input.lastAndroidDelete=Date.now()),_&&!z&&m.start()!=g.start()&&g.parentOffset==0&&m.depth==g.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==u.endA&&(u.endB-=2,g=c.doc.resolveNoCache(u.endB-c.from),setTimeout(()=>{n.someProp("handleKeyDown",function(w){return w(n,Be(13,"Enter"))})},20));let me=u.start,Te=u.endA,H,wn,Ot;if(z){if(m.pos==g.pos)$&&ke<=11&&m.parentOffset==0&&(n.domObserver.suppressSelectionUpdates(),setTimeout(()=>he(n),20)),H=n.state.tr.delete(me,Te),wn=h.resolve(u.start).marksAcross(h.resolve(u.endA));else if(u.endA==u.endB&&(Ot=Xa(m.parent.content.cut(m.parentOffset,g.parentOffset),k.parent.content.cut(k.parentOffset,u.endA-k.start()))))H=n.state.tr,Ot.type=="add"?H.addMark(me,Te,Ot.mark):H.removeMark(me,Te,Ot.mark);else if(m.parent.child(m.index()).isText&&m.index()==g.index()-(g.textOffset?0:1)){let w=m.parent.textBetween(m.parentOffset,g.parentOffset);if(n.someProp("handleTextInput",ge=>ge(n,me,Te,w)))return;H=n.state.tr.insertText(w,me,Te)}}if(H||(H=n.state.tr.replace(me,Te,c.doc.slice(u.start-c.from,u.endB-c.from))),c.sel){let w=Zi(n,H.doc,c.sel);w&&!(R&&_&&n.composing&&w.empty&&(u.start!=u.endB||n.input.lastAndroidDelete<Date.now()-100)&&(w.head==me||w.head==H.mapping.map(Te)-1)||$&&w.empty&&w.head==me)&&H.setSelection(w)}wn&&H.ensureMarks(wn),o&&H.setMeta("composition",o),n.dispatch(H.scrollIntoView())}function Zi(n,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:gr(n,e.resolve(t.anchor),e.resolve(t.head))}function Xa(n,e){let t=n.firstChild.marks,r=e.firstChild.marks,i=t,o=r,s,l,a;for(let h=0;h<r.length;h++)i=r[h].removeFromSet(i);for(let h=0;h<t.length;h++)o=t[h].removeFromSet(o);if(i.length==1&&o.length==0)l=i[0],s="add",a=h=>h.mark(l.addToSet(h.marks));else if(i.length==0&&o.length==1)l=o[0],s="remove",a=h=>h.mark(l.removeFromSet(h.marks));else return null;let c=[];for(let h=0;h<e.childCount;h++)c.push(a(e.child(h)));if(y.from(c).eq(n))return{mark:l,type:s}}function Qa(n,e,t,r,i){if(!r.parent.isTextblock||t-e<=i.pos-r.pos||Gn(r,!0,!1)<i.pos)return!1;let o=n.resolve(e);if(o.parentOffset<o.parent.content.size||!o.parent.isTextblock)return!1;let s=n.resolve(Gn(o,!0,!0));return!s.parent.isTextblock||s.pos>t||Gn(s,!0,!1)<t?!1:r.parent.content.cut(r.parentOffset).eq(s.parent.content)}function Gn(n,e,t){let r=n.depth,i=e?n.end():n.pos;for(;r>0&&(e||n.indexAfter(r)==n.node(r).childCount);)r--,i++,e=!1;if(t){let o=n.node(r).maybeChild(n.indexAfter(r));for(;o&&!o.isLeaf;)o=o.firstChild,i++}return i}function Za(n,e,t,r,i){let o=n.findDiffStart(e,t);if(o==null)return null;let{a:s,b:l}=n.findDiffEnd(e,t+n.size,t+e.size);if(i=="end"){let a=Math.max(0,o-Math.min(s,l));r-=s+a-o}if(s<o&&n.size<e.size){let a=r<=o&&r>=s?o-r:0;o-=a,o&&o<e.size&&_i(e.textBetween(o-1,o+1))&&(o+=a?1:-1),l=o+(l-s),s=o}else if(l<o){let a=r<=o&&r>=l?o-r:0;o-=a,o&&o<n.size&&_i(n.textBetween(o-1,o+1))&&(o+=a?1:-1),s=o+(s-l),l=o}return{start:o,endA:s,endB:l}}function _i(n){if(n.length!=2)return!1;let e=n.charCodeAt(0),t=n.charCodeAt(1);return e>=56320&&e<=57343&&t>=55296&&t<=56319}var tn=class{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new lr,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(io),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=no(this),to(this),this.nodeViews=ro(this),this.docView=Bi(this.state.doc,eo(this),jn(this),this.dom,this),this.domObserver=new dr(this,(r,i,o,s)=>Ya(this,r,i,o,s)),this.domObserver.start(),Ca(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&ar(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(io),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let r in this._props)t[r]=this._props[r];t.state=this.state;for(let r in e)t[r]=e[r];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var r;let i=this.state,o=!1,s=!1;e.storedMarks&&this.composing&&(Ao(this),s=!0),this.state=e;let l=i.plugins!=e.plugins||this._props.plugins!=t.plugins;if(l||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let p=ro(this);ec(p,this.nodeViews)&&(this.nodeViews=p,o=!0)}(l||t.handleDOMEvents!=this._props.handleDOMEvents)&&ar(this),this.editable=no(this),to(this);let a=jn(this),c=eo(this),h=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",f=o||!this.docView.matchesNode(e.doc,c,a);(f||!e.selection.eq(i.selection))&&(s=!0);let d=h=="preserve"&&s&&this.dom.style.overflowAnchor==null&&Wl(this);if(s){this.domObserver.stop();let p=f&&($||R)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&_a(i.selection,e.selection);if(f){let u=R?this.trackWrites=this.domSelectionRange().focusNode:null;(o||!this.docView.update(e.doc,c,a,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=Bi(e.doc,c,a,this.dom,this)),u&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&ha(this))?he(this,p):(yo(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((r=this.dragging)===null||r===void 0)&&r.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),h=="reset"?this.dom.scrollTop=0:h=="to selection"?this.scrollToSelection():d&&Kl(d)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof b){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&Ei(this,t.getBoundingClientRect(),e)}else Ei(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let r=this.directPlugins[t];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let r=this.state.plugins[t];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let r=this.pluginViews[t];r.update&&r.update(this,e)}}updateDraggedNode(e,t){let r=e.node,i=-1;if(this.state.doc.nodeAt(r.from)==r.node)i=r.from;else{let o=r.from+(this.state.doc.content.size-t.doc.content.size);(o>0&&this.state.doc.nodeAt(o))==r.node&&(i=o)}this.dragging=new Qt(e.slice,e.move,i<0?void 0:b.create(this.state.doc,i))}someProp(e,t){let r=this._props&&this._props[e],i;if(r!=null&&(i=t?t(r):r))return i;for(let s=0;s<this.directPlugins.length;s++){let l=this.directPlugins[s].props[e];if(l!=null&&(i=t?t(l):l))return i}let o=this.state.plugins;if(o)for(let s=0;s<o.length;s++){let l=o[s].props[e];if(l!=null&&(i=t?t(l):l))return i}}hasFocus(){if($){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&$l(this.dom),he(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}updateRoot(){this._root=null}posAtCoords(e){return Yl(this,e)}coordsAtPos(e,t=1){return ho(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,r=-1){let i=this.docView.posFromDOM(e,t,r);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,t){return ea(this,t||this.state,e)}pasteHTML(e,t){return kt(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return kt(this,e,null,!0,t||new ClipboardEvent("paste"))}destroy(){this.docView&&(Ta(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],jn(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}get isDestroyed(){return this.docView==null}dispatchEvent(e){return Na(this,e)}dispatch(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){return V&&this.root.nodeType===11&&Bl(this.dom.ownerDocument)==this.dom?Ua(this):this.domSelection()}domSelection(){return this.root.getSelection()}};function eo(n){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(n.editable),n.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(n.state)),t)for(let r in t)r=="class"?e.class+=" "+t[r]:r=="style"?e.style=(e.style?e.style+";":"")+t[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(t[r]))}),e.translate||(e.translate="no"),[Z.node(0,n.state.doc.content.size,e)]}function to(n){if(n.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),n.cursorWrapper={dom:e,deco:Z.widget(n.state.selection.head,e,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function no(n){return!n.someProp("editable",e=>e(n.state)===!1)}function _a(n,e){let t=Math.min(n.$anchor.sharedDepth(n.head),e.$anchor.sharedDepth(e.head));return n.$anchor.start(t)!=e.$anchor.start(t)}function ro(n){let e=Object.create(null);function t(r){for(let i in r)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=r[i])}return n.someProp("nodeViews",t),n.someProp("markViews",t),e}function ec(n,e){let t=0,r=0;for(let i in n){if(n[i]!=e[i])return!0;t++}for(let i in e)r++;return t!=r}function io(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var fe={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},sn={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},tc=typeof navigator<"u"&&/Mac/.test(navigator.platform),nc=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(T=0;T<10;T++)fe[48+T]=fe[96+T]=String(T);var T;for(T=1;T<=24;T++)fe[T+111]="F"+T;var T;for(T=65;T<=90;T++)fe[T]=String.fromCharCode(T+32),sn[T]=String.fromCharCode(T);var T;for(on in fe)sn.hasOwnProperty(on)||(sn[on]=fe[on]);var on;function zo(n){var e=tc&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||nc&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",t=!e&&n.key||(n.shiftKey?sn:fe)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}var rc=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function ic(n){let e=n.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let r,i,o,s;for(let l=0;l<e.length-1;l++){let a=e[l];if(/^(cmd|meta|m)$/i.test(a))s=!0;else if(/^a(lt)?$/i.test(a))r=!0;else if(/^(c|ctrl|control)$/i.test(a))i=!0;else if(/^s(hift)?$/i.test(a))o=!0;else if(/^mod$/i.test(a))rc?s=!0:i=!0;else throw new Error("Unrecognized modifier name: "+a)}return r&&(t="Alt-"+t),i&&(t="Ctrl-"+t),s&&(t="Meta-"+t),o&&(t="Shift-"+t),t}function oc(n){let e=Object.create(null);for(let t in n)e[ic(t)]=n[t];return e}function Sr(n,e,t=!0){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t&&e.shiftKey&&(n="Shift-"+n),n}function Fo(n){return new D({props:{handleKeyDown:wr(n)}})}function wr(n){let e=oc(n);return function(t,r){let i=zo(r),o,s=e[Sr(i,r)];if(s&&s(t.state,t.dispatch,t))return!0;if(i.length==1&&i!=" "){if(r.shiftKey){let l=e[Sr(i,r,!1)];if(l&&l(t.state,t.dispatch,t))return!0}if((r.shiftKey||r.altKey||r.metaKey||i.charCodeAt(0)>127)&&(o=fe[r.keyCode])&&o!=i){let l=e[Sr(o,r)];if(l&&l(t.state,t.dispatch,t))return!0}}return!1}}var ln=200,I=function(){};I.prototype.append=function(e){return e.length?(e=I.from(e),!this.length&&e||e.length<ln&&this.leafAppend(e)||this.length<ln&&e.leafPrepend(this)||this.appendInner(e)):this};I.prototype.prepend=function(e){return e.length?I.from(e).append(this):this};I.prototype.appendInner=function(e){return new sc(this,e)};I.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?I.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};I.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};I.prototype.forEach=function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length),t<=r?this.forEachInner(e,t,r,0):this.forEachInvertedInner(e,t,r,0)};I.prototype.map=function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(o,s){return i.push(e(o,s))},t,r),i};I.from=function(e){return e instanceof I?e:e&&e.length?new Vo(e):I.empty};var Vo=function(n){function e(r){n.call(this),this.values=r}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,o){return i==0&&o==this.length?this:new e(this.values.slice(i,o))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,o,s,l){for(var a=o;a<s;a++)if(i(this.values[a],l+a)===!1)return!1},e.prototype.forEachInvertedInner=function(i,o,s,l){for(var a=o-1;a>=s;a--)if(i(this.values[a],l+a)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=ln)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=ln)return new e(i.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(I);I.empty=new Vo([]);var sc=function(n){function e(t,r){n.call(this),this.left=t,this.right=r,this.length=t.length+r.length,this.depth=Math.max(t.depth,r.depth)+1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,i,o,s){var l=this.left.length;if(i<l&&this.left.forEachInner(r,i,Math.min(o,l),s)===!1||o>l&&this.right.forEachInner(r,Math.max(i-l,0),Math.min(this.length,o)-l,s+l)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,o,s){var l=this.left.length;if(i>l&&this.right.forEachInvertedInner(r,i-l,Math.max(o,l)-l,s+l)===!1||o<l&&this.left.forEachInvertedInner(r,Math.min(i,l),o,s)===!1)return!1},e.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var o=this.left.length;return i<=o?this.left.slice(r,i):r>=o?this.right.slice(r-o,i-o):this.left.slice(r,o).append(this.right.slice(0,i-o))},e.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new e(i,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(I),Mr=I;var lc=500,Ke=class n{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,o;t&&(i=this.remapping(r,this.items.length),o=i.maps.length);let s=e.tr,l,a,c=[],h=[];return this.items.forEach((f,d)=>{if(!f.step){i||(i=this.remapping(r,d+1),o=i.maps.length),o--,h.push(f);return}if(i){h.push(new oe(f.map));let p=f.step.map(i.slice(o)),u;p&&s.maybeStep(p).doc&&(u=s.mapping.maps[s.mapping.maps.length-1],c.push(new oe(u,void 0,void 0,c.length+h.length))),o--,u&&i.appendMap(u,o)}else s.maybeStep(f.step);if(f.selection)return l=i?f.selection.map(i.slice(o)):f.selection,a=new n(this.items.slice(0,r).append(h.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:a,transform:s,selection:l}}addTransform(e,t,r,i){let o=[],s=this.eventCount,l=this.items,a=!i&&l.length?l.get(l.length-1):null;for(let h=0;h<e.steps.length;h++){let f=e.steps[h].invert(e.docs[h]),d=new oe(e.mapping.maps[h],f,t),p;(p=a&&a.merge(d))&&(d=p,h?o.pop():l=l.slice(0,l.length-1)),o.push(d),t&&(s++,t=void 0),i||(a=d)}let c=s-r.depth;return c>cc&&(l=ac(l,c),s-=c),new n(l.append(o),s)}remapping(e,t){let r=new at;return this.items.forEach((i,o)=>{let s=i.mirrorOffset!=null&&o-i.mirrorOffset>=e?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,s)},e,t),r}addMaps(e){return this.eventCount==0?this:new n(this.items.append(e.map(t=>new oe(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-t),o=e.mapping,s=e.steps.length,l=this.eventCount;this.items.forEach(d=>{d.selection&&l--},i);let a=t;this.items.forEach(d=>{let p=o.getMirror(--a);if(p==null)return;s=Math.min(s,p);let u=o.maps[p];if(d.step){let m=e.steps[p].invert(e.docs[p]),g=d.selection&&d.selection.map(o.slice(a+1,p));g&&l++,r.push(new oe(u,m,g))}else r.push(new oe(u))},i);let c=[];for(let d=t;d<s;d++)c.push(new oe(o.maps[d]));let h=this.items.slice(0,i).append(c).append(r),f=new n(h,l);return f.emptyItemCount()>lc&&(f=f.compress(this.items.length-r.length)),f}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),r=t.maps.length,i=[],o=0;return this.items.forEach((s,l)=>{if(l>=e)i.push(s),s.selection&&o++;else if(s.step){let a=s.step.map(t.slice(r)),c=a&&a.getMap();if(r--,c&&t.appendMap(c,r),a){let h=s.selection&&s.selection.map(t.slice(r));h&&o++;let f=new oe(c.invert(),a,h),d,p=i.length-1;(d=i.length&&i[p].merge(f))?i[p]=d:i.push(f)}}else s.map&&r--},this.items.length,0),new n(Mr.from(i.reverse()),o)}};Ke.empty=new Ke(Mr.empty,0);function ac(n,e){let t;return n.forEach((r,i)=>{if(r.selection&&e--==0)return t=i,!1}),n.slice(t)}var oe=class n{constructor(e,t,r,i){this.map=e,this.step=t,this.selection=r,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new n(t.getMap().invert(),t,this.selection)}}},se=class{constructor(e,t,r,i,o){this.done=e,this.undone=t,this.prevRanges=r,this.prevTime=i,this.prevComposition=o}},cc=20;function hc(n,e,t,r){let i=t.getMeta(Me),o;if(i)return i.historyState;t.getMeta(dc)&&(n=new se(n.done,n.undone,null,0,-1));let s=t.getMeta("appendedTransaction");if(t.steps.length==0)return n;if(s&&s.getMeta(Me))return s.getMeta(Me).redo?new se(n.done.addTransform(t,void 0,r,an(e)),n.undone,Lo(t.mapping.maps[t.steps.length-1]),n.prevTime,n.prevComposition):new se(n.done,n.undone.addTransform(t,void 0,r,an(e)),null,n.prevTime,n.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(s&&s.getMeta("addToHistory")===!1)){let l=t.getMeta("composition"),a=n.prevTime==0||!s&&n.prevComposition!=l&&(n.prevTime<(t.time||0)-r.newGroupDelay||!fc(t,n.prevRanges)),c=s?Cr(n.prevRanges,t.mapping):Lo(t.mapping.maps[t.steps.length-1]);return new se(n.done.addTransform(t,a?e.selection.getBookmark():void 0,r,an(e)),Ke.empty,c,t.time,l??n.prevComposition)}else return(o=t.getMeta("rebased"))?new se(n.done.rebased(t,o),n.undone.rebased(t,o),Cr(n.prevRanges,t.mapping),n.prevTime,n.prevComposition):new se(n.done.addMaps(t.mapping.maps),n.undone.addMaps(t.mapping.maps),Cr(n.prevRanges,t.mapping),n.prevTime,n.prevComposition)}function fc(n,e){if(!e)return!1;if(!n.docChanged)return!0;let t=!1;return n.mapping.maps[0].forEach((r,i)=>{for(let o=0;o<e.length;o+=2)r<=e[o+1]&&i>=e[o]&&(t=!0)}),t}function Lo(n){let e=[];return n.forEach((t,r,i,o)=>e.push(i,o)),e}function Cr(n,e){if(!n)return null;let t=[];for(let r=0;r<n.length;r+=2){let i=e.map(n[r],1),o=e.map(n[r+1],-1);i<=o&&t.push(i,o)}return t}function qo(n,e,t,r){let i=an(e),o=Me.get(e).spec.config,s=(r?n.undone:n.done).popEvent(e,i);if(!s)return;let l=s.selection.resolve(s.transform.doc),a=(r?n.done:n.undone).addTransform(s.transform,e.selection.getBookmark(),o,i),c=new se(r?a:s.remaining,r?s.remaining:a,null,0,-1);t(s.transform.setSelection(l).setMeta(Me,{redo:r,historyState:c}).scrollIntoView())}var Tr=!1,Jo=null;function an(n){let e=n.plugins;if(Jo!=e){Tr=!1,Jo=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){Tr=!0;break}}return Tr}var Me=new Re("history"),dc=new Re("closeHistory");function Wo(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new D({key:Me,state:{init(){return new se(Ke.empty,Ke.empty,null,0,-1)},apply(e,t,r){return hc(t,r,e,n)}},config:n,props:{handleDOMEvents:{beforeinput(e,t){let r=t.inputType,i=r=="historyUndo"?uc:r=="historyRedo"?pc:null;return i?(t.preventDefault(),i(e.state,e.dispatch)):!1}}}})}var uc=(n,e)=>{let t=Me.getState(n);return!t||t.done.eventCount==0?!1:(e&&qo(t,n,e,!1),!0)},pc=(n,e)=>{let t=Me.getState(n);return!t||t.undone.eventCount==0?!1:(e&&qo(t,n,e,!0),!0)};var $o=(n,e)=>n.selection.empty?!1:(e&&e(n.tr.deleteSelection().scrollIntoView()),!0);function mc(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("backward",n):t.parentOffset>0)?null:t}var gc=(n,e,t)=>{let r=mc(n,t);if(!r)return!1;let i=Uo(r);if(!i){let s=r.blockRange(),l=s&&qt(s);return l==null?!1:(e&&e(n.tr.lift(s,l).scrollIntoView()),!0)}let o=i.nodeBefore;if(!o.type.spec.isolating&&jo(n,i,e))return!0;if(r.parent.content.size==0&&(et(o,"end")||b.isSelectable(o))){let s=Kt(n.doc,r.before(),r.after(),x.empty);if(s&&s.slice.size<s.to-s.from){if(e){let l=n.tr.step(s);l.setSelection(et(o,"end")?S.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):b.create(l.doc,i.pos-o.nodeSize)),e(l.scrollIntoView())}return!0}}return o.isAtom&&i.depth==r.depth-1?(e&&e(n.tr.delete(i.pos-o.nodeSize,i.pos).scrollIntoView()),!0):!1};function et(n,e,t=!1){for(let r=n;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(t&&r.childCount!=1)return!1}return!1}var yc=(n,e,t)=>{let{$head:r,empty:i}=n.selection,o=r;if(!i)return!1;if(r.parent.isTextblock){if(t?!t.endOfTextblock("backward",n):r.parentOffset>0)return!1;o=Uo(r)}let s=o&&o.nodeBefore;return!s||!b.isSelectable(s)?!1:(e&&e(n.tr.setSelection(b.create(n.doc,o.pos-s.nodeSize)).scrollIntoView()),!0)};function Uo(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){if(n.index(e)>0)return n.doc.resolve(n.before(e+1));if(n.node(e).type.spec.isolating)break}return null}function xc(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("forward",n):t.parentOffset<t.parent.content.size)?null:t}var bc=(n,e,t)=>{let r=xc(n,t);if(!r)return!1;let i=Ho(r);if(!i)return!1;let o=i.nodeAfter;if(jo(n,i,e))return!0;if(r.parent.content.size==0&&(et(o,"start")||b.isSelectable(o))){let s=Kt(n.doc,r.before(),r.after(),x.empty);if(s&&s.slice.size<s.to-s.from){if(e){let l=n.tr.step(s);l.setSelection(et(o,"start")?S.findFrom(l.doc.resolve(l.mapping.map(i.pos)),1):b.create(l.doc,l.mapping.map(i.pos))),e(l.scrollIntoView())}return!0}}return o.isAtom&&i.depth==r.depth-1?(e&&e(n.tr.delete(i.pos,i.pos+o.nodeSize).scrollIntoView()),!0):!1},kc=(n,e,t)=>{let{$head:r,empty:i}=n.selection,o=r;if(!i)return!1;if(r.parent.isTextblock){if(t?!t.endOfTextblock("forward",n):r.parentOffset<r.parent.content.size)return!1;o=Ho(r)}let s=o&&o.nodeAfter;return!s||!b.isSelectable(s)?!1:(e&&e(n.tr.setSelection(b.create(n.doc,o.pos)).scrollIntoView()),!0)};function Ho(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){let t=n.node(e);if(n.index(e)+1<t.childCount)return n.doc.resolve(n.after(e+1));if(t.type.spec.isolating)break}return null}var Sc=(n,e)=>{let{$head:t,$anchor:r}=n.selection;return!t.parent.type.spec.code||!t.sameParent(r)?!1:(e&&e(n.tr.insertText(`
`).scrollIntoView()),!0)};function Nr(n){for(let e=0;e<n.edgeCount;e++){let{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}var wc=(n,e)=>{let{$head:t,$anchor:r}=n.selection;if(!t.parent.type.spec.code||!t.sameParent(r))return!1;let i=t.node(-1),o=t.indexAfter(-1),s=Nr(i.contentMatchAt(o));if(!s||!i.canReplaceWith(o,o,s))return!1;if(e){let l=t.after(),a=n.tr.replaceWith(l,l,s.createAndFill());a.setSelection(S.near(a.doc.resolve(l),1)),e(a.scrollIntoView())}return!0},Mc=(n,e)=>{let t=n.selection,{$from:r,$to:i}=t;if(t instanceof Y||r.parent.inlineContent||i.parent.inlineContent)return!1;let o=Nr(i.parent.contentMatchAt(i.indexAfter()));if(!o||!o.isTextblock)return!1;if(e){let s=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,l=n.tr.insert(s,o.createAndFill());l.setSelection(C.create(l.doc,s+1)),e(l.scrollIntoView())}return!0},Cc=(n,e)=>{let{$cursor:t}=n.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let o=t.before();if(dt(n.doc,o))return e&&e(n.tr.split(o).scrollIntoView()),!0}let r=t.blockRange(),i=r&&qt(r);return i==null?!1:(e&&e(n.tr.lift(r,i).scrollIntoView()),!0)};function Tc(n){return(e,t)=>{let{$from:r,$to:i}=e.selection;if(e.selection instanceof b&&e.selection.node.isBlock)return!r.parentOffset||!dt(e.doc,r.pos)?!1:(t&&t(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.parent.isBlock)return!1;if(t){let o=i.parentOffset==i.parent.content.size,s=e.tr;(e.selection instanceof C||e.selection instanceof Y)&&s.deleteSelection();let l=r.depth==0?null:Nr(r.node(-1).contentMatchAt(r.indexAfter(-1))),a=n&&n(i.parent,o),c=a?[a]:o&&l?[{type:l}]:void 0,h=dt(s.doc,s.mapping.map(r.pos),1,c);if(!c&&!h&&dt(s.doc,s.mapping.map(r.pos),1,l?[{type:l}]:void 0)&&(l&&(c=[{type:l}]),h=!0),h&&(s.split(s.mapping.map(r.pos),1,c),!o&&!r.parentOffset&&r.parent.type!=l)){let f=s.mapping.map(r.before()),d=s.doc.resolve(f);l&&r.node(-1).canReplaceWith(d.index(),d.index()+1,l)&&s.setNodeMarkup(s.mapping.map(r.before()),l)}t(s.scrollIntoView())}return!0}}var Oc=Tc();var Nc=(n,e)=>(e&&e(n.tr.setSelection(new Y(n.doc))),!0);function Dc(n,e,t){let r=e.nodeBefore,i=e.nodeAfter,o=e.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&e.parent.canReplace(o-1,o)?(t&&t(n.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(o,o+1)||!(i.isTextblock||Ln(n.doc,e.pos))?!1:(t&&t(n.tr.clearIncompatible(e.pos,r.type,r.contentMatchAt(r.childCount)).join(e.pos).scrollIntoView()),!0)}function jo(n,e,t){let r=e.nodeBefore,i=e.nodeAfter,o,s;if(r.type.spec.isolating||i.type.spec.isolating)return!1;if(Dc(n,e,t))return!0;let l=e.parent.canReplace(e.index(),e.index()+1);if(l&&(o=(s=r.contentMatchAt(r.childCount)).findWrapping(i.type))&&s.matchType(o[0]||i.type).validEnd){if(t){let f=e.pos+i.nodeSize,d=y.empty;for(let m=o.length-1;m>=0;m--)d=y.from(o[m].create(null,d));d=y.from(r.copy(d));let p=n.tr.step(new G(e.pos-1,f,e.pos,f,new x(d,1,0),o.length,!0)),u=f+2*o.length;Ln(p.doc,u)&&p.join(u),t(p.scrollIntoView())}return!0}let a=S.findFrom(e,1),c=a&&a.$from.blockRange(a.$to),h=c&&qt(c);if(h!=null&&h>=e.depth)return t&&t(n.tr.lift(c,h).scrollIntoView()),!0;if(l&&et(i,"start",!0)&&et(r,"end")){let f=r,d=[];for(;d.push(f),!f.isTextblock;)f=f.lastChild;let p=i,u=1;for(;!p.isTextblock;p=p.firstChild)u++;if(f.canReplace(f.childCount,f.childCount,p.content)){if(t){let m=y.empty;for(let k=d.length-1;k>=0;k--)m=y.from(d[k].copy(m));let g=n.tr.step(new G(e.pos-d.length,e.pos+i.nodeSize,e.pos+u,e.pos+i.nodeSize-u,new x(m,d.length,0),0,!0));t(g.scrollIntoView())}return!0}}return!1}function Go(n){return function(e,t){let r=e.selection,i=n<0?r.$from:r.$to,o=i.depth;for(;i.node(o).isInline;){if(!o)return!1;o--}return i.node(o).isTextblock?(t&&t(e.tr.setSelection(C.create(e.doc,n<0?i.start(o):i.end(o)))),!0):!1}}var Ec=Go(-1),Ac=Go(1);function Dr(...n){return function(e,t,r){for(let i=0;i<n.length;i++)if(n[i](e,t,r))return!0;return!1}}var Or=Dr($o,gc,yc),Ko=Dr($o,bc,kc),de={Enter:Dr(Sc,Mc,Cc,Oc),"Mod-Enter":wc,Backspace:Or,"Mod-Backspace":Or,"Shift-Backspace":Or,Delete:Ko,"Mod-Delete":Ko,"Mod-a":Nc},Yo={"Ctrl-h":de.Backspace,"Alt-Backspace":de["Mod-Backspace"],"Ctrl-d":de.Delete,"Ctrl-Alt-Backspace":de["Mod-Delete"],"Alt-Delete":de["Mod-Delete"],"Alt-d":de["Mod-Delete"],"Ctrl-a":Ec,"Ctrl-e":Ac};for(let n in de)Yo[n]=de[n];var Ic=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform?os.platform()=="darwin":!1,Xo=Ic?Yo:de;function Qo(n={}){return new D({view(e){return new Er(e,n)}})}var Er=class{constructor(e,t){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=t.width)!==null&&r!==void 0?r:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let o=s=>{this[i](s)};return e.dom.addEventListener(i,o),{name:i,handler:o}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,r;if(t){let l=e.nodeBefore,a=e.nodeAfter;if(l||a){let c=this.editorView.nodeDOM(this.cursorPos-(l?l.nodeSize:0));if(c){let h=c.getBoundingClientRect(),f=l?h.bottom:h.top;l&&a&&(f=(f+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),r={left:h.left,right:h.right,top:f-this.width/2,bottom:f+this.width/2}}}}if(!r){let l=this.editorView.coordsAtPos(this.cursorPos);r={left:l.left-this.width/2,right:l.left+this.width/2,top:l.top,bottom:l.bottom}}let i=this.editorView.dom.offsetParent;this.element||(this.element=i.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let o,s;if(!i||i==document.body&&getComputedStyle(i).position=="static")o=-pageXOffset,s=-pageYOffset;else{let l=i.getBoundingClientRect();o=l.left-i.scrollLeft,s=l.top-i.scrollTop}this.element.style.left=r.left-o+"px",this.element.style.top=r.top-s+"px",this.element.style.width=r.right-r.left+"px",this.element.style.height=r.bottom-r.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),i=r&&r.type.spec.disableDropCursor,o=typeof i=="function"?i(this.editorView,t,e):i;if(t&&!o){let s=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let l=Wt(this.editorView.state.doc,s,this.editorView.dragging.slice);l!=null&&(s=l)}this.setCursor(s),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)}};var B=class n extends S{constructor(e){super(e,e)}map(e,t){let r=e.resolve(t.map(this.head));return n.valid(r)?new n(r):S.near(r)}content(){return x.empty}eq(e){return e instanceof n&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new n(e.resolve(t.pos))}getBookmark(){return new Ar(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!Pc(e)||!vc(e))return!1;let r=t.type.spec.allowGapCursor;if(r!=null)return r;let i=t.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,t,r=!1){e:for(;;){if(!r&&n.valid(e))return e;let i=e.pos,o=null;for(let s=e.depth;;s--){let l=e.node(s);if(t>0?e.indexAfter(s)<l.childCount:e.index(s)>0){o=l.child(t>0?e.indexAfter(s):e.index(s)-1);break}else if(s==0)return null;i+=t;let a=e.doc.resolve(i);if(n.valid(a))return a}for(;;){let s=t>0?o.firstChild:o.lastChild;if(!s){if(o.isAtom&&!o.isText&&!b.isSelectable(o)){e=e.doc.resolve(i+o.nodeSize*t),r=!1;continue e}break}o=s,i+=t;let l=e.doc.resolve(i);if(n.valid(l))return l}return null}}};B.prototype.visible=!1;B.findFrom=B.findGapCursorFrom;S.jsonID("gapcursor",B);var Ar=class n{constructor(e){this.pos=e}map(e){return new n(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return B.valid(t)?new B(t):S.near(t)}};function Pc(n){for(let e=n.depth;e>=0;e--){let t=n.index(e),r=n.node(e);if(t==0){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(t-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function vc(n){for(let e=n.depth;e>=0;e--){let t=n.indexAfter(e),r=n.node(e);if(t==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(t);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function Zo(){return new D({props:{decorations:Fc,createSelectionBetween(n,e,t){return e.pos==t.pos&&B.valid(t)?new B(t):null},handleClick:Bc,handleKeyDown:Rc,handleDOMEvents:{beforeinput:zc}}})}var Rc=wr({ArrowLeft:cn("horiz",-1),ArrowRight:cn("horiz",1),ArrowUp:cn("vert",-1),ArrowDown:cn("vert",1)});function cn(n,e){let t=n=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,i,o){let s=r.selection,l=e>0?s.$to:s.$from,a=s.empty;if(s instanceof C){if(!o.endOfTextblock(t)||l.depth==0)return!1;a=!1,l=r.doc.resolve(e>0?l.after():l.before())}let c=B.findGapCursorFrom(l,e,a);return c?(i&&i(r.tr.setSelection(new B(c))),!0):!1}}function Bc(n,e,t){if(!n||!n.editable)return!1;let r=n.state.doc.resolve(e);if(!B.valid(r))return!1;let i=n.posAtCoords({left:t.clientX,top:t.clientY});return i&&i.inside>-1&&b.isSelectable(n.state.doc.nodeAt(i.inside))?!1:(n.dispatch(n.state.tr.setSelection(new B(r))),!0)}function zc(n,e){if(e.inputType!="insertCompositionText"||!(n.state.selection instanceof B))return!1;let{$from:t}=n.state.selection,r=t.parent.contentMatchAt(t.index()).findWrapping(n.state.schema.nodes.text);if(!r)return!1;let i=y.empty;for(let s=r.length-1;s>=0;s--)i=y.from(r[s].createAndFill(null,i));let o=n.state.tr.replace(t.pos,t.pos,new x(i,0,0));return o.setSelection(C.near(o.doc.resolve(t.pos+1))),n.dispatch(o),!1}function Fc(n){if(!(n.selection instanceof B))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",A.create(n.doc,[Z.widget(n.selection.head,e,{key:"gapcursor"})])}var _o=()=>new D({props:{decorations(n){let e=n.selection,t=n.doc.resolve(e.from);if(t.depth<1)return A.empty;let r=Z.node(t.before(),t.after(),{class:"block-focused"});return A.create(n.doc,[r])}}});var Vc=()=>{let n=[];return{withTracking:(r,i)=>{n.push(r);let o=i();return n.pop(),o},getTracked:()=>n[n.length-1]}},{withTracking:hn,getTracked:es}=Vc(),ts=n=>{let e=!1,t=()=>{n(),e=!1};return()=>{e||(e=!0,queueMicrotask(t))}},ns=()=>{let n=new Set;return{withTransaction:r=>{typeof r=="function"&&n.add(r)},transact:()=>{let r=n;n=new Set;for(let i of r)i()}}},Lc=n=>typeof n=="function"&&n.length===0,Ir=n=>Lc(n)?n():n,rs=n=>{let e=ns(),t=n;return[()=>(e.withTransaction(es()),t),o=>{t!==o&&(t=o,e.transact())}]},Pr=n=>{let e=ns(),t=ts(()=>{let o=hn(t,n);i!==o&&(i=o,e.transact())}),r=()=>(e.withTransaction(es()),i),i=hn(t,n);return r},fn=n=>{let e=ts(()=>{hn(e,n)});hn(e,n)};var is=n=>{let e=n();if(e==null)throw new TypeError("Signal initial value cannot be null");let t=e,r=!1;return Pr(()=>{if(r)return t;let i=n();return i!=null?(t=i,t):(r=!0,t)})};var Jc=0,dn=()=>`cid${Jc++}`,qc=(n,e)=>{let t=new Map;for(let r of n)t.set(e(r),r);return t},Wc=n=>n.id,un=n=>qc(n,Wc),vr=Symbol("list item key"),pn=(n,e)=>t=>fn(()=>{let r=new Map,i=[];for(let s of t.children)r.set(s[vr],s),n().has(s[vr])||i.push(s);for(let s of i)t.removeChild(s);let o=0;for(let s of n().keys()){let l=o++,a=r.get(s);if(a!=null)ss(t,a,l);else{let c=e(is(()=>n().get(s)));c[vr]=s,ss(t,c,l)}}}),ss=(n,e,t)=>{let r=n.children[t];r!==e&&n.insertBefore(e,r)};var Mt=n=>e=>fn(()=>as(e,"textContent",Ir(n)??"")),ls=n=>{},Kc=Array.isArray,O=(n,e,t=ls)=>{let r=document.createElement(n);return fn(()=>Hc(r,Ir(e))),Kc(t)?r.replaceChildren(...t):t(r),r},$c=n=>(e,t=ls)=>O(n,e,t),Mf=new Proxy(Object.freeze({}),{get:(n,e)=>{if(typeof e!="string")throw new TypeError("Tag must be string");return $c(e)}}),Uc=new Set(["innerText"]),as=(n,e,t)=>{Uc.has(e)&&console.warn(`Checking property value for ${e} triggers layout. Consider writing to this property without using setProp().`),n[e]!==t&&(n[e]=t)},Hc=(n,e)=>{for(let[t,r]of Object.entries(e))as(n,t,r)};var cs=n=>O("header",{className:"byline"},[O("span",{className:"byline-petname accent-text semibold"},Mt(()=>`@${n().petname}`)),O("span",{className:"byline-slug secondary-text"},Mt(()=>`/${n().slug}`))]);var hs=({petname:n,slug:e})=>`noosphere://@${n}/${e}`;var fs=({id:n=dn(),body:e=""})=>({id:n,body:e}),Gc=n=>O("p",{className:"excerpt-block"},Mt(()=>n().body)),ds=n=>O("div",{className:"excerpt vstack gap-xsm"},pn(Pr(()=>un(n())),Gc));var us=({id:n=dn(),slashlink:e,blocks:t})=>({id:n,slashlink:e,blocks:t}),ps=n=>O("aside",{className:"transclude anim-fade-in"},[O("a",()=>({href:hs(n().slashlink),className:"transclude-link vstack gap-sm"}),[cs(()=>n().slashlink),O("div",{className:"transclude-content"},[ds(()=>n().blocks)])])]);var Rr=n=>n[Math.floor(Math.random()*n.length)],Yc=(n,e)=>{let t=[];for(let r=0;r<n;r++)t.push(e());return t},Br=n=>n.split(`
`).filter(e=>e!==""),Xc=Br(`
In Ersilia, to establish the relationships that sustain the city's life, the inhabitants stretch strings from the corners of the houses, white or black or gray or black-and-white according to whether they mark a relationship of blood, of trade, authority, agency.
When the strings become so numerous that you can no longer pass among them, the inhabitants leave: the houses are dismantled; only the strings and their supports remain.
From a mountainside, camping with their household goods, Ersilia's refugees look at the labyrinth of taut strings and poles that rise in the plain. That is the city of Ersilia still, and they are nothing.
They rebuild Ersilia elsewhere. They weave a similar pattern of strings which they would like to be more complex and at the same time more regular than the other. Then they abandon it and take themselves and their houses still farther away.
Thus, when traveling in the territory of Ersilia, you come upon the ruins of the abandoned cities, without the walls which do not last, without the bones of the dead which the wind rolls away: spiderwebs of intricate relationships seeking a form. 
Almustafa, the chosen and the beloved, who was a dawn unto his own day, had waited twelve years in the city of Orphalese for his ship that was to return and bear him back to the isle of his birth.
And in the twelfth year, on the seventh day of Ielool, the month of reaping, he climbed the hill without the city walls and looked seaward; and he beheld his ship coming with the mist.
Then the gates of his heart were flung open, and his joy flew far over the sea. And he closed his eyes and prayed in the silences of his soul.
But as he descended the hill, a sadness came upon him, and he thought in his heart:
How shall I go in peace and without sorrow? Nay, not without a wound in the spirit shall I leave this city. Long were the days of pain I have spent within its walls, and long were the nights of aloneness; and who can depart from his pain and his aloneness without regret?
Too many fragments of the spirit have I scattered in these streets, and too many are the children of my longing that walk naked among these hills, and I cannot withdraw from them without a burden and an ache.
It is not a garment I cast off this day, but a skin that I tear with my own hands.
Nor is it a thought I leave behind me, but a heart made sweet with hunger and with thirst.
Yet I cannot tarry longer.
The sea that calls all things unto her calls me, and I must embark.
For to stay, though the hours burn in the night, is to freeze and crystallize and be bound in a mould.
Fain would I take with me all that is here. But how shall I?
A voice cannot carry the tongue and the lips that gave it wings. Alone must it seek the ether.
And alone and without his nest shall the eagle fly across the sun.
Now when he reached the foot of the hill, he turned again towards the sea, and he saw his ship approaching the harbour, and upon her prow the mariners, the men of his own land.
And his soul cried out to them, and he said:
Sons of my ancient mother, you riders of the tides,
How often have you sailed in my dreams. And now you come in my awakening, which is my deeper dream.
Ready am I to go, and my eagerness with sails full set awaits the wind.
Only another breath will I breathe in this still air, only another loving look cast backward,
And then I shall stand among you, a seafarer among seafarers. And you, vast sea, sleepless mother,
Who alone are peace and freedom to the river and the stream,
Only another winding will this stream make, only another murmur in this glade,
And then shall I come to you, a boundless drop to a boundless ocean.
And as he walked he saw from afar men and women leaving their fields and their vineyards and hastening towards the city gates.
And he heard their voices calling his name, and shouting from field to field telling one another of the coming of his ship.
And he said to himself:
Shall the day of parting be the day of gathering?
And shall it be said that my eve was in truth my dawn?
And what shall I give unto him who has left his plough in midfurrow, or to him who has stopped the wheel of his winepress? Shall my heart become a tree heavy-laden with fruit that I may gather and give unto them?
And shall my desires flow like a fountain that I may fill their cups?
Am I a harp that the hand of the mighty may touch me, or a flute that his breath may pass through me?
A seeker of silences am I, and what treasure have I found in silences that I may dispense with confidence?
If this is my day of harvest, in what fields have I sowed the seed, and in what unremembered seasons?
If this indeed be the hour in which I lift up my lantern, it is not my flame that shall burn therein.
Empty and dark shall I raise my lantern,
And the guardian of the night shall fill it with oil and he shall light it also.
These things he said in words. But much in his heart remained unsaid. For he himself could not speak his deeper secret.
And when he entered into the city all the people came to meet him, and they were crying out to him as with one voice.
And the elders of the city stood forth and said:
Go not yet away from us.
A noontide have you been in our twilight, and your youth has given us dreams to dream.
No stranger are you among us, nor a guest, but our son and our dearly beloved.
Suffer not yet our eyes to hunger for your face.
`),Qc=n=>Yc(n,()=>fs({body:Rr(Xc)})),Zc=Br(`
bob
alice
carol
dave
eve
frank
grace
`),_c=()=>Rr(Zc),eh=Br(`
the-coming-of-the-ship
on-love
on-giving
on-eating-and-drinking
on-work
on-joy-and-sorrow
on-houses
on-clothes
on-buying-and-selling
on-crime-and-punishment
on-laws
on-freedom
on-reason-and-passion
self-knowledge
on-teaching
on-friendship
on-talking
on-time
on-beauty
the-farewell
`),th=()=>Rr(eh),ms=()=>({petname:_c(),slug:th()}),zr=n=>us({slashlink:n,blocks:Qc(2)});var gs=n=>new Promise(e=>setTimeout(e,n));var ys=()=>({fetch:async r=>(await gs(100),zr(r)),fetchBatch:async r=>{let i=r.map(zr);return un(i)},destroy:()=>{}});var rh=ys(),ih=(n,e,t,r)=>{let[i,o]=rs(new Map);rh.fetchBatch([ms()]).then(h=>{o(h)});let s=O("div",{className:"block-content",contentEditable:!0}),l=O("div",{className:"block-footer vstack gap-sm",contentEditable:"false"},pn(i,ps));return{dom:O(n,{className:"block"},[s,l]),contentDOM:s,ignoreMutation:h=>{switch(h.type){case"childList":return h.target===l;case"attributes":return h.target===l;default:return!1}}}},mn=n=>(e,t,r)=>ih(n,e,t,r),xs=mn("x-block"),bs=mn("x-quoteblock"),ks=mn("x-listblock"),Ss=mn("x-headingblock");var ws=(n,e,t)=>{let r=O("span",{contentEditable:!0},[n.textContent]);return{dom:O("strong",{className:"bold"},[r]),contentDOM:r}};var ue=class{constructor(e,t,r={}){this.match=e,this.match=e,this.handler=typeof t=="string"?oh(t):t,this.undoable=r.undoable!==!1,this.inCode=r.inCode||!1}};function oh(n){return function(e,t,r,i){let o=n;if(t[1]){let s=t[0].lastIndexOf(t[1]);o+=t[0].slice(s+t[1].length),r+=s;let l=r-i;l>0&&(o=t[0].slice(s-l,s)+o,r=i)}return e.tr.insertText(o,r,i)}}var sh=500;function Cs({rules:n}){let e=new D({state:{init(){return null},apply(t,r){let i=t.getMeta(this);return i||(t.selectionSet||t.docChanged?null:r)}},props:{handleTextInput(t,r,i,o){return Ms(t,r,i,o,n,e)},handleDOMEvents:{compositionend:t=>{setTimeout(()=>{let{$cursor:r}=t.state.selection;r&&Ms(t,r.pos,r.pos,"",n,e)})}}},isInputRules:!0});return e}function Ms(n,e,t,r,i,o){if(n.composing)return!1;let s=n.state,l=s.doc.resolve(e),a=l.parent.textBetween(Math.max(0,l.parentOffset-sh),l.parentOffset,null,"\uFFFC")+r;for(let c=0;c<i.length;c++){let h=i[c];if(l.parent.type.spec.code){if(!h.inCode)continue}else if(h.inCode==="only")continue;let f=h.match.exec(a),d=f&&h.handler(s,f,e-(f[0].length-r.length),t);if(d)return h.undoable&&d.setMeta(o,{transform:d,from:e,to:t,text:r}),n.dispatch(d),!0}return!1}var Zf=new ue(/--$/,"\u2014"),_f=new ue(/\.\.\.$/,"\u2026"),ed=new ue(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"\u201C"),td=new ue(/"$/,"\u201D"),nd=new ue(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"\u2018"),rd=new ue(/'$/,"\u2019");function gn(n,e,t=null){return new ue(n,(r,i,o,s)=>{let l=r.doc.resolve(o),a=t instanceof Function?t(i):t;return l.node(-1).canReplaceWith(l.index(-1),l.indexAfter(-1),e)?r.tr.delete(o,s).setBlockType(o,o,e,a):null})}var q=new vt({nodes:{text:{group:"inline"},plainblock:{group:"block",content:"text*",toDOM(){return["x-block",0]},parseDOM:[{tag:"x-block"}]},quoteblock:{group:"block",content:"text*",toDOM(){return["x-quoteblock",0]},parseDOM:[{tag:"x-quoteblock"}]},listblock:{group:"block",content:"text*",toDOM(){return["x-listblock",0]},parseDOM:[{tag:"x-listblock"}]},headingblock:{group:"block",content:"text*",toDOM(){return["x-headingblock",0]},parseDOM:[{tag:"x-headingblock"}]},doc:{content:"(plainblock|quoteblock|listblock|headingblock)+"}},marks:{b:{toDOM(){return["b",0]}},i:{toDOM(){return["i",0]}},code:{toDOM(){return["code",0]}},slashlink:{attrs:{href:{}},toDOM:n=>["a",{class:"slashlink",href:n.attrs.href},0]},wikilink:{attrs:{href:{}},toDOM:n=>["a",{class:"wikilink",href:n.attrs.href},0]},bracketlink:{attrs:{href:{}},toDOM:n=>["a",{class:"bracketlink",href:n.attrs.href},0]},barelink:{attrs:{href:{}},toDOM:n=>["a",{class:"barelink",href:n.attrs.href},0]}}});var lh=gn(/^>\s$/,q.nodes.quoteblock),ah=gn(/^-\s$/,q.nodes.listblock),ch=gn(/^#\s$/,q.nodes.headingblock),Ts=()=>Cs({rules:[lh,ah,ch]});var hh=n=>n.docChanged,Os=(n,e,t)=>n.some(hh)&&!e.doc.eq(t.doc),Ns=(n,e)=>e+n.nodeSize,Ds=n=>n+1,Es=(n,e)=>e+n.nodeSize-1;var As=(n,e,t,r)=>{let i=n.childCount,o=e.childCount;e:for(let s=0,l=0;s<o;s++){let a=e.child(s);for(let c=l,h=Math.min(i,s+3);c<h;c++)if(n.child(c)==a){l=c+1,t+=a.nodeSize;continue e}r(a,t),l<i&&n.child(l).sameMarkup(a)?As(n.child(l),a,t+1,r):a.nodesBetween(0,a.content.size,r,t+1),t+=a.nodeSize}},fh=(n,e,t)=>As(n,e,0,t),Is=({old:n,cur:e},t,r)=>{let i=r;return fh(n,e,(o,s)=>{i=t(i,{node:o,pos:s})}),i};function Ps(n,e,t){let r=t;for(let i of n)r=e(r,i);return r}var vs=({string:n,from:e=0,to:t=0,saved:r=0})=>({string:n,from:e,to:t,saved:r}),yn=n=>n.to>=n.string.length,Ct=n=>n.to===0,dh=Math.max,uh=Math.min,$e=(n,e,t)=>uh(dh(n,e),t),Tt=n=>$e(n.to++,0,n.string.length),Fr=({string:n,to:e},t=0)=>{let r=$e(e+t,0,n.length);return n[r]},W=(n,e)=>{for(let t=0;t<e.length;t++)if(n.string[n.to+t]!==e[t])return!1;return n.to+=e.length,!0},tt=(n,e)=>{for(;!yn(n);){if(W(n,e))return!0;Tt(n)}return!1};var Ce=n=>{let e=n.from,t=n.to;return n.from=n.to,[e,t]},Rs=n=>(n.from=n.to,n),ph=n=>(n.saved=n.to,n),mh=n=>(n.to=n.saved,n),U=(n,e,t)=>{ph(e);let r=n(e,t);return r||(mh(e),Tt(e)),r},Bs=(n,e)=>{let[t,r]=n;return n[0]=$e(t+e,0,r),n},Vr=(n,e,t)=>{let[r,i]=n;return n[1]=$e(i+e,r,t),n},zs=(n,e,t)=>{let[r,i]=n;return n[0]=$e(e+r,0,t),n[1]=$e(e+i,0,t),n};var Lr=(n,[e,t])=>{if(e>=t)return"";let r=$e(t-1,e,t);return n[r]},Fs=(n,[e,t])=>e>=t?"":n[e],Jr=n=>n==="."||n===","||n==="!"||n==="?"||n===":"||n===";";var K={bold:"bold",italic:"italic",code:"code",wikilink:"wikilink",bracketlink:"bracketlink",barelink:"barelink",slashlink:"slashlink"},Vs=n=>{let e=[];return gh(vs({string:n}),e),e},gh=(n,e)=>{for(;!yn(n);)Rs(n),Ct(n)&&W(n,"http://")?U(xn,n,e):Ct(n)&&W(n,"https://")?U(xn,n,e):Ct(n)&&W(n,"@")?U(bn,n,e):Ct(n)&&W(n,"/")?U(bn,n,e):W(n," http://")?U(xn,n,e):W(n," https://")?U(xn,n,e):W(n," @")?U(bn,n,e):W(n," /")?U(bn,n,e):W(n,"*")?U(yh,n,e):W(n,"_")?U(xh,n,e):W(n,"`")?U(bh,n,e):W(n,"[[")?U(kh,n,e):W(n,"<")?U(Sh,n,e):Tt(n)},yh=(n,e)=>tt(n,"*")?(e.push({type:K.bold,range:Ce(n)}),!0):!1,xh=(n,e)=>tt(n,"_")?(e.push({type:K.italic,range:Ce(n)}),!0):!1,bh=(n,e)=>tt(n,"`")?(e.push({type:K.code,range:Ce(n)}),!0):!1,kh=(n,e)=>tt(n,"]]")?(e.push({type:K.wikilink,range:Ce(n)}),!0):!1,Sh=(n,e)=>tt(n,">")?(e.push({type:K.bracketlink,range:Ce(n)}),!0):!1,Ls=(n,e)=>(Fs(n,e)===" "&&Bs(e,1),Lr(n,e)===" "&&Vr(e,-1,n.length),Jr(Lr(n,e))&&Vr(e,-1,n.length),e),xn=(n,e)=>{if(Js(n)){let{string:t}=n,r=Ce(n);return Ls(t,r),e.push({type:K.barelink,range:r}),!0}return!1},bn=(n,e)=>{if(Js(n)){let{string:t}=n,r=Ce(n);return Ls(t,r),e.push({type:K.slashlink,range:r}),!0}return!1},Js=n=>{for(;!yn(n);){let e=Fr(n),t=Fr(n,1);if(e===" ")return!0;if(Jr(e)&&t===" ")return!0;Tt(n)}return!0};var qs=()=>new D({key:new Re("inlineSubtext"),appendTransaction:(n,e,t)=>{if(!Os(n,e,t))return null;let{tr:i}=t;return Is({old:e.doc,cur:t.doc},(o,{node:s,pos:l})=>{if(s.isTextblock){let a=l,c=Ns(s,l),h=Ds(l),f=Es(s,l);o=o.removeMark(a,c);let d=s.textContent;return Ps(Vs(d),(p,u)=>{switch(zs(u.range,h,f),u.type){case K.bold:return wh(p,u.range);case K.italic:return Mh(p,u.range);case K.code:return Ch(p,u.range);case K.wikilink:return Th(p,u.range);case K.bracketlink:return Oh(p,u.range);case K.barelink:return Nh(p,u.range,d);case K.slashlink:return Dh(p,u.range);default:return p}},o)}return o},i)}}),wh=(n,[e,t])=>n.addMark(e,t,q.marks.b.create()),Mh=(n,[e,t])=>n.addMark(e,t,q.marks.i.create()),Ch=(n,[e,t])=>n.addMark(e,t,q.marks.code.create()),Th=(n,[e,t])=>n.addMark(e,t,q.marks.wikilink.create()),Oh=(n,[e,t])=>n.addMark(e,t,q.marks.bracketlink.create()),Nh=(n,[e,t],r)=>n.addMark(e,t,q.marks.barelink.create({href:r.slice(e,t)})),Dh=(n,[e,t])=>n.addMark(e,t,q.marks.slashlink.create());var Eh=n=>Ae.fromSchema(q).parse(n),Ws=n=>pt.fromJSON({schema:q,plugins:Ks()},n),Ah=()=>new D({props:{attributes:{class:"editor-main"}}}),Ks=()=>[Fo(Xo),Qo(),Zo(),Wo(),_o(),Ah(),Ts(),qs()],$s=(n,e)=>new tn(n,{state:pt.create({doc:Eh(e),plugins:Ks()}),nodeViews:{plainblock:xs,quoteblock:bs,listblock:ks,headingblock:Ss,bold:ws}});var kn=n=>{let e=new CSSStyleSheet;return e.replaceSync(n),e};var Ih=kn(`
* {
  margin: 0;
  padding: 0;
}
`),Ph=kn(`
.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror pre {
  white-space: pre-wrap;
}

.ProseMirror li {
  position: relative;
}

.ProseMirror-hideselection *::selection { background: transparent; }
.ProseMirror-hideselection *::-moz-selection { background: transparent; }
.ProseMirror-hideselection { caret-color: transparent; }

/* See https://github.com/ProseMirror/prosemirror/issues/1421#issuecomment-1759320191 */
.ProseMirror [draggable][contenteditable=false] { user-select: text }

.ProseMirror-selectednode {
  outline: 2px solid #8cf;
}

/* Make sure li selections wrap around markers */

li.ProseMirror-selectednode {
  outline: none;
}

li.ProseMirror-selectednode:after {
  content: "";
  position: absolute;
  left: -32px;
  right: -2px; top: -2px; bottom: -2px;
  border: 2px solid #8cf;
  pointer-events: none;
}

/* Protect against generic img rules */

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
}
.ProseMirror-textblock-dropdown {
  min-width: 3em;
}

.ProseMirror-menu {
  margin: 0 -4px;
  line-height: 1;
}

.ProseMirror-tooltip .ProseMirror-menu {
  width: -webkit-fit-content;
  width: fit-content;
  white-space: pre;
}

.ProseMirror-menuitem {
  margin-right: 3px;
  display: inline-block;
}

.ProseMirror-menuseparator {
  border-right: 1px solid #ddd;
  margin-right: 3px;
}

.ProseMirror-menu-dropdown, .ProseMirror-menu-dropdown-menu {
  font-size: 90%;
  white-space: nowrap;
}

.ProseMirror-menu-dropdown {
  vertical-align: 1px;
  cursor: pointer;
  position: relative;
  padding-right: 15px;
}

.ProseMirror-menu-dropdown-wrap {
  padding: 1px 0 1px 4px;
  display: inline-block;
  position: relative;
}

.ProseMirror-menu-dropdown:after {
  content: "";
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-top: 4px solid currentColor;
  opacity: .6;
  position: absolute;
  right: 4px;
  top: calc(50% - 2px);
}

.ProseMirror-menu-dropdown-menu, .ProseMirror-menu-submenu {
  position: absolute;
  background: white;
  color: #666;
  border: 1px solid #aaa;
  padding: 2px;
}

.ProseMirror-menu-dropdown-menu {
  z-index: 15;
  min-width: 6em;
}

.ProseMirror-menu-dropdown-item {
  cursor: pointer;
  padding: 2px 8px 2px 4px;
}

.ProseMirror-menu-dropdown-item:hover {
  background: #f2f2f2;
}

.ProseMirror-menu-submenu-wrap {
  position: relative;
  margin-right: -4px;
}

.ProseMirror-menu-submenu-label:after {
  content: "";
  border-top: 4px solid transparent;
  border-bottom: 4px solid transparent;
  border-left: 4px solid currentColor;
  opacity: .6;
  position: absolute;
  right: 4px;
  top: calc(50% - 4px);
}

.ProseMirror-menu-submenu {
  display: none;
  min-width: 4em;
  left: 100%;
  top: -3px;
}

.ProseMirror-menu-active {
  background: #eee;
  border-radius: 4px;
}

.ProseMirror-menu-disabled {
  opacity: .3;
}

.ProseMirror-menu-submenu-wrap:hover .ProseMirror-menu-submenu, .ProseMirror-menu-submenu-wrap-active .ProseMirror-menu-submenu {
  display: block;
}

.ProseMirror-menubar {
  border-top-left-radius: inherit;
  border-top-right-radius: inherit;
  position: relative;
  min-height: 1em;
  color: #666;
  padding: 1px 6px;
  top: 0; left: 0; right: 0;
  border-bottom: 1px solid silver;
  background: white;
  z-index: 10;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  overflow: visible;
}

.ProseMirror-icon {
  display: inline-block;
  line-height: .8;
  vertical-align: -2px; /* Compensate for padding */
  padding: 2px 8px;
  cursor: pointer;
}

.ProseMirror-menu-disabled.ProseMirror-icon {
  cursor: default;
}

.ProseMirror-icon svg {
  fill: currentColor;
  height: 1em;
}

.ProseMirror-icon span {
  vertical-align: text-top;
}
.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}
/* Add space around the hr to make clicking it easier */

.ProseMirror-example-setup-style hr {
  padding: 2px 10px;
  border: none;
  margin: 1em 0;
}

.ProseMirror-example-setup-style hr:after {
  content: "";
  display: block;
  height: 1px;
  background-color: silver;
  line-height: 2px;
}

.ProseMirror-prompt {
  background: white;
  padding: 5px 10px 5px 15px;
  border: 1px solid silver;
  position: fixed;
  border-radius: 3px;
  z-index: 11;
  box-shadow: -.5px 2px 5px rgba(0, 0, 0, .2);
}

.ProseMirror-prompt h5 {
  margin: 0;
  font-weight: normal;
  font-size: 100%;
  color: #444;
}

.ProseMirror-prompt input[type="text"],
.ProseMirror-prompt textarea {
  background: #eee;
  border: none;
  outline: none;
}

.ProseMirror-prompt input[type="text"] {
  padding: 0 4px;
}

.ProseMirror-prompt-close {
  position: absolute;
  left: 2px; top: 1px;
  color: #666;
  border: none; background: transparent; padding: 0;
}

.ProseMirror-prompt-close:after {
  content: "\u2715";
  font-size: 12px;
}

.ProseMirror-invalid {
  background: #ffc;
  border: 1px solid #cc7;
  border-radius: 4px;
  padding: 5px 10px;
  position: absolute;
  min-width: 10em;
}

.ProseMirror-prompt-buttons {
  margin-top: 5px;
  display: none;
}

.ProseMirror {
  line-height: 1.2;
  outline: none;
}
`),vh=kn(`
.theme {
  --unit: 4px;
  --padding: calc(var(--unit) * 4);
  --padding-sm: calc(var(--unit) * 2);
  --radius: var(--unit);
  --radius: calc(var(--unit) * 2);
  --radius-sm: var(--unit);
  --radius-lg: calc(var(--unit) * 4);
  --font-family: system-ui, sans-serif;
  --font-size: 17px;
  --line-height: 22px;
  --font: var(--font-size)/var(--line-height) var(--font-family);

  --color-text: black;
  --color-secondary-text: #8A8A8E;
  --color-bg: white;
  --color-secondary-bg: color-mix(in srgb, var(--color-bg), transparent 50%);
  --color-accent: #842A9C;
  --color-link: var(--color-accent);
  --color-link-underline: color-mix(in srgb, var(--color-link), transparent 70%);
  --color-brand-grey: #DFDBEB;
  --color-bg-code: hsl(0deg 0% 0% / 0.07);

  color-scheme: light dark;
  display: block;
  color: var(--color-text);
  font: var(--font);
}

@media (prefers-color-scheme: dark) {
  .theme {
    --color-text: white;
    --color-secondary-text: #F3F3F8;
    --color-bg: black;
    --color-accent: #C570DB;
  }
}

::selection {
  background-color: color-mix(in srgb, var(--color-accent), transparent 80%);
}
`),Rh=kn(`
.ProseMirror {
  font: var(--font);
}

.editor {
  color: black;
  background-clip: padding-box;
}

.type-body {
  font: var(--font);
}

.semibold {
  font-weight: 500;
}

.accent-text {
  color: var(--color-accent);
}

.secondary-text {
  color: var(--color-secondary-text);
}

.vstack {
  display: flex;
  flex-direction: column;
}

.gap {
  gap: var(--padding);
}

.gap-sm {
  gap: var(--padding-sm);
}

.gap-xsm {
  gap: var(--unit);
}

.transclude {
  --padding-v: var(--padding);
  --padding-h: var(--padding);
  background: var(--color-secondary-bg);
  border-radius: var(--radius-lg);
  overflow: hidden;
  padding: var(--padding-v) var(--padding-h);
}

.transclude-link {
  display: flex;
  flex-direction: column;
  color: inherit;
  text-decoration: inherit;
  -webkit-tap-highlight-color: transparent;
}

@keyframes fade-in {
  0% { opacity: 0; }
  100% { opacity: 1; }
}

.anim-fade-in {
  animation: fade-in 500ms ease-out;
}

.block {
  --indent: calc(var(--unit) * 6);
  --padding-v: calc(var(--unit) * 2);
  --padding-h: var(--padding);
  display: block;
  background-color: transparent;
  border-radius: 8px;
  transition: background-color 200ms ease-out;
  padding: var(--padding-v) var(--padding-h);
}

.block-content a {
  color: var(--color-link);
  text-decoration-color: var(--color-link-underline);
  text-decoration-thickness: 1px;
  text-underline-offset: 0.25em;
}

.block-content code {
  background-color: var(--color-bg-code);
  border-radius: var(--radius);
  padding: 2px;
  font-family: monospace;
}

.block-footer {
  user-select: none;
  --padding-v: calc(var(--unit) * 2);
  padding-top: var(--padding-v);
}

.block-footer:empty {
  display: none;
}

x-quoteblock.block .block-content {
  --quote-width: 3px;
  border-left: var(--quote-width) solid var(--color-accent);
  padding-left: calc(var(--indent) - var(--quote-width));
}

x-listblock.block .block-content {
  --bullet-height: var(--line-height);
  padding-left: var(--indent);
  position: relative;
}

x-listblock.block .block-content::before {
  content: "\u2022";
  font-size: 24px;
  font-weight: bold;
  position: absolute;
  left: 0;
  color: var(--color-accent);
  line-height: var(--bullet-height);
  height: var(--bullet-height);
  width: var(--indent);
  text-align: left;
}

x-headingblock .block-content {
  font-weight: bold;
}
`),Us=Object.freeze([Ih,Ph,vh,Rh]);var Sn=class extends HTMLElement{#e;constructor(){super(),this.attachShadow({mode:"open"});let e=this.shadowRoot;e.adoptedStyleSheets=Us;let t=document.createElement("div");t.id="editor",t.className="editor theme",e.append(t);let r=document.createElement("slot");r.id="content",e.append(r),this.#e=$s(t,r)}set state(e){let t=Ws(e);this.#e.updateState(t)}get state(){return this.#e.state.toJSON()}};customElements.define("x-editor",Sn);export{Sn as EditorElement};
//# sourceMappingURL=main.js.map
